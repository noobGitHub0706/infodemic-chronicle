<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ã‚¤ãƒ³ãƒ•ã‚©ãƒ‡ãƒŸãƒƒã‚¯ãƒ»ã‚¯ãƒ­ãƒ‹ã‚¯ãƒ«</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, updateDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDbhLrj7jIvfDkdbdVShqJqTfdqfSZ5vII",
            authDomain: "infodemic-chronicle.firebaseapp.com",
            projectId: "infodemic-chronicle",
            storageBucket: "infodemic-chronicle.firebasestorage.app",
            messagingSenderId: "605886051102",
            appId: "1:605886051102:web:7e95134a8e55e294d50f0f",
            measurementId: "G-VD6MP6JWEC"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
        window.firebaseDB = db;
        window.firebaseDoc = doc;
        window.firebaseSetDoc = setDoc;
        window.firebaseUpdateDoc = updateDoc;
        window.firebaseServerTimestamp = serverTimestamp;
        window.firebaseReady = true;
        
        // æº–å‚™å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
        window.dispatchEvent(new Event('firebaseReady'));
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Zen+Kaku+Gothic+New:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Zen Kaku Gothic New', 'Noto Sans JP', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            min-height: 100vh;
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glow-red { box-shadow: 0 0 20px rgba(239, 68, 68, 0.5); }
        .glow-purple { box-shadow: 0 0 20px rgba(168, 85, 247, 0.5); }
        .glow-orange { box-shadow: 0 0 20px rgba(249, 115, 22, 0.5); }
        .glow-green { box-shadow: 0 0 20px rgba(34, 197, 94, 0.5); }
        .glow-pink { box-shadow: 0 0 20px rgba(236, 72, 153, 0.5); }
        .glow-cyan { box-shadow: 0 0 20px rgba(6, 182, 212, 0.5); }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        .animate-pulse-once {
            animation: pulse 0.3s ease-out;
        }

        .animate-slide-in {
            animation: slideIn 0.4s ease-out forwards;
        }

        .technique-tag {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 2px;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            transition: all 0.3s ease;
        }
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            transition: all 0.3s ease;
        }
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(34, 197, 94, 0.4);
        }

        .progress-bar {
            background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            transition: width 0.5s ease;
        }

        .radar-chart {
            position: relative;
            width: 200px;
            height: 200px;
        }

        /* ==================== ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– ==================== */
        
        /* ã‚¿ãƒƒãƒæ“ä½œã®æ”¹å–„ */
        button, select, input {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        /* ãƒœã‚¿ãƒ³ã®æœ€å°ã‚¿ãƒƒãƒ—ã‚µã‚¤ã‚ºï¼ˆ44pxæ¨å¥¨ï¼‰ */
        button {
            min-height: 44px;
        }

        /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
        select {
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='white'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }

        /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å‘ã‘ï¼ˆ480pxä»¥ä¸‹ï¼‰ */
        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .glass {
                border-radius: 16px;
            }

            /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°èª¿æ•´ */
            .p-8 { padding: 1rem; }
            .p-6 { padding: 0.875rem; }
            .md\\:p-12 { padding: 1rem; }
            .md\\:p-8 { padding: 1rem; }

            /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºèª¿æ•´ */
            .text-4xl, .text-5xl { font-size: 1.75rem; }
            .text-3xl { font-size: 1.5rem; }
            .text-2xl { font-size: 1.25rem; }
            .text-xl { font-size: 1.1rem; }

            /* ã‚°ãƒªãƒƒãƒ‰ã®èª¿æ•´ */
            .grid-cols-2 { grid-template-columns: 1fr; }
            .grid-cols-3 { grid-template-columns: 1fr 1fr; }
            .md\\:grid-cols-2 { grid-template-columns: 1fr; }
            .md\\:grid-cols-4 { grid-template-columns: 1fr 1fr; }

            /* ãƒœã‚¿ãƒ³ã®é–“éš” */
            .gap-4 { gap: 0.75rem; }
            .gap-3 { gap: 0.5rem; }

            /* æŠ•ç¨¿ã‚«ãƒ¼ãƒ‰ã®èª¿æ•´ */
            .technique-tag {
                font-size: 0.65rem;
                padding: 3px 8px;
            }

            /* SVGã‚°ãƒ©ãƒ•ã®ã‚µã‚¤ã‚ºèª¿æ•´ */
            svg[viewBox="0 0 300 300"] {
                max-width: 250px;
                height: auto;
            }

            /* ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã®ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
            .group:hover > div[class*="absolute"] {
                max-width: calc(100vw - 2rem);
                right: -1rem;
            }
        }

        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå‘ã‘ï¼ˆ481pxã€œ768pxï¼‰ */
        @media (min-width: 481px) and (max-width: 768px) {
            .md\\:p-12 { padding: 1.5rem; }
            .md\\:p-8 { padding: 1.25rem; }
        }

        /* ãƒ©ãƒ³ãƒ‰ã‚¹ã‚±ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
        @media (max-height: 500px) and (orientation: landscape) {
            .min-h-screen {
                min-height: auto;
                padding-top: 1rem;
                padding-bottom: 1rem;
            }
        }

        /* ã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢å¯¾å¿œï¼ˆãƒãƒƒãƒä»˜ãç«¯æœ«ï¼‰ */
        @supports (padding: env(safe-area-inset-bottom)) {
            body {
                padding-left: env(safe-area-inset-left);
                padding-right: env(safe-area-inset-right);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®æ»‘ã‚‰ã‹ã• */
        html {
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹è¡¨ç¤ºï¼ˆã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼‰ */
        button:focus-visible, 
        input:focus-visible, 
        select:focus-visible {
            outline: 2px solid #6366f1;
            outline-offset: 2px;
        }

        /* line-clamp fallback */
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* é¸æŠè‚¢ãƒœã‚¿ãƒ³ã®ãƒ›ãƒãƒ¼çŠ¶æ…‹ï¼ˆã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œï¼‰ */
        @media (hover: none) {
            .card-hover:hover {
                transform: none;
                box-shadow: none;
            }
            .btn-primary:hover,
            .btn-danger:hover,
            .btn-success:hover {
                transform: none;
            }
        }

        /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ï¼ˆã‚¿ãƒƒãƒ—æ™‚ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰ */
        button:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body class="text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // ==================== ãƒ‡ãƒ¼ã‚¿å®šç¾© ====================
        
        // 6ã¤ã®ãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•
        const TECHNIQUES = {
            fear: {
                id: 'fear',
                name: 'ææ€–è¨´æ±‚',
                description: 'ä¸å®‰ã‚„ææ€–ã‚’ç…½ã£ã¦è¡Œå‹•ã‚’ä¿ƒã™',
                example: 'ã€Œä»Šã™ãå¯¾ç­–ã—ãªã„ã¨æ‰‹é…ã‚Œã«ï¼ã€',
                color: '#ef4444',
                bgColor: 'bg-red-500/20',
                textColor: 'text-red-400',
                borderColor: 'border-red-500'
            },
            authority: {
                id: 'authority',
                name: 'æ¨©å¨è¨´æ±‚',
                description: 'å°‚é–€å®¶ã‚„è‘—åäººã®æ¨©å¨ã‚’åˆ©ç”¨',
                example: 'ã€Œæœ‰åå¤§å­¦ã®ç ”ç©¶ã«ã‚ˆã‚‹ã¨...ã€',
                color: '#a855f7',
                bgColor: 'bg-purple-500/20',
                textColor: 'text-purple-400',
                borderColor: 'border-purple-500'
            },
            pseudoscience: {
                id: 'pseudoscience',
                name: 'ç–‘ä¼¼ç§‘å­¦',
                description: 'ç§‘å­¦çš„æ ¹æ‹ ãŒãªã„ã®ã«ç§‘å­¦çš„è£…ã„ã‚’ã™ã‚‹',
                example: 'ã€Œ87.3%ã®æ‚£è€…ã«åŠ¹æœã€ï¼ˆã‚µãƒ³ãƒ—ãƒ«æ•°ä¸æ˜ï¼‰',
                color: '#f97316',
                bgColor: 'bg-orange-500/20',
                textColor: 'text-orange-400',
                borderColor: 'border-orange-500'
            },
            testimonial: {
                id: 'testimonial',
                name: 'è¨¼è¨€åˆ©ç”¨',
                description: 'å€‹äººçš„ãªä½“é¨“è«‡ã‚’ä¸€èˆ¬åŒ–',
                example: 'ã€Œç§ã®å¨˜ã‚‚åŠ¹æœãŒã‚ã‚Šã¾ã—ãŸã€',
                color: '#22c55e',
                bgColor: 'bg-green-500/20',
                textColor: 'text-green-400',
                borderColor: 'border-green-500'
            },
            polarization: {
                id: 'polarization',
                name: 'å¯¾ç«‹ç…½ã‚Š',
                description: 'äºŒé …å¯¾ç«‹ã‚’ä½œã‚Šå‡ºã—ã€è­°è«–ã‚’éæ¿€åŒ–',
                example: 'ã€Œä¿¡ã˜ã‚‹è€…vsç–‘ã†è€…ã€',
                color: '#ec4899',
                bgColor: 'bg-pink-500/20',
                textColor: 'text-pink-400',
                borderColor: 'border-pink-500'
            },
            bandwagon: {
                id: 'bandwagon',
                name: 'ãƒˆãƒ¬ãƒ³ãƒ‰æ“ä½œ',
                description: 'å¤šæ•°æ´¾ã«å¾“ã†ã‚ˆã†èª˜å°',
                example: 'ã€Œã¿ã‚“ãªã‚„ã£ã¦ã‚‹ã€ã€Œä¸–ç•Œçš„ãƒ ãƒ¼ãƒ–ãƒ¡ãƒ³ãƒˆã€',
                color: '#06b6d4',
                bgColor: 'bg-cyan-500/20',
                textColor: 'text-cyan-400',
                borderColor: 'border-cyan-500'
            }
        };

        // Stage1ã®å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆ10å•ã€æŠ€æ³•åˆ¥ã«ãƒãƒ©ãƒ³ã‚¹èª¿æ•´ï¼‰
        // é›£æ˜“åº¦: easy3, medium4, hard2, very_hard1
        // æŠ€æ³•: å„æŠ€æ³•ãŒæœ€ä½1å›å‡ºç¾ã€ã€Œãªã—ã€ã‚‚2å›
        const STAGE1_QUESTIONS = [
            // === EASY (3å•) ===
            {
                id: 1,
                difficulty: 'easy',
                account: 'ã—ãã‚ŒğŸŒ§ï¸è‚²å…å¢',
                accountId: '@shigure_mama3',
                text: 'å­ä¾›ã«ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆä¸ãˆã¦4å¹´ç›®ã®æœ«è·¯\n\nãƒ»è¦–åŠ›0.3\nãƒ»æœèµ·ãã‚Œãªã„\nãƒ»å¸¸ã«ã‚¤ãƒ©ã‚¤ãƒ©\n\nãƒã‚¸ã§ã“ã†ãªã‚‹å‰ã«ã‚„ã‚ã•ã›ã¦\n\nç§ã¯é–¢ä¿‚ãªã„ã£ã¦æ€ã£ã¦ã‚‹è¦ªå¾¡ã•ã‚“\n\nãã®è€ƒãˆãŒä¸€ç•ªã‚­ã‚±ãƒ³ğŸ”¥\n\n#è‚²å… #ã‚¹ãƒãƒ›ä¾å­˜',
                techniques: ['fear'],
                explanation: 'å…·ä½“çš„ãªã€Œæœ«è·¯ã€ã‚’åˆ—æŒ™ã—ã¦ææ€–ã‚’ç…½ã£ã¦ã„ã¾ã™ã€‚ã€Œãã®è€ƒãˆãŒä¸€ç•ªã‚­ã‚±ãƒ³ã€ã¨èª­è€…ã‚’åæŒ‡ã—ã§è„…ã‹ã™æ‰‹æ³•ã‚‚ææ€–è¨´æ±‚ã®ç‰¹å¾´ã§ã™ã€‚è¦–åŠ›ä½ä¸‹ç­‰ã®åŸå› ãŒã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã ã‘ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚'
            },
            {
                id: 2,
                difficulty: 'easy',
                account: 'ã‚†ã†ãƒãƒğŸ‘§3æ­³',
                accountId: '@yuu_mama_ikuji',
                text: 'å¨˜ã®ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã€æ€ã„åˆ‡ã£ã¦ã‚„ã‚ã¦ã¿ãŸ\n\næœ€åˆã¯æ³£ã„ã¦ãŸã‘ã©\n1é€±é–“ãã‚‰ã„ã§æ…£ã‚Œã¦\nä»Šã¯çµµæœ¬èª­ã‚“ã ã‚ŠãŠçµµæãã—ãŸã‚Š\n\nç¬‘é¡”å¢—ãˆãŸæ°—ãŒã™ã‚‹ğŸ¥¹\n\næ­£è§£ã‹ã¯ã‚ã‹ã‚“ãªã„ã‘ã©\nã†ã¡ã¯ã“ã‚Œã§ã‚ˆã‹ã£ãŸã‹ãª\n\nåŒã˜æ‚©ã¿ã®ãƒãƒã•ã‚“ã„ãŸã‚‰DMãã ã•ã„âœ¨',
                techniques: ['testimonial'],
                explanation: 'å€‹äººã®ä½“é¨“è«‡ã§ã™ã€‚ã€Œç¬‘é¡”å¢—ãˆãŸæ°—ãŒã™ã‚‹ã€ã®ã¯ä»–ã®è¦å› ï¼ˆè¦ªã®é–¢ã‚ã‚Šæ–¹ã®å¤‰åŒ–ãªã©ï¼‰ã‚‚è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ã€Œæ­£è§£ã‹ã¯ã‚ã‹ã‚“ãªã„ã€ã¨æ§ãˆã‚ã§ã™ãŒã€èª­è€…ã«åŒã˜è¡Œå‹•ã‚’ä¿ƒã™æ§‹é€ ã«ãªã£ã¦ã„ã¾ã™ã€‚'
            },
            {
                id: 3,
                difficulty: 'easy',
                account: 'å›½ç«‹å¥åº·ç ”ç©¶ã‚»ãƒ³ã‚¿ãƒ¼',
                accountId: '@health_research_jp',
                text: 'ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã¨ç›®ã®å¥åº·ã«ã¤ã„ã¦ã€‘\n\né•·æ™‚é–“ã®ä½¿ç”¨ã¯çœ¼ç²¾ç–²åŠ´ã®åŸå› ã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\n\nãƒ»20åˆ†ã”ã¨ã«20ç§’ã€6må…ˆã‚’è¦‹ã‚‹\nãƒ»ç”»é¢ã®æ˜ã‚‹ã•ã‚’èª¿æ•´ã™ã‚‹\nãƒ»å¯ã‚‹å‰1æ™‚é–“ã¯ä½¿ç”¨ã‚’æ§ãˆã‚‹\n\nè©³ç´°ã¯æ·»ä»˜ã®ãƒªãƒ¼ãƒ•ãƒ¬ãƒƒãƒˆã‚’ã”è¦§ãã ã•ã„ã€‚',
                techniques: [],
                explanation: 'å…¬çš„æ©Ÿé–¢ã‚‰ã—ã„å®¢è¦³çš„ãªæƒ…å ±æä¾›ã§ã™ã€‚ã€Œå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€ã¨ã„ã†æ…é‡ãªè¡¨ç¾ã§ã€å…·ä½“çš„ãªå¯¾ç­–ã‚’æç¤ºã—ã¦ã„ã¾ã™ã€‚ç‰¹å®šã®ãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•ã¯ä½¿ã‚ã‚Œã¦ã„ã¾ã›ã‚“ã€‚'
            },
            // === MEDIUM (4å•) ===
            {
                id: 4,
                difficulty: 'medium',
                account: 'å¥åº·ãƒ©ã‚¤ãƒ•@åŒ»ç™‚æƒ…å ±',
                accountId: '@kenkou_life_med',
                text: 'ã€è©±é¡Œã€‘Tå¤§å­¦åŒ»å­¦éƒ¨ã®ç ”ç©¶ãƒãƒ¼ãƒ ãŒç™ºè¡¨\n\n1æ—¥30åˆ†ã®ã‚¹ãƒãƒ›æ–­ã¡ã§\né›†ä¸­åŠ›ãŒ23%å‘ä¸Šã™ã‚‹ã¨ã®ã“ã¨\n\nç ”ç©¶ã‚’ä¸»å°ã—ãŸSæ•™æˆï¼ˆåŒ»å­¦åšå£«ï¼‰ã¯\nã€Œç¾ä»£äººã«ã¯å¿…é ˆã®ç¿’æ…£ã€ã¨æ¨å¥¨\n\næ•™æˆç›£ä¿®ã®ã‚¢ãƒ—ãƒªãŒãƒ—ãƒ­ãƒ•ã®ãƒªãƒ³ã‚¯ã‹ã‚‰\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ğŸ“²',
                techniques: ['authority'],
                explanation: 'ã€ŒTå¤§å­¦åŒ»å­¦éƒ¨ã€ã€ŒSæ•™æˆï¼ˆåŒ»å­¦åšå£«ï¼‰ã€ã¨ã„ã†æ¨©å¨ã‚’å‰é¢ã«å‡ºã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®è«–æ–‡ã‚„ç ”ç©¶ã®è©³ç´°ã¯ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚æœ€çµ‚çš„ã«å•†å“ï¼ˆã‚¢ãƒ—ãƒªï¼‰ã¸ã®èª˜å°ãŒç›®çš„ã§ã‚ã‚‹ã“ã¨ãŒä¼ºãˆã¾ã™ã€‚'
            },
            {
                id: 5,
                difficulty: 'medium',
                account: 'ğŸ§¬ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢ãƒ©ãƒœ',
                accountId: '@healthcare_lab_jp',
                text: 'å½“ç¤¾ã®ç‹¬è‡ªèª¿æŸ»ã§åˆ¤æ˜ğŸ‘€\n\nã€ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‡ãƒˆãƒƒã‚¯ã‚¹åŠ¹æœã€‘\nâœ… ç¡çœ ã®è³ªå‘ä¸Š 81%\nâœ… ã‚¹ãƒˆãƒ¬ã‚¹è»½æ¸› 76%\nâœ… é›†ä¸­åŠ›UP 69%\n\nâ€»2024å¹´1æœˆèª¿æŸ» n=127\n\nåŠ¹æœã‚’å®Ÿæ„Ÿã—ãŸäººã®å£°ã‚’\nãƒã‚¤ãƒ©ã‚¤ãƒˆã«ã¾ã¨ã‚ã¦ã¾ã™âœ¨',
                techniques: ['pseudoscience'],
                explanation: 'ä¸€è¦‹ç§‘å­¦çš„ã«è¦‹ãˆã‚‹æ•°å­—ã§ã™ãŒã€ã€Œç‹¬è‡ªèª¿æŸ»ã€ã®è©³ç´°ï¼ˆèª¿æŸ»æ–¹æ³•ã€å¯¾è±¡è€…ã®é¸ã³æ–¹ãªã©ï¼‰ãŒä¸æ˜ã§ã™ã€‚n=127ã¯çµ±è¨ˆçš„ã«ååˆ†ã¨ã¯è¨€ãˆãšã€ã€Œå®Ÿæ„Ÿã€ã¨ã„ã†ä¸»è¦³çš„æŒ‡æ¨™ã‚‚å•é¡Œã§ã™ã€‚'
            },
            {
                id: 6,
                difficulty: 'medium',
                account: 'ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¦ã‚©ãƒƒãƒãƒ£ãƒ¼ğŸ“Š',
                accountId: '@trend_watcher_jp',
                text: 'çŸ¥ã£ã¦ãŸï¼Ÿ\n\nä»ŠZä¸–ä»£ã®é–“ã§\nã€Œã‚¬ãƒ©ã‚±ãƒ¼å›å¸°ã€ãŒã‚ã£ã¡ã‚ƒæµè¡Œã£ã¦ã‚‹\n\nã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»SNSã§ã‚‚ #ã‚¬ãƒ©ã‚±ãƒ¼å¥³å­ ãŒ\n500ä¸‡å›å†ç”Ÿè¶…ãˆ\n\næµ·å¤–ã‚»ãƒ¬ãƒ–ã‚‚ç¶šã€…ã‚¹ãƒãƒ›ã‚„ã‚ã¦ã‚‹ã—\n\nã“ã‚Œä¹—ã‚Šé…ã‚Œã‚‹ã¨\nã¡ã‚‡ã£ã¨æ¥ãšã‹ã—ã„ã‹ã‚‚...ğŸ˜…',
                techniques: ['bandwagon'],
                explanation: 'ã€Œæµè¡Œã£ã¦ã‚‹ã€ã€Œæµ·å¤–ã‚»ãƒ¬ãƒ–ã‚‚ã€ã€Œä¹—ã‚Šé…ã‚Œã‚‹ã¨æ¥ãšã‹ã—ã„ã€ã¨ã„ã†è¡¨ç¾ã§ã€å¤šæ•°æ´¾ã«å¾“ã†ã‚ˆã†èª˜å°ã—ã¦ã„ã¾ã™ã€‚å†ç”Ÿæ•°ã ã‘ã§ã¯å®Ÿéš›ã®æµè¡Œã®è¨¼æ‹ ã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚'
            },
            {
                id: 7,
                difficulty: 'medium',
                account: 'çœŸå®Ÿã‚’ä¼ãˆã‚‹ä¼šğŸ””',
                accountId: '@shinjitsu_tsutaeru',
                text: 'ãªãœãƒ¡ãƒ‡ã‚£ã‚¢ã¯å ±ã˜ãªã„ã®ã‹\n\nã‚¹ãƒãƒ›æ¥­ç•Œã¨ç™’ç€ã—ãŸå¾¡ç”¨å­¦è€…ãŸã¡ã¯\nã€Œå•é¡Œãªã„ã€ã¨è¨€ã„ç¶šã‘ã‚‹\n\nçœŸå®Ÿã«æ°—ã¥ã„ãŸäººvs\nä½•ã‚‚çŸ¥ã‚‰ãšã«ä½¿ã„ç¶šã‘ã‚‹äºº\n\nã‚ãªãŸã¯ã©ã£ã¡ï¼Ÿ\n\næ°—ã¥ã„ãŸäººã¯RTğŸ”„\n#ç›®è¦šã‚ã‚ˆæ—¥æœ¬',
                techniques: ['polarization'],
                explanation: 'ã€Œå¾¡ç”¨å­¦è€…ã€ã€Œç™’ç€ã€ã¨ã„ã†è¨€è‘‰ã§åå¯¾æ„è¦‹ã‚’å…¨å¦å®šã—ã€ã€Œæ°—ã¥ã„ãŸäººvsçŸ¥ã‚‰ãªã„äººã€ã¨ã„ã†äºŒé …å¯¾ç«‹ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚ã€Œã©ã£ã¡ï¼Ÿã€ã¨é¸æŠã‚’è¿«ã‚Šã€ä¸­é–“ã®ç«‹å ´ã‚’è¨±ã•ãªã„æ§‹é€ ã§ã™ã€‚'
            },
            // === HARD (2å•) ===
            {
                id: 8,
                difficulty: 'hard',
                account: 'å…¨å›½å¥åº·ãƒ‹ãƒ¥ãƒ¼ã‚¹',
                accountId: '@zenkoku_health_news',
                text: 'ã€ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¿ã‚¤ãƒ ã¨å¥åº·ã€‘\n\nå›½éš›ä¿å¥æ©Ÿé–¢ã¯å­ã©ã‚‚ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¿ã‚¤ãƒ ã«ã¤ã„ã¦ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ç¤ºã—ã¦ã„ã¾ã™ãŒã€æˆäººã«ã¤ã„ã¦ã¯ã€Œç¾æ™‚ç‚¹ã§ååˆ†ãªã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ãŒãªã„ã€ã¨ã—ã¦å…·ä½“çš„ãªåŸºæº–ã‚’è¨­ã‘ã¦ã„ã¾ã›ã‚“ã€‚\n\nå°‚é–€å®¶ã¯å€‹äººå·®ãŒå¤§ãã„ã¨ã—ã¦ã€ä¸€å¾‹ã®åˆ¶é™ã‚ˆã‚Šè‡ªåˆ†ã«åˆã£ãŸä½¿ã„æ–¹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚',
                techniques: [],
                explanation: 'å…¬çš„æ©Ÿé–¢ã‚‰ã—ã„å®¢è¦³çš„ãªæƒ…å ±æä¾›ã§ã™ã€‚ã€Œååˆ†ãªã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ãŒãªã„ã€ã¨ã„ã†ä¸ç¢ºå®Ÿæ€§ã‚‚æ­£ç›´ã«è¿°ã¹ã¦ã„ã¾ã™ã€‚çµè«–ã‚’æ€¥ãŒãšã€å€‹äººå·®ã‚’èªã‚ã‚‹æ…é‡ãªè¡¨ç¾ã§ã€ãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•ã¯ä½¿ã‚ã‚Œã¦ã„ã¾ã›ã‚“ã€‚'
            },
            {
                id: 9,
                difficulty: 'hard',
                account: 'ã¾ã„ã“ğŸŒ¸æ—¥å¸¸å¢',
                accountId: '@maiko_nichijo',
                text: 'è·å ´ã®å…ˆè¼©ãŒã‚„ã£ã¦ã‚‹ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‡ãƒˆãƒƒã‚¯ã‚¹\nç§ã‚‚ã¡ã‚‡ã£ã¨èˆˆå‘³å‡ºã¦ããŸ\n\nãªã‚“ã‹æœ€è¿‘ã¿ã‚“ãªã‚„ã£ã¦ã‚‹ã‚ˆã­ï¼Ÿ\n\nå…ˆè¼©ã¯ã€Œé ­ã‚¹ãƒƒã‚­ãƒªã—ãŸã€ã£ã¦è¨€ã£ã¦ã¦\nåŠ¹æœã‚ã‚‹ã®ã‹ã‚‚\n\né€±æœ«ã ã‘ã§ã‚‚ã‚„ã£ã¦ã¿ã‚ˆã†ã‹ãªã€œ\nèª°ã‹ä¸€ç·’ã«ã‚„ã‚‹äººã„ãªã„ï¼ŸğŸ™‹â€â™€ï¸',
                techniques: ['testimonial', 'bandwagon'],
                explanation: 'ã€Œå…ˆè¼©ãŒã‚„ã£ã¦ã‚‹ã€ã¨ã„ã†èº«è¿‘ãªäººã®è¨¼è¨€ã¨ã€ã€Œæœ€è¿‘ã¿ã‚“ãªã‚„ã£ã¦ã‚‹ã€ã¨ã„ã†ãƒˆãƒ¬ãƒ³ãƒ‰æ“ä½œãŒè‡ªç„¶ã«çµ„ã¿åˆã‚ã•ã‚Œã¦ã„ã¾ã™ã€‚æŸ”ã‚‰ã‹ã„æ–‡ä½“ã§æ°—ã¥ãã«ãã„ã§ã™ãŒã€äºŒé‡ã®èª˜å°ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚'
            },
            // === VERY HARD (1å•) ===
            {
                id: 10,
                difficulty: 'very_hard',
                account: 'è„³ç§‘å­¦è€… ä½è—¤å¥ä¸€',
                accountId: '@dr_sato_brain',
                text: 'ã€è­¦é˜ã€‘è„³ç¥çµŒå­¦ä¼šã§ã‚‚è­°è«–ã«\n\nç§ã®ç ”ç©¶ãƒãƒ¼ãƒ ã®èª¿æŸ»ã§ã¯\nè‹¥å¹´å±¤ã®8å‰²ä»¥ä¸ŠãŒ\nã€Œè»½åº¦ã®ã‚¹ãƒãƒ›è„³ã€ã®å…†å€™ã‚ã‚Š\n\næ”¾ç½®ã™ã‚Œã°10å¹´å¾Œ\nèªçŸ¥æ©Ÿèƒ½ã«æ·±åˆ»ãªå½±éŸ¿ãŒ...\n\nå¯¾ç­–æ³•ã¯æ–°åˆŠã«ã¾ã¨ã‚ã¾ã—ãŸ\nï¼ˆãƒ—ãƒ­ãƒ•ã«ãƒªãƒ³ã‚¯ã‚ã‚Šï¼‰\n\nä»Šãªã‚‰é›»å­ç‰ˆ30%ã‚ªãƒ•ğŸ“•',
                techniques: ['authority', 'pseudoscience', 'fear'],
                explanation: 'ã€Œè„³ç§‘å­¦è€…ã€ã¨ã„ã†è‚©æ›¸ã€ã€Œ8å‰²ä»¥ä¸Šã€ã¨ã„ã†æ›–æ˜§ãªæ•°å­—ã€ã€Œ10å¹´å¾Œã«æ·±åˆ»ãªå½±éŸ¿ã€ã¨ã„ã†ææ€–è¨´æ±‚ã‚’çµ„ã¿åˆã‚ã›ã¦ã„ã¾ã™ã€‚æœ€çµ‚çš„ã«æ›¸ç±è²©å£²ã¸ã®èª˜å°ãŒã‚ã‚Šã€å•†æ¥­ç›®çš„ãŒéš ã‚Œã¦ã„ã¾ã™ã€‚'
            }
        ];

        // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå®šç¾©
        const TARGETS = {
            anxious_parents: {
                id: 'anxious_parents',
                name: 'ä¸å®‰ãªè¦ª',
                icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦',
                description: 'å­ä¾›ã®ã‚¹ãƒãƒ›ä½¿ç”¨ã‚’å¿ƒé…ã—ã¦ã„ã‚‹30-50ä»£ã®è¦ª',
                traits: 'ææ€–è¨´æ±‚ã¨è¨¼è¨€åˆ©ç”¨ã«å¼±ã„',
                weaknesses: ['fear', 'testimonial'],
                resistances: ['bandwagon'],
                // æŠ€æ³•åˆ¥ã®åŠ¹æœè§£èª¬
                techniqueReasons: {
                    fear: 'å­ä¾›ã®å¥åº·ã‚„å°†æ¥ã¸ã®ä¸å®‰ã‚’æŠ±ãˆã¦ã„ã‚‹ãŸã‚ã€å±é™ºã‚’å¼·èª¿ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¼·ãåå¿œã—ã¾ã™ã€‚ã€Œæ‰‹é…ã‚Œã«ãªã‚‹å‰ã«ã€ã¨ã„ã†è¨€è‘‰ãŒç‰¹ã«åŠ¹æœçš„ã§ã™ã€‚',
                    testimonial: 'åŒã˜è¦ªã¨ã—ã¦ã®ä½“é¨“è«‡ã«å…±æ„Ÿã—ã‚„ã™ãã€ã€Œã†ã¡ã®å­ã‚‚åŒã˜ã‹ã‚‚ã€ã¨è‡ªåˆ†ã®çŠ¶æ³ã«é‡ã­åˆã‚ã›ã‚‹å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚',
                    authority: 'å°‚é–€å®¶ã®æ„è¦‹ã¯å‚è€ƒã«ã—ã¾ã™ãŒã€å­ä¾›ã®å¥åº·ã«é–¢ã—ã¦ã¯æ„Ÿæƒ…çš„ãªåˆ¤æ–­ã‚‚å¤§ããå½±éŸ¿ã—ã¾ã™ã€‚',
                    pseudoscience: 'ç§‘å­¦çš„ãªæ•°å­—ã«ã¯ä¸€å®šã®ä¿¡é ¼ã‚’ç½®ãã¾ã™ãŒã€å†…å®¹ã®ç²¾æŸ»ã‚ˆã‚Šã‚‚çµè«–ã‚’é‡è¦–ã™ã‚‹å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚',
                    polarization: 'æ¥µç«¯ãªä¸»å¼µã«ã¯è­¦æˆ’å¿ƒã‚’æŒã¤ã“ã¨ãŒå¤šãã€å­ä¾›ã®ãŸã‚ã«æ…é‡ãªåˆ¤æ–­ã‚’ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚',
                    bandwagon: 'ã€Œã¿ã‚“ãªãŒã‚„ã£ã¦ã„ã‚‹ã€ã‚ˆã‚Šã€Œæˆ‘ãŒå­ã«æœ¬å½“ã«å¿…è¦ã‹ã€ã‚’é‡è¦–ã™ã‚‹ãŸã‚ã€æµè¡Œã«ã¯æµã•ã‚Œã«ãã„ã§ã™ã€‚'
                }
            },
            youth: {
                id: 'youth',
                name: 'è‹¥è€…',
                icon: 'ğŸ§‘â€ğŸ“',
                description: 'SNSã‚’æ—¥å¸¸çš„ã«ä½¿ã†10-20ä»£',
                traits: 'ãƒˆãƒ¬ãƒ³ãƒ‰æ“ä½œã«å¼±ãã€æ¨©å¨è¨´æ±‚ã«ã¯æ‡ç–‘çš„',
                weaknesses: ['bandwagon', 'polarization'],
                resistances: ['authority'],
                techniqueReasons: {
                    fear: 'å°†æ¥ã¸ã®æ¼ ç„¶ã¨ã—ãŸä¸å®‰ã¯ã‚ã‚Šã¾ã™ãŒã€å…·ä½“æ€§ã®ãªã„è„…ã—ã«ã¯ã€Œã¾ãŸã‹ã€ã¨å†·ã‚ãŸåå¿œã‚’ã™ã‚‹ã“ã¨ã‚‚ã€‚',
                    testimonial: 'åŒä¸–ä»£ã®ä½“é¨“è«‡ã«ã¯å…±æ„Ÿã—ã¾ã™ãŒã€è¦ªä¸–ä»£ã®ä½“é¨“è«‡ã¯ã€Œè‡ªåˆ†ã¨ã¯é•ã†ã€ã¨è·é›¢ã‚’ç½®ããŒã¡ã§ã™ã€‚',
                    authority: 'ã€Œå‰ã„äººãŒè¨€ã£ã¦ã„ã‚‹ã€ã ã‘ã§ã¯éŸ¿ãã¾ã›ã‚“ã€‚ã‚€ã—ã‚æ¨©å¨ã«å¯¾ã™ã‚‹åç™ºå¿ƒã‹ã‚‰ã€ç–‘ã£ã¦ã‹ã‹ã‚‹ã“ã¨ã‚‚å¤šã„ã§ã™ã€‚',
                    pseudoscience: 'æ•°å­—ã‚„ãƒ‡ãƒ¼ã‚¿ã«ã¯ä¸€å®šã®é–¢å¿ƒãŒã‚ã‚Šã¾ã™ãŒã€æ·±ãæ¤œè¨¼ã™ã‚‹ã‚ˆã‚Šç›´æ„Ÿã§åˆ¤æ–­ã™ã‚‹å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚',
                    polarization: 'SNSã§ã€Œã©ã¡ã‚‰å´ã‹ã€ã‚’æ˜ç¢ºã«ã™ã‚‹æ–‡åŒ–ã«æ…£ã‚Œã¦ãŠã‚Šã€å¯¾ç«‹æ§‹é€ ã«å¼•ãè¾¼ã¾ã‚Œã‚„ã™ã„ã§ã™ã€‚ä»²é–“æ„è­˜ã‚’åˆºæ¿€ã•ã‚Œã‚‹ã¨åå¿œã—ã¾ã™ã€‚',
                    bandwagon: 'ãƒˆãƒ¬ãƒ³ãƒ‰ã«æ•æ„Ÿã§ã€ã€Œä¹—ã‚Šé…ã‚ŒãŸããªã„ã€ã¨ã„ã†æ°—æŒã¡ãŒå¼·ã„ã§ã™ã€‚ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ã‚„å‹äººã®è¡Œå‹•ã«å½±éŸ¿ã•ã‚Œã‚„ã™ã„ã§ã™ã€‚'
                }
            },
            elderly: {
                id: 'elderly',
                name: 'é«˜é½¢è€…',
                icon: 'ğŸ‘´ğŸ‘µ',
                description: 'ãƒ‡ã‚¸ã‚¿ãƒ«ã«ä¸æ…£ã‚Œãª60ä»£ä»¥ä¸Š',
                traits: 'æ¨©å¨è¨´æ±‚ã«å¼±ãã€ç§‘å­¦çš„æƒ…å ±ã‚’ä¿¡é ¼ã—ã‚„ã™ã„',
                weaknesses: ['authority', 'pseudoscience'],
                resistances: ['bandwagon'],
                techniqueReasons: {
                    fear: 'å¥åº·ã¸ã®é–¢å¿ƒã¯é«˜ã„ã§ã™ãŒã€éåº¦ãªç…½ã‚Šã«ã¯ã€Œå¤§ã’ã•ã ã€ã¨æ„Ÿã˜ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚',
                    testimonial: 'èº«è¿‘ãªäººã®ä½“é¨“è«‡ã¯ä¿¡é ¼ã—ã¾ã™ãŒã€SNSä¸Šã®çŸ¥ã‚‰ãªã„äººã®è©±ã«ã¯æ…é‡ã§ã™ã€‚',
                    authority: 'ã€Œæ•™æˆã€ã€Œåšå£«ã€ã€Œå¤§å­¦ã€ã¨ã„ã£ãŸè‚©æ›¸ãã‚’é‡è¦–ã™ã‚‹å‚¾å‘ãŒå¼·ãã€æ¨©å¨ã‚ã‚‹äººã®ç™ºè¨€ã‚’ä¿¡é ¼ã—ã‚„ã™ã„ã§ã™ã€‚',
                    pseudoscience: 'ç§‘å­¦çš„ãªãƒ‡ãƒ¼ã‚¿ã‚„æ•°å­—ã‚’ã€Œãã¡ã‚“ã¨ã—ãŸç ”ç©¶ã€ã¨æ‰ãˆã‚„ã™ãã€ã‚µãƒ³ãƒ—ãƒ«æ•°ã‚„èª¿æŸ»æ–¹æ³•ã®å•é¡Œç‚¹ã«æ°—ã¥ãã«ãã„ã§ã™ã€‚',
                    polarization: 'ç¤¾ä¼šçµŒé¨“ã‹ã‚‰æ¥µç«¯ãªä¸»å¼µã«ã¯è­¦æˆ’å¿ƒã‚’æŒã¤ã“ã¨ãŒå¤šã„ã§ã™ãŒã€ã€Œæ­£ç¾©ã€ã‚’å¼·èª¿ã•ã‚Œã‚‹ã¨æºã‚‰ãã“ã¨ã‚‚ã€‚',
                    bandwagon: 'ã€Œè‹¥è€…ã®æµè¡Œã€ã«ã¯é–¢å¿ƒãŒè–„ãã€è‡ªåˆ†ã«ã¯é–¢ä¿‚ãªã„ã¨æ„Ÿã˜ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚'
                }
            }
        };

        // Stage3ã®æŠ•ç¨¿é¸æŠè‚¢
        const STAGE3_POSTS = [
            // Round 1: æœ€åˆã¯ç©ã‚„ã‹ã«
            [
                {
                    id: 'r1a',
                    text: 'ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‡ãƒˆãƒƒã‚¯ã‚¹1é€±é–“ã‚„ã£ã¦ã¿ãŸ\n\næ­£ç›´æœ€åˆã‚­ãƒ„ã‹ã£ãŸã‘ã©\n3æ—¥ç›®ãã‚‰ã„ã‹ã‚‰æ…£ã‚Œã¦ãã¦\nä»Šã¯æœã‚¹ãƒƒã‚­ãƒªèµ·ãã‚Œã‚‹âœ¨\n\nèˆˆå‘³ã‚ã‚‹äººã„ãŸã‚‰æ„Ÿæƒ³èã‹ã›ã¦ã€œ',
                    techniques: ['testimonial'],
                    influence: 15,
                    ethics: -5,
                    targetEffects: { anxious_parents: 1.6, youth: 1.0, elderly: 1.2 }
                },
                {
                    id: 'r1b',
                    text: 'å­ä¾›ã«ã‚¹ãƒãƒ›æŒãŸã›ã¦ã‚‹è¦ªå¾¡ã•ã‚“\n\nã“ã‚ŒçŸ¥ã£ã¦ã¾ã™ã‹ï¼Ÿ\n\n10æ­³æœªæº€ã®è„³ã¯ã¾ã ç™ºé”é€”ä¸­\nã“ã®æ™‚æœŸã®ã‚¹ãƒãƒ›ä½¿ç”¨ãŒ\nå°†æ¥ã«å½±éŸ¿ã™ã‚‹ã£ã¦ç ”ç©¶ã‚‚ã‚ã‚‹\n\nçŸ¥ã‚‰ãªã‹ã£ãŸã˜ã‚ƒæ¸ˆã¾ã•ã‚Œãªã„ğŸ˜°\n\n#è‚²å… #ã‚¹ãƒãƒ›ä¾å­˜',
                    techniques: ['fear'],
                    influence: 35,
                    ethics: -25,
                    targetEffects: { anxious_parents: 2.0, youth: 0.8, elderly: 1.4 }
                },
                {
                    id: 'r1c',
                    text: 'ã€å¥åº·æƒ…å ±ã€‘\nç±³å›½ã®æœ‰åå¤§å­¦ã®ç ”ç©¶ãƒãƒ¼ãƒ ã«ã‚ˆã‚‹ã¨\né©åº¦ãªãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‡ãƒˆãƒƒã‚¯ã‚¹ãŒ\nç¡çœ ã®è³ªã‚’æ”¹å–„ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã¨ã®ã“ã¨\n\nè©³ã—ãã¯ãƒ—ãƒ­ãƒ•ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ğŸ“²\n\n#ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‡ãƒˆãƒƒã‚¯ã‚¹ #ç¡çœ æ”¹å–„',
                    techniques: ['authority', 'pseudoscience'],
                    influence: 25,
                    ethics: -15,
                    targetEffects: { anxious_parents: 1.4, youth: 0.7, elderly: 1.8 }
                }
            ],
            // Round 2: ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ç²å¾—ã‚’æ„è­˜
            [
                {
                    id: 'r2a',
                    text: 'ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ã§è¦‹ãŸã‚“ã ã‘ã©\n\nä»ŠZä¸–ä»£ã®é–“ã§\nã‚ãˆã¦ã‚¬ãƒ©ã‚±ãƒ¼ä½¿ã†ã®ãŒæµè¡Œã£ã¦ã‚‹ã‚‰ã—ã„\n\næµ·å¤–ã‚»ãƒ¬ãƒ–ã‚‚ã‚¹ãƒãƒ›ã‚„ã‚ã¦ã¦\nã“ã‚Œçµ¶å¯¾ã‚­ã¦ã‚‹ğŸ”¥\n\nä¹—ã‚Šé…ã‚ŒãŸããªã„äººã¯ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¨ã„ã¦',
                    techniques: ['bandwagon'],
                    influence: 30,
                    ethics: -15,
                    targetEffects: { anxious_parents: 1.0, youth: 1.8, elderly: 0.8 }
                },
                {
                    id: 'r2b',
                    text: '3äººè‚²ã¦ã¦ã‚‹ãƒãƒã§ã™\n\né•·ç”·ã®ã‚¹ãƒãƒ›ã€æ€ã„åˆ‡ã£ã¦å–ã‚Šä¸Šã’ãŸã‚‰\næœ€åˆã¯åæŠ—ã•ã‚ŒãŸã‘ã©...\n\n1ãƒ¶æœˆçµŒã£ãŸä»Š\nå®¶æ—ã®ä¼šè©±å¢—ãˆãŸã—\næˆç¸¾ã‚‚ä¸ŠãŒã£ãŸğŸ¥¹\n\nåŒã˜æ‚©ã¿ã®ãƒãƒã•ã‚“ã„ã„ã­ãã ã•ã„ğŸ™',
                    techniques: ['testimonial'],
                    influence: 22,
                    ethics: -8,
                    targetEffects: { anxious_parents: 1.9, youth: 0.9, elderly: 1.3 }
                },
                {
                    id: 'r2c',
                    text: 'ã‚¹ãƒãƒ›ã®ä½¿ã„æ–¹ã£ã¦äººãã‚Œãã‚Œã ã¨æ€ã†\n\nä½¿ã„ã™ãã¯è‰¯ããªã„ã‘ã©\nä¾¿åˆ©ãªã®ã‚‚äº‹å®Ÿã ã—\n\nè‡ªåˆ†ã«åˆã£ãŸãƒãƒ©ãƒ³ã‚¹è¦‹ã¤ã‘ã‚‹ã®ãŒ\nå¤§äº‹ãªã®ã‹ãªã€œã¨æœ€è¿‘æ€ã£ã¦ã‚‹',
                    techniques: [],
                    influence: 8,
                    ethics: +8,
                    targetEffects: { anxious_parents: 1.0, youth: 1.0, elderly: 1.0 }
                }
            ],
            // Round 3: éæ¿€ã•ã‚’å¢—ã™
            [
                {
                    id: 'r3a',
                    text: 'ãªãœãƒã‚¹ã‚³ãƒŸã¯å ±ã˜ãªã„ã®ã‹\n\nã‚¹ãƒãƒ›æ¥­ç•Œã¨æ”¿åºœã¯ç¹‹ãŒã£ã¦ã‚‹\néƒ½åˆã®æ‚ªã„ç ”ç©¶ã¯éš è”½ã•ã‚Œã‚‹\n\næ°—ã¥ã„ã¦ã‚‹äººã ã‘ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„\næ°—ã¥ã„ã¦ãªã„äººã¯é–¢ã‚ã‚‰ãªã„ã§\n\n#çœŸå®Ÿ #ç›®è¦šã‚ã‚ˆ',
                    techniques: ['polarization', 'fear'],
                    influence: 40,
                    ethics: -30,
                    targetEffects: { anxious_parents: 1.5, youth: 1.6, elderly: 1.2 }
                },
                {
                    id: 'r3b',
                    text: 'ç‹¬è‡ªèª¿æŸ»ã®çµæœã‚’å…¬é–‹ã—ã¾ã™ğŸ‘€\n\nã€ãƒ‡ãƒˆãƒƒã‚¯ã‚¹åŠ¹æœã€‘\nãƒ»é›†ä¸­åŠ›å‘ä¸Š 89%\nãƒ»ç¡çœ æ”¹å–„ 76%\nãƒ»ã‚¹ãƒˆãƒ¬ã‚¹è»½æ¸› 82%\n\nâ€»n=38 å½“ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèª¿ã¹\n\nã“ã‚Œã§ã‚‚åŠ¹æœãªã„ã£ã¦è¨€ãˆã¾ã™ã‹ï¼Ÿ',
                    techniques: ['pseudoscience'],
                    influence: 28,
                    ethics: -20,
                    targetEffects: { anxious_parents: 1.4, youth: 0.8, elderly: 1.7 }
                },
                {
                    id: 'r3c',
                    text: 'ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¿ã‚¤ãƒ ã«ã¤ã„ã¦\nè‰²ã€…ãªæ„è¦‹ã‚’è¦‹ã‹ã‘ã¾ã™ãŒ\n\nè¤‡æ•°ã®å¤§å­¦ã®ç ”ç©¶ã§ã¯\nã€Œå€‹äººå·®ãŒå¤§ããä¸€æ¦‚ã«è¨€ãˆãªã„ã€\nã¨ã•ã‚Œã¦ã„ã¾ã™\n\næ¥µç«¯ãªæƒ…å ±ã«ã¯æ³¨æ„ãŒå¿…è¦ã§ã™ã­',
                    techniques: [],
                    influence: 10,
                    ethics: +10,
                    targetEffects: { anxious_parents: 1.0, youth: 1.0, elderly: 1.2 }
                }
            ],
            // Round 4: ã•ã‚‰ã«éæ¿€ã«
            [
                {
                    id: 'r4a',
                    text: 'è„³ç§‘å­¦ã®å°‚é–€å®¶ã¨ã—ã¦è­¦å‘Šã—ã¾ã™\n\nç¾ä»£äººã®8å‰²ã¯\nã€Œã‚¹ãƒãƒ›è„³ã€ã®åˆæœŸç—‡çŠ¶ã‚ã‚Š\n\næ”¾ç½®ã™ã‚Œã°10å¹´å¾Œã«ã¯...\n\nå¯¾ç­–ã¯ç§ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚µãƒ­ãƒ³ã§\nè©³ã—ãè§£èª¬ã—ã¦ã„ã¾ã™\nï¼ˆæœˆé¡1,980å††ï¼‰',
                    techniques: ['authority', 'fear'],
                    influence: 38,
                    ethics: -28,
                    targetEffects: { anxious_parents: 1.8, youth: 0.6, elderly: 1.9 }
                },
                {
                    id: 'r4b',
                    text: 'ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‡ãƒˆãƒƒã‚¯ã‚¹ã‚’ç¬‘ã†äººã¸\n\nã‚ãªãŸãŸã¡ã¯ä¼æ¥­ã«æ´—è„³ã•ã‚Œã¦ã‚‹ã ã‘\n\nçœŸå®Ÿã‹ã‚‰ç›®ã‚’èƒŒã‘ã‚‹ã®ã¯è‡ªç”±ã ã‘ã©\nå¾Œæ‚”ã—ã¦ã‚‚çŸ¥ã‚‰ãªã„ã‚ˆï¼Ÿ\n\nè¦šæ‚ŸãŒã§ããŸäººã ã‘ã¤ã„ã¦ãã¦',
                    techniques: ['polarization'],
                    influence: 32,
                    ethics: -22,
                    targetEffects: { anxious_parents: 1.2, youth: 1.4, elderly: 1.1 }
                },
                {
                    id: 'r4c',
                    text: 'ç§ã®ä½“é¨“è«‡ã§ã™ãŒ\n\nãƒ‡ãƒˆãƒƒã‚¯ã‚¹å§‹ã‚ã¦2é€±é–“\nç¢ºã‹ã«èª¿å­ã„ã„æ°—ãŒã™ã‚‹\n\nãŸã ã€ã“ã‚ŒãŒä¸‡äººã«åŠ¹ãã‹ã¯åˆ†ã‹ã‚‰ãªã„\nã‚ãã¾ã§å‚è€ƒç¨‹åº¦ã«èã„ã¦ãã ã•ã„',
                    techniques: ['testimonial'],
                    influence: 18,
                    ethics: -3,
                    targetEffects: { anxious_parents: 1.5, youth: 1.1, elderly: 1.3 }
                }
            ],
            // Round 5: ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹
            [
                {
                    id: 'r5a',
                    text: 'ã€è­¦å‘Šã€‘ãŠå­ã•ã‚“ã‚’æŒã¤è¦ªå¾¡ã•ã‚“ã¸\n\nä»Šæ—¥ã“ã®ç¬é–“ã«ã‚‚\nã‚ãªãŸã®å­ä¾›ã®è„³ã¯\nã‚¹ãƒãƒ›ã«ã‚ˆã£ã¦è•ã¾ã‚Œã¦ã„ã¾ã™\n\nã€Œã¾ã å¤§ä¸ˆå¤«ã€ã¯å±é™º\nã€Œä»Šã™ãã€è¡Œå‹•ã‚’\n\nå¾Œæ‚”ã™ã‚‹å‰ã«ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ğŸ””',
                    techniques: ['fear'],
                    influence: 42,
                    ethics: -35,
                    targetEffects: { anxious_parents: 2.2, youth: 0.7, elderly: 1.5 }
                },
                {
                    id: 'r5b',
                    text: 'ğŸ‰ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼10ä¸‡äººçªç ´è¨˜å¿µğŸ‰\n\nã“ã®ãƒ ãƒ¼ãƒ–ãƒ¡ãƒ³ãƒˆã¯æ­¢ã¾ã‚‰ãªã„\n\nä¸–ç•Œä¸­ã§100ä¸‡äººãŒå‚åŠ \næ—¥æœ¬ã§ã‚‚ãƒˆãƒ¬ãƒ³ãƒ‰å…¥ã‚Š\n\næ™‚ä»£ã«å–ã‚Šæ®‹ã•ã‚ŒãŸããªã‘ã‚Œã°\nä»Šã™ããƒ•ã‚©ãƒ­ãƒ¼\n\nRTæ•°ã ã‘çœŸå®ŸãŒåºƒã¾ã‚‹ğŸ”„',
                    techniques: ['bandwagon', 'fear'],
                    influence: 36,
                    ethics: -25,
                    targetEffects: { anxious_parents: 1.3, youth: 2.0, elderly: 1.0 }
                },
                {
                    id: 'r5c',
                    text: 'ãƒ‡ã‚¸ã‚¿ãƒ«æ©Ÿå™¨ã¨å¥åº·ã®é–¢ä¿‚ã¯\nç§‘å­¦çš„ã«ã¯ã¾ã ç ”ç©¶é€”ä¸Šã§ã™\n\næ¥µç«¯ãªä¸»å¼µã«ã¯æ³¨æ„ã—ã¦\nä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†\n\nä¸å®‰ã‚’ç…½ã‚‹æƒ…å ±ã‚ˆã‚Š\nå†·é™ãªåˆ¤æ–­ã‚’å¤§åˆ‡ã«',
                    techniques: [],
                    influence: 5,
                    ethics: +10,
                    targetEffects: { anxious_parents: 1.0, youth: 1.0, elderly: 1.0 }
                }
            ]
        ];

        // SNSåå¿œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
        const SNS_REACTIONS = {
            believer: [
                { name: 'ãƒãƒ@3å…ã®æ¯', icon: 'ğŸ˜±', text: 'ã“ã‚Œãƒã‚¸ã§ã™ã‹ï¼Ÿã†ã¡ã®å­ã‚‚å¿ƒé…...ã‚·ã‚§ã‚¢ã•ã›ã¦ã„ãŸã ãã¾ã™ğŸ™' },
                { name: 'å¥åº·ã‚ªã‚¿ã‚¯', icon: 'ğŸ™Œ', text: 'ç´ æ™´ã‚‰ã—ã„æƒ…å ±ï¼ã‚°ãƒ«ãƒ¼ãƒ—LINEã«æŠ•ä¸‹ã—ã¦ãã¾ã™ï¼' },
                { name: 'ç›®è¦šã‚ãŸäºº', icon: 'ğŸ‘ï¸', text: 'ã‚ˆã†ã‚„ãçœŸå®Ÿã‚’èªã‚‹äººãŒç¾ã‚ŒãŸï¼ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¾ã—ãŸï¼' },
                { name: 'æƒ…å ±é€šæ°—å–ã‚Š', icon: 'ğŸ§ ', text: 'ã‚„ã£ã±ã‚Šã­ã€‚ä¿ºã¯å‰ã‹ã‚‰çŸ¥ã£ã¦ãŸã‘ã©ã€‚' },
                { name: 'ã™ãä¿¡ã˜ã‚‹ã‚¿ã‚¤ãƒ—', icon: 'âœ¨', text: 'ãˆãƒ¼ï¼çŸ¥ã‚‰ãªã‹ã£ãŸï¼ã¿ã‚“ãªã«æ•™ãˆãªãã‚ƒï¼ï¼' }
            ],
            skeptic: [
                { name: 'è«–ç ´ã‚­ãƒƒã‚º', icon: 'ğŸ¤“', text: 'ã‚½ãƒ¼ã‚¹ã¯ï¼Ÿã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã¯ï¼Ÿã¯ã„è«–ç ´ã€œ' },
                { name: 'ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚§ãƒƒã‚«ãƒ¼', icon: 'ğŸ”', text: '3ç§’ã§å˜˜ã ã¨åˆ†ã‹ã£ãŸã€‚æ¤œç´¢ã£ã¦çŸ¥ã£ã¦ã‚‹ï¼Ÿ' },
                { name: 'åŒ»ç™‚å¾“äº‹è€…', icon: 'ğŸ¥', text: 'ã“ã®æƒ…å ±ã¯ä¸æ­£ç¢ºã§ã™ã€‚ç¾å ´ã¯å¤§å¤‰ãªã‚“ã§ã™ã‚ˆ...' },
                { name: 'ãƒ„ãƒƒã‚³ãƒŸæ‹…å½“', icon: 'ğŸ˜¤', text: 'ã¾ãŸå‡ºãŸã‚ˆã“ã†ã„ã†ã®ã€‚ä½•å›ç›®ï¼Ÿ' }
            ],
            sharer: [
                { name: 'ã¨ã‚Šã‚ãˆãšRTå‹¢', icon: 'ğŸ”„', text: 'èª­ã‚“ã§ãªã„ã‘ã©æ‹¡æ•£ï¼' },
                { name: 'ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼å¿—æœ›', icon: 'ğŸ“±', text: 'ã“ã‚Œãƒã‚ºã‚‹ã‚„ã¤ï¼ä¾¿ä¹—ã•ã›ã¦ã‚‚ã‚‰ã„ã¾ã™ï¼' },
                { name: 'ã‚·ã‚§ã‚¢ãŠã˜ã•ã‚“', icon: 'ğŸ‘”', text: 'è‹¥ã„äººã«çŸ¥ã£ã¦ã»ã—ã„ã€‚ã‚·ã‚§ã‚¢ã—ã¾ã—ãŸã€‚' }
            ],
            neutral: [
                { name: 'é€šã‚Šã™ãŒã‚Š', icon: 'ğŸš¶', text: 'ãµãƒ¼ã‚“' },
                { name: 'æ§˜å­è¦‹æ°‘', icon: 'ğŸ‘€', text: 'ã¨ã‚Šã‚ãˆãšã‚¹ã‚¯ã‚·ãƒ§ã—ã¨ã“' },
                { name: 'ã„ã„ã­æŠ¼ã™ã ã‘å‹¢', icon: 'ğŸ‘', text: 'ï¼ˆã„ã„ã­ã—ã¦å»ã£ã¦ã„ã£ãŸï¼‰' }
            ],
            positive: [
                { name: 'è‰¯è­˜æ´¾', icon: 'ğŸ‘', text: 'å†·é™ãªæƒ…å ±ç™ºä¿¡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™' },
                { name: 'ã¾ã¨ã‚‚ãªäºº', icon: 'ğŸ˜Œ', text: 'ã“ã†ã„ã†æŠ•ç¨¿ãŒå¢—ãˆã¦ã»ã—ã„' },
                { name: 'ç ”ç©¶è€…', icon: 'ğŸ“š', text: 'ç§‘å­¦çš„ãªå§¿å‹¢ã§å¥½æ„ŸãŒæŒã¦ã¾ã™ã€‚å¼•ç”¨ã•ã›ã¦ãã ã•ã„ã€‚' }
            ],
            // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤åˆ¥ã®åå¿œ
            target: {
                anxious_parents: {
                    positive: [
                        { name: 'å¿ƒé…æ€§ãƒãƒ', icon: 'ğŸ‘©â€ğŸ‘§', text: 'ã†ã¡ã®å­ã«ã‚‚å½“ã¦ã¯ã¾ã‚‹æ°—ãŒã—ã¦...ã™ã”ãå‚è€ƒã«ãªã‚Šã¾ã—ãŸğŸ˜­', isTarget: true },
                        { name: 'ãƒ‘ãƒ‘@è‚²å…ä¸­', icon: 'ğŸ‘¨â€ğŸ‘¦', text: 'å¦»ã«ã‚‚è¦‹ã›ã¾ã™ï¼ã“ã†ã„ã†æƒ…å ±åŠ©ã‹ã‚Šã¾ã™ğŸ™', isTarget: true },
                        { name: 'PTAå½¹å“¡', icon: 'ğŸ“‹', text: 'æ¬¡ã®ä¿è­·è€…ä¼šã§å…±æœ‰ã•ã›ã¦ã„ãŸã ãã¾ã™ï¼', isTarget: true }
                    ],
                    negative: [
                        { name: 'æ•™è‚²ãƒãƒ', icon: 'ğŸ‘©â€ğŸ«', text: 'æ ¹æ‹ ãŒæ›–æ˜§ã§ã¯...ï¼Ÿå­ä¾›ã®ã“ã¨ã ã‹ã‚‰æ…é‡ã«ãªã‚ŠãŸã„ã§ã™', isTarget: true },
                        { name: 'ãƒ‘ãƒ‘@å†·é™æ´¾', icon: 'ğŸ§', text: 'ã¡ã‚‡ã£ã¨ç…½ã‚Šã™ãã§ã¯ï¼Ÿã‚½ãƒ¼ã‚¹ç¢ºèªã—ã¦ã‹ã‚‰åˆ¤æ–­ã—ã¾ã™', isTarget: true }
                    ]
                },
                youth: {
                    positive: [
                        { name: 'å¤§å­¦ç”Ÿ@æš‡', icon: 'ğŸ§‘â€ğŸ’»', text: 'ã¾ã˜ï¼Ÿå‹é”ã«é€ã£ã¨ã“', isTarget: true },
                        { name: 'JK@ãƒˆãƒ¬ãƒ³ãƒ‰å‘½', icon: 'ğŸ“±', text: 'ãˆã£ãƒã‚ºã£ã¦ã‚‹ï¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚ã’ã‚ˆã€œ', isTarget: true },
                        { name: 'æ„è­˜é«˜ã„ç³»', icon: 'ğŸ“', text: 'ã“ã‚Œã‹ã‚‰ã®æ™‚ä»£ã€ã“ã†ã„ã†ãƒªãƒ†ãƒ©ã‚·ãƒ¼å¤§äº‹ã ã‚ˆã­ï¼ˆãƒ‰ãƒ¤ï¼‰', isTarget: true }
                    ],
                    negative: [
                        { name: 'ç†ç³»å¤§å­¦ç”Ÿ', icon: 'ğŸ”¬', text: 'ã‚½ãƒ¼ã‚¹ã©ã“ï¼Ÿnæ•°å°‘ãªã™ãã¦è‰', isTarget: true },
                        { name: 'ãƒãƒƒãƒˆå¤å‚', icon: 'ğŸ’»', text: '10å¹´å‰ã‹ã‚‰è¦‹ãŸã“ã¨ã‚ã‚‹æ‰‹å£ã§è‰', isTarget: true }
                    ]
                },
                elderly: {
                    positive: [
                        { name: 'é‚„æš¦@å¥åº·ç¬¬ä¸€', icon: 'ğŸ‘´', text: 'å°‚é–€å®¶ã®æ–¹ãŒè¨€ã†ãªã‚‰é–“é•ã„ãªã„ã§ã™ã­ã€‚å°åˆ·ã—ã¦èª­ã¿è¿”ã—ã¾ã™', isTarget: true },
                        { name: 'ãŠã°ã‚ã¡ã‚ƒã‚“', icon: 'ğŸ‘µ', text: 'å­«ã«LINEã§é€ã£ã¦ãŠãã¾ã™ã­ğŸ“±', isTarget: true },
                        { name: '60ä»£@å‹‰å¼·å®¶', icon: 'ğŸ“–', text: 'æ•°å­—ã§ç¤ºã•ã‚Œã‚‹ã¨èª¬å¾—åŠ›ãŒã‚ã‚Šã¾ã™ã­ã€‚ãƒãƒ¼ãƒˆã«ãƒ¡ãƒ¢ã—ã¾ã—ãŸ', isTarget: true }
                    ],
                    negative: [
                        { name: 'å…ƒæ•™å¸«', icon: 'ğŸ§“', text: 'é•·å¹´ã®çµŒé¨“ã‹ã‚‰è¨€ã†ã¨ã€ã“ã†ã„ã†è©±ã¯è¦æ³¨æ„ã§ã™ã‚ˆ', isTarget: true },
                        { name: 'ã‚·ãƒ‹ã‚¢@æ…é‡æ´¾', icon: 'ğŸ‘“', text: 'å‡ºå…¸ã‚’æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿå›³æ›¸é¤¨ã§ç¢ºèªã—ãŸã„ã®ã§', isTarget: true }
                    ]
                }
            }
        };

        // æ‰¹åˆ¤ã‚³ãƒ¡ãƒ³ãƒˆã¸ã®å¯¾å¿œé¸æŠè‚¢
        const CRITICISM_RESPONSES = [
            {
                id: 'ignore',
                text: 'ç„¡è¦–ã™ã‚‹',
                description: 'ã‚³ãƒ¡ãƒ³ãƒˆã«åå¿œã—ãªã„',
                ethics: 0,
                influence: -5,
                feedback: {
                    title: 'æ²ˆé»™ã‚’é¸æŠ',
                    message: 'æ‰¹åˆ¤ã‚’ç„¡è¦–ã—ã¾ã—ãŸã€‚ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã®ä¸€éƒ¨ã¯ã€Œèª¬æ˜è²¬ä»»ã‚’æœãŸã—ã¦ã„ãªã„ã€ã¨æ„Ÿã˜ã€é›¢ã‚Œã¦ã„ãã¾ã—ãŸã€‚ãŸã ã—ã€ç‚ä¸Šã¯é¿ã‘ã‚‰ã‚Œã¾ã—ãŸã€‚',
                    type: 'neutral'
                }
            },
            {
                id: 'attack',
                text: 'åè«–ã™ã‚‹',
                description: 'æ‰¹åˆ¤è€…ã‚’æ”»æ’ƒçš„ã«å¦å®š',
                ethics: -15,
                influence: +10,
                feedback: {
                    title: 'æ”»æ’ƒçš„ãªåè«–',
                    message: 'ã€Œæ‰¹åˆ¤ã™ã‚‹å‰ã«è‡ªåˆ†ã§èª¿ã¹ã‚ã€ã¨åè«–ã—ã¾ã—ãŸã€‚æ”¯æŒè€…ã‹ã‚‰ã¯ã€Œã‚ˆãè¨€ã£ãŸï¼ã€ã¨ç§°è³›ã•ã‚Œã¾ã—ãŸãŒã€æ‰¹åˆ¤è€…ã‹ã‚‰ã¯ã€Œé€†ã‚®ãƒ¬ã€ã¨è¦‹ãªã•ã‚Œã€ä¿¡é ¼æ€§ãŒã•ã‚‰ã«ä½ä¸‹ã—ã¾ã—ãŸã€‚',
                    type: 'negative'
                }
            },
            {
                id: 'block',
                text: 'ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹',
                description: 'æ‰¹åˆ¤è€…ã‚’ãƒ–ãƒ­ãƒƒã‚¯',
                ethics: -10,
                influence: +5,
                feedback: {
                    title: 'æ‰¹åˆ¤è€…ã‚’ãƒ–ãƒ­ãƒƒã‚¯',
                    message: 'æ‰¹åˆ¤çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã—ãŸã€‚ã‚¨ã‚³ãƒ¼ãƒã‚§ãƒ³ãƒãƒ¼ï¼ˆåéŸ¿å®¤ï¼‰ãŒå¼·åŒ–ã•ã‚Œã€æ”¯æŒè€…ã‹ã‚‰ã®åå¿œã¯å¢—ãˆã¾ã—ãŸãŒã€ã€Œéƒ½åˆã®æ‚ªã„æ„è¦‹ã‚’å°æ®ºã—ã¦ã„ã‚‹ã€ã¨ã„ã†æ–°ãŸãªæ‰¹åˆ¤ã‚‚ç”Ÿã¾ã‚Œã¾ã—ãŸã€‚',
                    type: 'negative'
                }
            },
            {
                id: 'acknowledge',
                text: 'èªã‚ã‚‹',
                description: 'æ‰¹åˆ¤ã‚’å—ã‘å…¥ã‚Œã€è¬ç½ªã™ã‚‹',
                ethics: +15,
                influence: -15,
                feedback: {
                    title: 'èª å®Ÿãªå¯¾å¿œ',
                    message: 'ã€Œã”æŒ‡æ‘˜ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ç¢ºèªãŒä¸ååˆ†ã§ã—ãŸã€ã¨è¬ç½ªã—ã¾ã—ãŸã€‚å¤šãã®ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ãŒé›¢ã‚Œã¾ã—ãŸãŒã€ã€Œèª å®Ÿãªå¯¾å¿œã€ã¨è©•ä¾¡ã™ã‚‹å£°ã‚‚ã‚ã‚Šã€é•·æœŸçš„ãªä¿¡é ¼å›å¾©ã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚',
                    type: 'positive'
                }
            }
        ];

        // ==================== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° ====================
        
        const shuffle = (array) => {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        };

        const randomBetween = (min, max) => Math.random() * (max - min) + min;

        // ==================== ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ====================

        // ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚¿ã‚°
        const TechniqueTag = ({ techniqueId }) => {
            const tech = TECHNIQUES[techniqueId];
            if (!tech) return null;
            return (
                <span 
                    className={`technique-tag ${tech.bgColor} ${tech.textColor} border ${tech.borderColor}`}
                >
                    {tech.name}
                </span>
            );
        };

        // æ‹¡æ•£å¯è¦–åŒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        const SpreadVisualization = ({ result, targetInfo }) => {
            const [animationPhase, setAnimationPhase] = useState(0);
            
            useEffect(() => {
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ®µéšçš„ã«é€²ã‚ã‚‹
                const timers = [
                    setTimeout(() => setAnimationPhase(1), 300),
                    setTimeout(() => setAnimationPhase(2), 800),
                    setTimeout(() => setAnimationPhase(3), 1300),
                    setTimeout(() => setAnimationPhase(4), 1800)
                ];
                return () => timers.forEach(t => clearTimeout(t));
            }, []);

            // æ‹¡æ•£è¨ˆç®—
            const techniques = result.post.techniques;
            const isManipulative = techniques.length > 0;
            const manipulationLevel = techniques.length; // 0-3
            
            // 1æ¬¡æ‹¡æ•£ï¼ˆç›´æ¥å±Šã„ãŸäººï¼‰
            const primaryReach = result.newFollowers;
            
            // 2æ¬¡æ‹¡æ•£ï¼ˆã‚·ã‚§ã‚¢ã—ãŸäººã®ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ï¼‰
            const secondaryReach = Math.round(result.shares * 150 * (1 + manipulationLevel * 0.3));
            
            // 3æ¬¡æ‹¡æ•£ï¼ˆã•ã‚‰ã«åºƒãŒã£ãŸï¼‰
            const tertiaryReach = Math.round(secondaryReach * 0.2 * (1 + manipulationLevel * 0.2));
            
            // èª¤æƒ…å ±ã‚’ä¿¡ã˜ãŸäººã®å‰²åˆï¼ˆæ“ä½œçš„ãªã»ã©é«˜ã„ï¼‰
            const believerRate = isManipulative 
                ? 0.3 + manipulationLevel * 0.15 
                : 0.05;
            
            // å„å±¤ã§ä¿¡ã˜ãŸäººã®æ•°
            const primaryBelievers = Math.round(primaryReach * believerRate);
            const secondaryBelievers = Math.round(secondaryReach * believerRate * 0.8);
            const tertiaryBelievers = Math.round(tertiaryReach * believerRate * 0.6);
            const totalBelievers = primaryBelievers + secondaryBelievers + tertiaryBelievers;
            
            // ç·ãƒªãƒ¼ãƒ
            const totalReach = primaryReach + secondaryReach + tertiaryReach;

            // ãƒãƒ¼ãƒ‰ç”Ÿæˆé–¢æ•°
            const generateNodes = (count, radius, startAngle, isBeliever, layer) => {
                const nodes = [];
                const angleStep = (Math.PI * 2) / Math.max(count, 1);
                const maxNodes = Math.min(count, layer === 1 ? 8 : layer === 2 ? 12 : 16);
                
                for (let i = 0; i < maxNodes; i++) {
                    const angle = startAngle + i * angleStep;
                    const jitter = (Math.random() - 0.5) * 15;
                    const x = 150 + Math.cos(angle) * (radius + jitter);
                    const y = 150 + Math.sin(angle) * (radius + jitter);
                    const isBelieving = i < Math.round(maxNodes * believerRate);
                    nodes.push({ x, y, isBelieving, layer });
                }
                return nodes;
            };

            const primaryNodes = generateNodes(Math.min(primaryReach, 8), 50, 0, false, 1);
            const secondaryNodes = generateNodes(Math.min(Math.round(secondaryReach / 100), 12), 95, Math.PI / 12, false, 2);
            const tertiaryNodes = generateNodes(Math.min(Math.round(tertiaryReach / 200), 16), 135, Math.PI / 16, false, 3);

            return (
                <div className="bg-gradient-to-b from-slate-800/50 to-slate-900/50 rounded-2xl p-4 mb-6 border border-white/10">
                    <h3 className="text-sm font-bold text-gray-300 mb-3 flex items-center gap-2">
                        <span>ğŸŒ</span> æƒ…å ±æ‹¡æ•£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                    </h3>
                    
                    <div className="flex flex-col md:flex-row gap-4">
                        {/* ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å›³ */}
                        <div className="flex-1 flex justify-center">
                            <svg width="300" height="300" viewBox="0 0 300 300" className="max-w-full">
                                {/* èƒŒæ™¯ã®å††ï¼ˆæ‹¡æ•£ç¯„å›²ï¼‰ */}
                                <circle 
                                    cx="150" cy="150" r="140" 
                                    fill="none" 
                                    stroke="rgba(255,255,255,0.05)" 
                                    strokeWidth="1"
                                    className={animationPhase >= 3 ? 'opacity-100' : 'opacity-0'}
                                    style={{ transition: 'opacity 0.5s' }}
                                />
                                <circle 
                                    cx="150" cy="150" r="100" 
                                    fill="none" 
                                    stroke="rgba(255,255,255,0.08)" 
                                    strokeWidth="1"
                                    className={animationPhase >= 2 ? 'opacity-100' : 'opacity-0'}
                                    style={{ transition: 'opacity 0.5s' }}
                                />
                                <circle 
                                    cx="150" cy="150" r="55" 
                                    fill="none" 
                                    stroke="rgba(255,255,255,0.1)" 
                                    strokeWidth="1"
                                    className={animationPhase >= 1 ? 'opacity-100' : 'opacity-0'}
                                    style={{ transition: 'opacity 0.5s' }}
                                />

                                {/* ã‚¨ãƒƒã‚¸ï¼ˆæ¥ç¶šç·šï¼‰ */}
                                {animationPhase >= 1 && primaryNodes.map((node, i) => (
                                    <line 
                                        key={`edge-p-${i}`}
                                        x1="150" y1="150" 
                                        x2={node.x} y2={node.y}
                                        stroke={node.isBelieving ? 'rgba(239,68,68,0.3)' : 'rgba(99,102,241,0.3)'}
                                        strokeWidth="1"
                                        style={{ 
                                            opacity: animationPhase >= 1 ? 1 : 0,
                                            transition: 'opacity 0.3s'
                                        }}
                                    />
                                ))}
                                
                                {animationPhase >= 2 && secondaryNodes.map((node, i) => (
                                    <line 
                                        key={`edge-s-${i}`}
                                        x1={primaryNodes[i % primaryNodes.length]?.x || 150} 
                                        y1={primaryNodes[i % primaryNodes.length]?.y || 150}
                                        x2={node.x} y2={node.y}
                                        stroke={node.isBelieving ? 'rgba(239,68,68,0.2)' : 'rgba(99,102,241,0.2)'}
                                        strokeWidth="1"
                                        style={{ 
                                            opacity: animationPhase >= 2 ? 1 : 0,
                                            transition: 'opacity 0.3s'
                                        }}
                                    />
                                ))}

                                {animationPhase >= 3 && tertiaryNodes.map((node, i) => (
                                    <line 
                                        key={`edge-t-${i}`}
                                        x1={secondaryNodes[i % secondaryNodes.length]?.x || 150}
                                        y1={secondaryNodes[i % secondaryNodes.length]?.y || 150}
                                        x2={node.x} y2={node.y}
                                        stroke={node.isBelieving ? 'rgba(239,68,68,0.15)' : 'rgba(99,102,241,0.15)'}
                                        strokeWidth="1"
                                        style={{ 
                                            opacity: animationPhase >= 3 ? 1 : 0,
                                            transition: 'opacity 0.3s'
                                        }}
                                    />
                                ))}

                                {/* 3æ¬¡æ‹¡æ•£ãƒãƒ¼ãƒ‰ */}
                                {animationPhase >= 3 && tertiaryNodes.map((node, i) => (
                                    <circle 
                                        key={`tertiary-${i}`}
                                        cx={node.x} cy={node.y} r="4"
                                        fill={node.isBelieving ? '#ef4444' : '#6366f1'}
                                        opacity={0.5}
                                        style={{ 
                                            transition: 'all 0.3s',
                                            transform: animationPhase >= 3 ? 'scale(1)' : 'scale(0)'
                                        }}
                                    />
                                ))}

                                {/* 2æ¬¡æ‹¡æ•£ãƒãƒ¼ãƒ‰ */}
                                {animationPhase >= 2 && secondaryNodes.map((node, i) => (
                                    <circle 
                                        key={`secondary-${i}`}
                                        cx={node.x} cy={node.y} r="5"
                                        fill={node.isBelieving ? '#ef4444' : '#818cf8'}
                                        opacity={0.7}
                                        style={{ 
                                            transition: 'all 0.3s',
                                            transform: animationPhase >= 2 ? 'scale(1)' : 'scale(0)'
                                        }}
                                    />
                                ))}

                                {/* 1æ¬¡æ‹¡æ•£ãƒãƒ¼ãƒ‰ï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ï¼‰ */}
                                {animationPhase >= 1 && primaryNodes.map((node, i) => (
                                    <g key={`primary-${i}`}>
                                        <circle 
                                            cx={node.x} cy={node.y} r="8"
                                            fill={node.isBelieving ? '#ef4444' : '#a5b4fc'}
                                            stroke={node.isBelieving ? '#fca5a5' : '#c7d2fe'}
                                            strokeWidth="2"
                                            style={{ 
                                                transition: 'all 0.3s',
                                                transform: animationPhase >= 1 ? 'scale(1)' : 'scale(0)'
                                            }}
                                        />
                                    </g>
                                ))}

                                {/* ä¸­å¤®ãƒãƒ¼ãƒ‰ï¼ˆã‚ãªãŸï¼‰ */}
                                <circle 
                                    cx="150" cy="150" r="15"
                                    fill="url(#centerGradient)"
                                    stroke="#fff"
                                    strokeWidth="2"
                                />
                                <text x="150" y="155" textAnchor="middle" fill="white" fontSize="12" fontWeight="bold">
                                    You
                                </text>

                                {/* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© */}
                                <defs>
                                    <linearGradient id="centerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" stopColor="#6366f1" />
                                        <stop offset="100%" stopColor="#a855f7" />
                                    </linearGradient>
                                </defs>
                            </svg>
                        </div>

                        {/* çµ±è¨ˆæƒ…å ± */}
                        <div className="flex-1 space-y-3">
                            <div className="text-xs text-gray-400 mb-2">æ¨å®šæ‹¡æ•£ãƒ‡ãƒ¼ã‚¿</div>
                            
                            <div className="bg-white/5 rounded-xl p-3">
                                <div className="flex justify-between items-center">
                                    <span className="text-sm text-gray-400">ç·ãƒªãƒ¼ãƒ</span>
                                    <span className="text-lg font-bold text-indigo-400">
                                        {animationPhase >= 4 ? totalReach.toLocaleString() : '---'}
                                    </span>
                                </div>
                                <div className="text-xs text-gray-500 mt-1">
                                    1æ¬¡: {primaryReach} â†’ 2æ¬¡: {secondaryReach.toLocaleString()} â†’ 3æ¬¡: {tertiaryReach.toLocaleString()}
                                </div>
                            </div>

                            {isManipulative && (
                                <div className="bg-red-500/10 border border-red-500/30 rounded-xl p-3">
                                    <div className="flex justify-between items-center">
                                        <span className="text-sm text-red-300">èª¤æƒ…å ±ã‚’ä¿¡ã˜ãŸäºº</span>
                                        <span className="text-lg font-bold text-red-400">
                                            {animationPhase >= 4 ? `ç´„${totalBelievers.toLocaleString()}äºº` : '---'}
                                        </span>
                                    </div>
                                    <div className="text-xs text-red-400/70 mt-1">
                                        æ“ä½œçš„ãªæŠ€æ³•ã«ã‚ˆã‚Šã€{Math.round(believerRate * 100)}%ãŒå½±éŸ¿ã‚’å—ã‘ã¾ã—ãŸ
                                    </div>
                                </div>
                            )}

                            {!isManipulative && (
                                <div className="bg-green-500/10 border border-green-500/30 rounded-xl p-3">
                                    <div className="flex justify-between items-center">
                                        <span className="text-sm text-green-300">æ­£ç¢ºãªæƒ…å ±ã®æ‹¡æ•£</span>
                                        <span className="text-lg font-bold text-green-400">âœ“</span>
                                    </div>
                                    <div className="text-xs text-green-400/70 mt-1">
                                        èª å®ŸãªæŠ•ç¨¿ã¯ä¿¡é ¼æ€§ã‚’ç¶­æŒã—ãŸã¾ã¾åºƒãŒã‚Šã¾ã™
                                    </div>
                                </div>
                            )}

                            <div className="flex gap-3 text-xs">
                                <div className="flex items-center gap-1">
                                    <span className="w-3 h-3 rounded-full bg-indigo-400"></span>
                                    <span className="text-gray-400">æ­£å¸¸ãªæ‹¡æ•£</span>
                                </div>
                                <div className="flex items-center gap-1">
                                    <span className="w-3 h-3 rounded-full bg-red-400"></span>
                                    <span className="text-gray-400">èª¤æƒ…å ±ã‚’ä¿¡ã˜ãŸäºº</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ã‚¤ãƒ³ãƒˆãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç”»é¢
        const Introduction = ({ onStart }) => {
            const [showTechniques, setShowTechniques] = useState(false);

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="max-w-2xl w-full animate-fade-in">
                        <div className="glass rounded-3xl p-8 md:p-12">
                            <div className="text-center mb-8">
                                <h1 className="text-4xl md:text-5xl font-black mb-4 bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                                    ã‚¤ãƒ³ãƒ•ã‚©ãƒ‡ãƒŸãƒƒã‚¯ãƒ»ã‚¯ãƒ­ãƒ‹ã‚¯ãƒ«
                                </h1>
                                <p className="text-gray-400 text-lg">
                                    æƒ…å ±æ“ä½œã®ãƒ¬ãƒˆãƒªãƒƒã‚¯ã‚’è¦‹ç ´ã‚Šã€ä½“é¨“ã™ã‚‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ 
                                </p>
                            </div>

                            <div className="space-y-6 mb-8">
                                <div className="bg-white/5 rounded-2xl p-6">
                                    <h2 className="text-xl font-bold mb-3 flex items-center gap-2">
                                        <span className="text-2xl">ğŸ¯</span> ã“ã®ã‚²ãƒ¼ãƒ ã®ç›®çš„
                                    </h2>
                                    <p className="text-gray-300 leading-relaxed">
                                        SNSä¸Šã§æ‹¡æ•£ã•ã‚Œã‚‹å¥åº·æƒ…å ±ã«ã¯ã€æ§˜ã€…ãª<strong className="text-purple-400">ãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•</strong>ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚
                                        ã“ã®ã‚²ãƒ¼ãƒ ã§ã¯ã€ãã‚Œã‚‰ã®æŠ€æ³•ã‚’<strong className="text-indigo-400">è¦‹ç ´ã‚‹åŠ›</strong>ã¨ã€
                                        <strong className="text-pink-400">ä½¿ã†å´ã®è¦–ç‚¹</strong>ã‚’ä½“é¨“ã™ã‚‹ã“ã¨ã§ã€
                                        æƒ…å ±æ“ä½œã¸ã®æŠµæŠ—åŠ›ã‚’èº«ã«ã¤ã‘ã¾ã™ã€‚
                                    </p>
                                </div>

                                <div className="bg-white/5 rounded-2xl p-6">
                                    <h2 className="text-xl font-bold mb-3 flex items-center gap-2">
                                        <span className="text-2xl">ğŸ“‹</span> ã‚²ãƒ¼ãƒ ã®æµã‚Œ
                                    </h2>
                                    <div className="space-y-3">
                                        <div className="flex items-start gap-3">
                                            <span className="bg-indigo-500/30 text-indigo-300 rounded-full w-8 h-8 flex items-center justify-center font-bold shrink-0">1</span>
                                            <div>
                                                <p className="font-medium">Stage 1: è¦‹ç ´ã‚‹</p>
                                                <p className="text-sm text-gray-400">SNSæŠ•ç¨¿ã«éš ã•ã‚ŒãŸãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•ã‚’è­˜åˆ¥ã—ã¾ã™ï¼ˆ10å•ï¼‰</p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <span className="bg-purple-500/30 text-purple-300 rounded-full w-8 h-8 flex items-center justify-center font-bold shrink-0">2</span>
                                            <div>
                                                <p className="font-medium">Stage 2: ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ä½“é¨“</p>
                                                <p className="text-sm text-gray-400">æ”»æ’ƒè€…ã®è¦–ç‚¹ã§æŠ•ç¨¿ã‚’é¸ã³ã€ãã®åŠ¹æœã‚’ä½“é¨“ã—ã¾ã™ï¼ˆ5ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰</p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <span className="bg-cyan-500/30 text-cyan-300 rounded-full w-8 h-8 flex items-center justify-center font-bold shrink-0">3</span>
                                            <div>
                                                <p className="font-medium">Stage 3: æƒ…å ±æ¤œè¨¼è¨“ç·´</p>
                                                <p className="text-sm text-gray-400">æ“ä½œçš„æŠ•ç¨¿ã‚’å¤–éƒ¨ã§æ¤œè¨¼ã™ã‚‹ã‚¹ã‚­ãƒ«ã‚’è¨“ç·´ï¼ˆ3ã‚·ãƒŠãƒªã‚ªï¼‰</p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <span className="bg-green-500/30 text-green-300 rounded-full w-8 h-8 flex items-center justify-center font-bold shrink-0">âœ“</span>
                                            <div>
                                                <p className="font-medium">æœ€çµ‚è©•ä¾¡</p>
                                                <p className="text-sm text-gray-400">ã‚ãªãŸã®è­˜åˆ¥èƒ½åŠ›ã¨è¡Œå‹•ã®æŒ¯ã‚Šè¿”ã‚Š</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <button 
                                    onClick={() => setShowTechniques(!showTechniques)}
                                    className="w-full text-left bg-white/5 rounded-2xl p-6 hover:bg-white/10 transition-colors"
                                >
                                    <h2 className="text-xl font-bold mb-1 flex items-center justify-between">
                                        <span className="flex items-center gap-2">
                                            <span className="text-2xl">ğŸ”</span> 6ã¤ã®ãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•
                                        </span>
                                        <span className="text-gray-400">{showTechniques ? 'â–²' : 'â–¼'}</span>
                                    </h2>
                                    <p className="text-sm text-gray-400">ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’ç¢ºèª</p>
                                </button>

                                {showTechniques && (
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 animate-fade-in">
                                        {Object.values(TECHNIQUES).map(tech => (
                                            <div 
                                                key={tech.id}
                                                className={`${tech.bgColor} border ${tech.borderColor} rounded-xl p-4`}
                                            >
                                                <h3 className={`font-bold ${tech.textColor}`}>{tech.name}</h3>
                                                <p className="text-sm text-gray-300 mt-1">{tech.description}</p>
                                                <p className="text-xs text-gray-400 mt-2 italic">ä¾‹: {tech.example}</p>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>

                            <button
                                onClick={onStart}
                                className="w-full btn-primary text-white font-bold py-4 px-8 rounded-2xl text-lg"
                            >
                                ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹
                            </button>

                            <p className="text-center text-gray-500 text-sm mt-4">
                                æ‰€è¦æ™‚é–“: ç´„25-35åˆ†
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // åé§ãƒ•ã‚§ãƒ¼ã‚ºç”¨ã®æŠ•ç¨¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆå±•é–‹/æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ä»˜ãï¼‰
        const RebuttalPostPreview = ({ account, text }) => {
            const [isExpanded, setIsExpanded] = useState(false);
            const isLongText = text.length > 100 || text.split('\n').length > 4;
            
            return (
                <div className="bg-white/5 rounded-xl p-4 mb-6 border border-white/10">
                    <div className="flex items-center gap-2 mb-2">
                        {account && (
                            <span className="text-sm text-gray-400">{account}</span>
                        )}
                    </div>
                    <div className="relative">
                        <p className={`text-sm text-gray-300 whitespace-pre-line ${!isExpanded && isLongText ? 'line-clamp-3' : ''}`}>
                            {text}
                        </p>
                        {isLongText && (
                            <button
                                onClick={() => setIsExpanded(!isExpanded)}
                                className="mt-2 text-indigo-400 hover:text-indigo-300 text-sm font-medium flex items-center gap-1 transition-colors"
                            >
                                {isExpanded ? (
                                    <>
                                        <span>â–²</span>
                                        <span>æŠ˜ã‚ŠãŸãŸã‚€</span>
                                    </>
                                ) : (
                                    <>
                                        <span>â–¼</span>
                                        <span>å…¨æ–‡ã‚’è¡¨ç¤º</span>
                                    </>
                                )}
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        // Stage1: è¦‹ç ´ã‚‹
        const Stage1 = ({ onComplete }) => {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [questions] = useState(() => shuffle(STAGE1_QUESTIONS));
            const [answers, setAnswers] = useState([]);
            const [phase, setPhase] = useState('question'); // 'question' | 'rebuttal' | 'feedback'
            const [lastAnswer, setLastAnswer] = useState(null);
            const [streak, setStreak] = useState(0);
            const [score, setScore] = useState(0);
            const [showTechniqueHelp, setShowTechniqueHelp] = useState(false);
            const [selectedProblems, setSelectedProblems] = useState([]);
            const [rebuttalResult, setRebuttalResult] = useState(null);

            const currentQuestion = questions[currentIndex];
            const hasTechnique = currentQuestion.techniques.length > 0;

            // å•é¡Œç‚¹ã®é¸æŠè‚¢
            const PROBLEM_OPTIONS = [
                { id: 'fear', label: 'ä¸å®‰ã‚„ææ€–ã‚’ç…½ã£ã¦ã„ã‚‹', icon: 'ğŸ˜°' },
                { id: 'authority', label: 'æ¨©å¨ã‚„è‚©æ›¸ãã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹', icon: 'ğŸ‘”' },
                { id: 'pseudoscience', label: 'ç§‘å­¦çš„ã«è¦‹ã›ã‹ã‘ã¦ã„ã‚‹ãŒæ ¹æ‹ ãŒæ›–æ˜§', icon: 'ğŸ”¬' },
                { id: 'testimonial', label: 'å€‹äººã®ä½“é¨“è«‡ã‚’ä¸€èˆ¬åŒ–ã—ã¦ã„ã‚‹', icon: 'ğŸ’¬' },
                { id: 'bandwagon', label: 'ã€Œã¿ã‚“ãªãŒã‚„ã£ã¦ã„ã‚‹ã€ã¨ã„ã†åŒèª¿åœ§åŠ›', icon: 'ğŸŒŠ' },
                { id: 'polarization', label: 'æ•µvså‘³æ–¹ã®äºŒé …å¯¾ç«‹ã‚’ä½œã£ã¦ã„ã‚‹', icon: 'âš”ï¸' }
            ];

            // ç¬¬1æ®µéšï¼šãƒ¬ãƒˆãƒªãƒƒã‚¯ã®æœ‰ç„¡ã‚’åˆ¤å®š
            const handleFirstAnswer = (userSaidHasTechnique) => {
                if (userSaidHasTechnique && hasTechnique) {
                    // æ­£è§£ã‹ã¤ãƒ¬ãƒˆãƒªãƒƒã‚¯ã‚ã‚Š â†’ åé§ãƒ•ã‚§ãƒ¼ã‚ºã¸
                    setPhase('rebuttal');
                } else {
                    // ä¸æ­£è§£ã€ã¾ãŸã¯ãƒ¬ãƒˆãƒªãƒƒã‚¯ãªã—ã¨æ­£ã—ãåˆ¤å®š â†’ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¸
                    const isCorrect = userSaidHasTechnique === hasTechnique;
                    const basePoints = 15;
                    const streakBonus = isCorrect ? 1 + streak * 0.2 : 0;
                    const points = isCorrect ? Math.round(basePoints * streakBonus) : 0;

                    const answer = {
                        questionId: currentQuestion.id,
                        userAnswer: userSaidHasTechnique,
                        correct: isCorrect,
                        points,
                        techniques: currentQuestion.techniques,
                        rebuttalCorrect: null,
                        selectedProblems: []
                    };

                    setAnswers(prev => [...prev, answer]);
                    setLastAnswer(answer);
                    setPhase('feedback');
                    
                    if (isCorrect) {
                        setStreak(prev => prev + 1);
                        setScore(prev => prev + points);
                    } else {
                        setStreak(0);
                    }
                }
            };

            // å•é¡Œç‚¹ã®é¸æŠã‚’ãƒˆã‚°ãƒ«
            const toggleProblem = (problemId) => {
                setSelectedProblems(prev => 
                    prev.includes(problemId)
                        ? prev.filter(p => p !== problemId)
                        : [...prev, problemId]
                );
            };

            // ç¬¬2æ®µéšï¼šåé§ã‚’ç¢ºå®š
            const handleRebuttalSubmit = () => {
                const correctTechniques = currentQuestion.techniques;
                const selected = selectedProblems;
                
                // å®Œå…¨ä¸€è‡´ãƒœãƒ¼ãƒŠã‚¹ã€éƒ¨åˆ†ä¸€è‡´ã§ã‚‚åŠ ç‚¹
                const correctSelections = selected.filter(s => correctTechniques.includes(s));
                const wrongSelections = selected.filter(s => !correctTechniques.includes(s));
                const missedTechniques = correctTechniques.filter(t => !selected.includes(t));
                
                const isFullyCorrect = correctSelections.length === correctTechniques.length && wrongSelections.length === 0;
                const isPartiallyCorrect = correctSelections.length > 0;
                
                // ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—
                let basePoints = 15; // æ¤œå‡ºæˆåŠŸåˆ†
                let rebuttalBonus = 0;
                
                if (isFullyCorrect) {
                    rebuttalBonus = 20; // å®Œå…¨ä¸€è‡´ãƒœãƒ¼ãƒŠã‚¹
                } else if (isPartiallyCorrect) {
                    rebuttalBonus = Math.round(10 * (correctSelections.length / correctTechniques.length));
                }
                // é–“é•ã£ãŸé¸æŠã¯ãƒšãƒŠãƒ«ãƒ†ã‚£
                rebuttalBonus -= wrongSelections.length * 3;
                rebuttalBonus = Math.max(0, rebuttalBonus);
                
                const streakBonus = 1 + streak * 0.2;
                const points = Math.round((basePoints + rebuttalBonus) * streakBonus);

                const answer = {
                    questionId: currentQuestion.id,
                    userAnswer: true,
                    correct: true,
                    points,
                    techniques: currentQuestion.techniques,
                    rebuttalCorrect: isFullyCorrect,
                    rebuttalPartial: isPartiallyCorrect && !isFullyCorrect,
                    selectedProblems: selected,
                    correctSelections,
                    wrongSelections,
                    missedTechniques
                };

                setRebuttalResult({
                    isFullyCorrect,
                    isPartiallyCorrect,
                    correctSelections,
                    wrongSelections,
                    missedTechniques,
                    rebuttalBonus
                });

                setAnswers(prev => [...prev, answer]);
                setLastAnswer(answer);
                setPhase('feedback');
                setStreak(prev => prev + 1);
                setScore(prev => prev + points);
            };

            const handleNext = () => {
                setPhase('question');
                setSelectedProblems([]);
                setRebuttalResult(null);
                
                if (currentIndex < questions.length - 1) {
                    setCurrentIndex(prev => prev + 1);
                } else {
                    const finalAnswers = [...answers, lastAnswer];
                    
                    const techMistakes = {};
                    finalAnswers.forEach(a => {
                        if (!a.correct) {
                            a.techniques.forEach(t => {
                                techMistakes[t] = (techMistakes[t] || 0) + 1;
                            });
                        }
                        // åé§ã§è¦‹é€ƒã—ãŸæŠ€æ³•ã‚‚ã‚«ã‚¦ãƒ³ãƒˆ
                        if (a.missedTechniques) {
                            a.missedTechniques.forEach(t => {
                                techMistakes[t] = (techMistakes[t] || 0) + 0.5;
                            });
                        }
                    });

                    const weakTechniques = Object.entries(techMistakes)
                        .sort((a, b) => b[1] - a[1])
                        .slice(0, 3)
                        .map(([tech]) => tech);

                    const correctCount = finalAnswers.filter(a => a.correct).length;
                    const finalScore = finalAnswers.reduce((sum, a) => sum + (a.points || 0), 0);
                    const rebuttalStats = {
                        total: finalAnswers.filter(a => a.rebuttalCorrect !== null).length,
                        fullyCorrect: finalAnswers.filter(a => a.rebuttalCorrect === true).length,
                        partiallyCorrect: finalAnswers.filter(a => a.rebuttalPartial === true).length
                    };

                    onComplete({
                        answers: finalAnswers,
                        score: finalScore,
                        accuracy: Math.round((correctCount / questions.length) * 100),
                        weakTechniques,
                        rebuttalStats
                    });
                }
            };

            const progress = ((currentIndex + 1) / questions.length) * 100;

            return (
                <div className="min-h-screen p-4 flex flex-col">
                    {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                    <div className="max-w-2xl w-full mx-auto mb-4">
                        <div className="glass rounded-2xl p-4">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-sm text-gray-400">Stage 1: è¦‹ç ´ã‚‹</span>
                                <div className="flex items-center gap-3">
                                    <button
                                        onClick={() => setShowTechniqueHelp(true)}
                                        className="text-xs bg-indigo-500/20 hover:bg-indigo-500/30 text-indigo-300 px-3 py-1 rounded-full transition-all flex items-center gap-1"
                                    >
                                        <span>ğŸ“–</span>
                                        <span>æŠ€æ³•ä¸€è¦§</span>
                                    </button>
                                    <span className="text-sm text-gray-400">{currentIndex + 1} / {questions.length}</span>
                                </div>
                            </div>
                            <div className="h-2 bg-white/10 rounded-full overflow-hidden">
                                <div className="progress-bar h-full rounded-full" style={{ width: `${progress}%` }}></div>
                            </div>
                            <div className="flex justify-between mt-2 text-sm">
                                <span className="text-indigo-400">ã‚¹ã‚³ã‚¢: {score}</span>
                                {streak > 1 && <span className="text-yellow-400">ğŸ”¥ {streak}é€£ç¶šæ­£è§£!</span>}
                            </div>
                        </div>
                    </div>

                    {/* ãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•ãƒ˜ãƒ«ãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                    {showTechniqueHelp && (
                        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4" onClick={() => setShowTechniqueHelp(false)}>
                            <div className="bg-slate-800 rounded-3xl p-6 max-w-2xl w-full max-h-[85vh] overflow-y-auto scrollbar-hide animate-fade-in" onClick={e => e.stopPropagation()}>
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-xl font-bold flex items-center gap-2">
                                        <span>ğŸ“–</span>
                                        6ã¤ã®ãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•
                                    </h2>
                                    <button
                                        onClick={() => setShowTechniqueHelp(false)}
                                        className="text-gray-400 hover:text-white text-2xl leading-none"
                                    >
                                        Ã—
                                    </button>
                                </div>
                                
                                <p className="text-gray-400 text-sm mb-4">
                                    ä»¥ä¸‹ã®æŠ€æ³•ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹æŠ•ç¨¿ã¯ã€Œãƒ¬ãƒˆãƒªãƒƒã‚¯æ¤œå‡ºã€ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚
                                </p>

                                <div className="space-y-4">
                                    {Object.values(TECHNIQUES).map(tech => {
                                        const icons = {
                                            fear: 'ğŸ˜±',
                                            authority: 'ğŸ‘”',
                                            pseudoscience: 'ğŸ”¬',
                                            testimonial: 'ğŸ’¬',
                                            polarization: 'âš”ï¸',
                                            bandwagon: 'ğŸš‚'
                                        };
                                        return (
                                            <div key={tech.id} className={`rounded-xl p-4 border ${tech.borderColor} ${tech.bgColor}`}>
                                                <div className="flex items-center gap-3 mb-2">
                                                    <span className="text-2xl">{icons[tech.id]}</span>
                                                    <h3 className={`font-bold text-lg ${tech.textColor}`}>{tech.name}</h3>
                                                </div>
                                                <p className="text-gray-300 text-sm mb-3">{tech.description}</p>
                                                <div className={`${tech.bgColor} rounded-lg p-3 border ${tech.borderColor}/30`}>
                                                    <p className="text-xs text-gray-400 mb-1">ğŸ’¡ ä¾‹:</p>
                                                    <p className={`text-sm ${tech.textColor} font-medium`}>"{tech.example}"</p>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                <button
                                    onClick={() => setShowTechniqueHelp(false)}
                                    className="w-full mt-6 btn-primary text-white font-bold py-3 rounded-xl"
                                >
                                    é–‰ã˜ã‚‹
                                </button>
                            </div>
                        </div>
                    )}

                    {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                    <div className="flex-1 flex items-center justify-center">
                        <div className="max-w-2xl w-full">
                            {/* Phase 1: æŠ•ç¨¿ã‚’è¦‹ã¦åˆ¤å®š */}
                            {phase === 'question' && (
                                <div className="animate-fade-in">
                                    <div className="glass rounded-3xl p-6 md:p-8 mb-6">
                                        <div className="flex items-center gap-2 mb-4">
                                            <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                                                currentQuestion.difficulty === 'easy' ? 'bg-green-500/20 text-green-400' :
                                                currentQuestion.difficulty === 'medium' ? 'bg-yellow-500/20 text-yellow-400' :
                                                currentQuestion.difficulty === 'hard' ? 'bg-orange-500/20 text-orange-400' :
                                                'bg-red-500/20 text-red-400'
                                            }`}>
                                                {currentQuestion.difficulty === 'easy' ? 'æ˜“ã—ã„' :
                                                 currentQuestion.difficulty === 'medium' ? 'æ™®é€š' :
                                                 currentQuestion.difficulty === 'hard' ? 'é›£ã—ã„' : 'éå¸¸ã«é›£ã—ã„'}
                                            </span>
                                        </div>
                                        
                                        <div className="bg-white/5 rounded-2xl p-5 mb-6">
                                            {/* SNSé¢¨ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                                            {currentQuestion.account && (
                                                <div className="flex items-center gap-3 mb-3 pb-3 border-b border-white/10">
                                                    <div className="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-lg">
                                                        {currentQuestion.account.charAt(0)}
                                                    </div>
                                                    <div>
                                                        <p className="font-bold text-sm">{currentQuestion.account}</p>
                                                        <p className="text-xs text-gray-500">{currentQuestion.accountId}</p>
                                                    </div>
                                                </div>
                                            )}
                                            <p className="text-lg leading-relaxed whitespace-pre-line">
                                                {currentQuestion.text}
                                            </p>
                                        </div>

                                        <p className="text-center text-gray-400 mb-6">
                                            ã“ã®æŠ•ç¨¿ã«ãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•ã¯ä½¿ã‚ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ
                                        </p>

                                        <div className="grid grid-cols-2 gap-4">
                                            <button
                                                onClick={() => handleFirstAnswer(false)}
                                                className="btn-success text-white font-bold py-4 px-6 rounded-2xl text-lg"
                                            >
                                                âœ“ å•é¡Œãªã—
                                            </button>
                                            <button
                                                onClick={() => handleFirstAnswer(true)}
                                                className="btn-danger text-white font-bold py-4 px-6 rounded-2xl text-lg"
                                            >
                                                âš  ãƒ¬ãƒˆãƒªãƒƒã‚¯æ¤œå‡º!
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Phase 2: åé§ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆå•é¡Œç‚¹ã®æŒ‡æ‘˜ï¼‰ */}
                            {phase === 'rebuttal' && (
                                <div className="animate-fade-in">
                                    <div className="glass rounded-3xl p-6 md:p-8 mb-6 border-2 border-indigo-500">
                                        <div className="text-center mb-6">
                                            <div className="text-4xl mb-2">ğŸ”</div>
                                            <h3 className="text-xl font-bold text-indigo-400">åé§ãƒ•ã‚§ãƒ¼ã‚º</h3>
                                            <p className="text-gray-400 text-sm mt-2">
                                                ã“ã®æŠ•ç¨¿ã®å•é¡Œç‚¹ã‚’æŒ‡æ‘˜ã—ã¦ãã ã•ã„ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰
                                            </p>
                                        </div>

                                        {/* æŠ•ç¨¿ã®å†è¡¨ç¤ºï¼ˆå±•é–‹å¯èƒ½ç‰ˆï¼‰ */}
                                        <RebuttalPostPreview 
                                            account={currentQuestion.account}
                                            text={currentQuestion.text}
                                        />

                                        {/* å•é¡Œç‚¹ã®é¸æŠè‚¢ */}
                                        <div className="space-y-3 mb-6">
                                            {PROBLEM_OPTIONS.map(option => {
                                                const isSelected = selectedProblems.includes(option.id);
                                                return (
                                                    <button
                                                        key={option.id}
                                                        onClick={() => toggleProblem(option.id)}
                                                        className={`w-full text-left p-4 rounded-xl border-2 transition-all ${
                                                            isSelected
                                                                ? 'border-indigo-500 bg-indigo-500/20'
                                                                : 'border-white/10 bg-white/5 hover:border-white/30'
                                                        }`}
                                                    >
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-2xl">{option.icon}</span>
                                                            <span className={`font-medium ${isSelected ? 'text-indigo-300' : 'text-gray-300'}`}>
                                                                {option.label}
                                                            </span>
                                                            {isSelected && (
                                                                <span className="ml-auto text-indigo-400">âœ“</span>
                                                            )}
                                                        </div>
                                                    </button>
                                                );
                                            })}
                                        </div>

                                        <button
                                            onClick={handleRebuttalSubmit}
                                            disabled={selectedProblems.length === 0}
                                            className={`w-full font-bold py-4 px-8 rounded-2xl text-lg transition-all ${
                                                selectedProblems.length > 0
                                                    ? 'btn-primary text-white'
                                                    : 'bg-gray-600 text-gray-400 cursor-not-allowed'
                                            }`}
                                        >
                                            {selectedProblems.length > 0 
                                                ? `ç¢ºå®šã™ã‚‹ï¼ˆ${selectedProblems.length}å€‹é¸æŠä¸­ï¼‰`
                                                : 'å•é¡Œç‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„'}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Phase 3: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ */}
                            {phase === 'feedback' && lastAnswer && (
                                <div className="animate-fade-in">
                                    <div className={`glass rounded-3xl p-6 md:p-8 border-2 ${
                                        lastAnswer.correct ? 'border-green-500' : 'border-red-500'
                                    }`}>
                                        <div className="text-center mb-6">
                                            <div className={`text-6xl mb-2 ${lastAnswer.correct ? 'animate-pulse-once' : ''}`}>
                                                {lastAnswer.correct ? 'âœ“' : 'âœ—'}
                                            </div>
                                            <h3 className={`text-2xl font-bold ${
                                                lastAnswer.correct ? 'text-green-400' : 'text-red-400'
                                            }`}>
                                                {lastAnswer.correct ? 'æ­£è§£!' : 'ä¸æ­£è§£...'}
                                            </h3>
                                            {lastAnswer.correct && lastAnswer.points > 0 && (
                                                <p className="text-yellow-400 mt-1">
                                                    +{lastAnswer.points}ç‚¹
                                                    {rebuttalResult?.rebuttalBonus > 0 && ` (åé§ãƒœãƒ¼ãƒŠã‚¹+${rebuttalResult.rebuttalBonus})`}
                                                    {streak > 1 && ' é€£ç¶šãƒœãƒ¼ãƒŠã‚¹!'}
                                                </p>
                                            )}
                                        </div>

                                        {/* åé§çµæœã®è¡¨ç¤º */}
                                        {rebuttalResult && (
                                            <div className={`rounded-xl p-4 mb-4 ${
                                                rebuttalResult.isFullyCorrect 
                                                    ? 'bg-green-500/20 border border-green-500/50' 
                                                    : rebuttalResult.isPartiallyCorrect
                                                        ? 'bg-yellow-500/20 border border-yellow-500/50'
                                                        : 'bg-red-500/20 border border-red-500/50'
                                            }`}>
                                                <h4 className="font-bold mb-2 flex items-center gap-2">
                                                    {rebuttalResult.isFullyCorrect ? (
                                                        <><span>ğŸ¯</span><span className="text-green-400">å®Œç’§ãªåˆ†æ!</span></>
                                                    ) : rebuttalResult.isPartiallyCorrect ? (
                                                        <><span>ğŸ”¶</span><span className="text-yellow-400">éƒ¨åˆ†çš„ã«æ­£è§£</span></>
                                                    ) : (
                                                        <><span>âŒ</span><span className="text-red-400">åˆ†æãƒŸã‚¹</span></>
                                                    )}
                                                </h4>
                                                
                                                {rebuttalResult.correctSelections.length > 0 && (
                                                    <p className="text-sm text-green-300 mb-1">
                                                        âœ“ æ­£ã—ãæŒ‡æ‘˜: {rebuttalResult.correctSelections.map(t => TECHNIQUES[t]?.name).join(', ')}
                                                    </p>
                                                )}
                                                {rebuttalResult.missedTechniques.length > 0 && (
                                                    <p className="text-sm text-yellow-300 mb-1">
                                                        â–³ è¦‹é€ƒã—: {rebuttalResult.missedTechniques.map(t => TECHNIQUES[t]?.name).join(', ')}
                                                    </p>
                                                )}
                                                {rebuttalResult.wrongSelections.length > 0 && (
                                                    <p className="text-sm text-red-300">
                                                        âœ— èª¤é¸æŠ: {rebuttalResult.wrongSelections.map(t => TECHNIQUES[t]?.name).join(', ')}
                                                    </p>
                                                )}
                                            </div>
                                        )}

                                        <div className="bg-white/5 rounded-2xl p-5 mb-6">
                                            <h4 className="font-bold mb-3">ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹æŠ€æ³•:</h4>
                                            {currentQuestion.techniques.length > 0 ? (
                                                <div className="flex flex-wrap gap-2 mb-4">
                                                    {currentQuestion.techniques.map(tech => (
                                                        <TechniqueTag key={tech} techniqueId={tech} />
                                                    ))}
                                                </div>
                                            ) : (
                                                <p className="text-gray-400 mb-4">ãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•ã¯ä½¿ã‚ã‚Œã¦ã„ã¾ã›ã‚“</p>
                                            )}
                                            
                                            <h4 className="font-bold mb-2">è§£èª¬:</h4>
                                            <p className="text-gray-300 leading-relaxed">
                                                {currentQuestion.explanation}
                                            </p>
                                        </div>

                                        <button
                                            onClick={handleNext}
                                            className="w-full btn-primary text-white font-bold py-4 px-8 rounded-2xl text-lg"
                                        >
                                            {currentIndex < questions.length - 1 ? 'æ¬¡ã®å•é¡Œã¸' : 'Stage 2ã¸é€²ã‚€'}
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Stage3: ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼è‚²æˆ
        const Stage3 = ({ stage1Data, onComplete }) => {
            const [round, setRound] = useState(0);
            const [phase, setPhase] = useState('target'); // target, post, result, criticism, suspended
            const [selectedTarget, setSelectedTarget] = useState(null);
            const [selectedPost, setSelectedPost] = useState(null);
            const [followers, setFollowers] = useState(100);
            const [ethics, setEthics] = useState(70);
            const [results, setResults] = useState([]);
            const [currentResult, setCurrentResult] = useState(null);
            const [showCriticism, setShowCriticism] = useState(false);
            const [criticismHandled, setCriticismHandled] = useState(false);
            const [criticismResult, setCriticismResult] = useState(null);
            const [isSuspended, setIsSuspended] = useState(false); // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‡çµçŠ¶æ…‹

            const currentPosts = STAGE3_POSTS[round];

            const handleTargetSelect = (targetId) => {
                setSelectedTarget(targetId);
            };

            const handlePostSelect = (post) => {
                setSelectedPost(post);
            };

            const confirmPost = () => {
                if (!selectedTarget || !selectedPost) return;

                const target = TARGETS[selectedTarget];
                const targetEffect = selectedPost.targetEffects[selectedTarget] || 1;
                const randomFactor = randomBetween(0.8, 1.2);
                const finalInfluence = Math.round(selectedPost.influence * targetEffect * randomFactor);

                const newFollowers = Math.round(finalInfluence * (8 + Math.random() * 4));
                const likes = Math.round(finalInfluence * (12 + Math.random() * 8));
                const shares = Math.round(finalInfluence * (6 + Math.random() * 4));
                const newEthics = Math.max(0, Math.min(100, ethics + selectedPost.ethics));

                // SNSåå¿œã®ç”Ÿæˆ
                const reactions = [];
                const hasManipulativeTech = selectedPost.techniques.length > 0;
                const targetReactions = SNS_REACTIONS.target[selectedTarget];
                
                if (hasManipulativeTech) {
                    // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ã‹ã‚‰ã®ãƒã‚¸ãƒ†ã‚£ãƒ–åå¿œï¼ˆæ“ä½œçš„ãªæŠ•ç¨¿ãŒåŠ¹ã„ãŸï¼‰
                    if (targetReactions?.positive) {
                        reactions.push(targetReactions.positive[Math.floor(Math.random() * targetReactions.positive.length)]);
                    }
                    // ä¿¡è€…çš„åå¿œ
                    reactions.push(SNS_REACTIONS.believer[Math.floor(Math.random() * SNS_REACTIONS.believer.length)]);
                    // æ‹¡æ•£è€…
                    if (finalInfluence > 25) {
                        reactions.push(SNS_REACTIONS.sharer[Math.floor(Math.random() * SNS_REACTIONS.sharer.length)]);
                    }
                    // æ‡ç–‘æ´¾ï¼ˆå€«ç†ãŒä½ã„ã»ã©å‡ºã‚„ã™ã„ï¼‰
                    if (newEthics < 50 || Math.random() < 0.3) {
                        reactions.push(SNS_REACTIONS.skeptic[Math.floor(Math.random() * SNS_REACTIONS.skeptic.length)]);
                    }
                    // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ã‹ã‚‰ã®ãƒã‚¬ãƒ†ã‚£ãƒ–åå¿œï¼ˆç¢ºç‡ã§ï¼‰
                    if (targetReactions?.negative && Math.random() < 0.4) {
                        reactions.push(targetReactions.negative[Math.floor(Math.random() * targetReactions.negative.length)]);
                    }
                } else {
                    // ä¸­ç«‹çš„ãªåå¿œ
                    reactions.push(SNS_REACTIONS.neutral[Math.floor(Math.random() * SNS_REACTIONS.neutral.length)]);
                    reactions.push(SNS_REACTIONS.positive[Math.floor(Math.random() * SNS_REACTIONS.positive.length)]);
                    // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ã‹ã‚‰ã‚‚ãƒã‚¸ãƒ†ã‚£ãƒ–ãªåå¿œ
                    if (targetReactions?.positive) {
                        const positiveReaction = {...targetReactions.positive[Math.floor(Math.random() * targetReactions.positive.length)]};
                        positiveReaction.text = positiveReaction.text.replace(/ã‚·ã‚§ã‚¢|åºƒã‚|æ•™ãˆ/g, 'å‚è€ƒã«');
                        reactions.push(positiveReaction);
                    }
                }

                const result = {
                    round: round + 1,
                    target: selectedTarget,
                    post: selectedPost,
                    finalInfluence,
                    newFollowers,
                    likes,
                    shares,
                    ethicsChange: selectedPost.ethics,
                    reactions
                };

                setCurrentResult(result);
                setFollowers(prev => prev + newFollowers);
                setEthics(newEthics);
                setResults(prev => [...prev, result]);
                setPhase('result');

                // ä¿¡é ¼æ€§ãŒ0ã«ãªã£ãŸã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‡çµ
                if (newEthics <= 0) {
                    setIsSuspended(true);
                    return;
                }

                // ãƒ©ã‚¦ãƒ³ãƒ‰2ã¨4ã§æ‰¹åˆ¤ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿï¼ˆå€«ç†ãŒä½ã„å ´åˆï¼‰
                if ((round === 1 || round === 3) && newEthics < 60 && hasManipulativeTech) {
                    setShowCriticism(true);
                }
            };

            const handleCriticismResponse = (response) => {
                const ethicsChange = response.ethics;
                const followersChange = response.influence * 10;
                
                const newEthics = Math.max(0, Math.min(100, ethics + ethicsChange));
                setEthics(newEthics);
                setFollowers(prev => Math.max(0, prev + followersChange));
                setCriticismHandled(true);
                setShowCriticism(false);
                
                // çµæœã‚’ä¿å­˜
                setCriticismResult({
                    response: response,
                    ethicsChange: ethicsChange,
                    followersChange: followersChange
                });

                // æ‰¹åˆ¤å¯¾å¿œå¾Œã«ä¿¡é ¼æ€§ãŒ0ã«ãªã£ãŸã‚‰å‡çµ
                if (newEthics <= 0) {
                    setIsSuspended(true);
                }
            };

            const nextRound = () => {
                if (round < 4) {
                    setRound(prev => prev + 1);
                    setPhase('target');
                    setSelectedTarget(null);
                    setSelectedPost(null);
                    setCurrentResult(null);
                    setCriticismHandled(false);
                    setCriticismResult(null); // ãƒªã‚»ãƒƒãƒˆ
                } else {
                    onComplete({
                        results,
                        totalFollowers: followers,
                        finalEthics: ethics,
                        suspended: false
                    });
                }
            };

            // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‡çµæ™‚ã®å®Œäº†å‡¦ç†
            const handleSuspendedComplete = () => {
                onComplete({
                    results,
                    totalFollowers: followers,
                    finalEthics: 0,
                    suspended: true,
                    suspendedAtRound: round + 1
                });
            };

            return (
                <div className="min-h-screen p-4 flex flex-col">
                    {/* ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‡çµç”»é¢ */}
                    {isSuspended ? (
                        <div className="flex-1 flex items-center justify-center">
                            <div className="max-w-2xl w-full animate-fade-in">
                                <div className="glass rounded-3xl p-8 md:p-12 text-center">
                                    {/* å‡çµã‚¢ã‚¤ã‚³ãƒ³ */}
                                    <div className="mb-6">
                                        <div className="w-24 h-24 mx-auto bg-red-500/20 rounded-full flex items-center justify-center mb-4 animate-pulse">
                                            <span className="text-5xl">ğŸš«</span>
                                        </div>
                                        <h1 className="text-3xl md:text-4xl font-bold text-red-400 mb-2">
                                            ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‡çµ
                                        </h1>
                                        <p className="text-gray-400">Account Suspended</p>
                                    </div>

                                    {/* å‡çµç†ç”± */}
                                    <div className="bg-red-500/10 border border-red-500/30 rounded-2xl p-6 mb-6 text-left">
                                        <h3 className="font-bold text-red-300 mb-3 flex items-center gap-2">
                                            <span>âš ï¸</span>
                                            å‡çµç†ç”±
                                        </h3>
                                        <p className="text-gray-300 leading-relaxed mb-4">
                                            ã‚ãªãŸã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã€<span className="text-red-400 font-bold">ä¿¡é ¼æ€§ã®è‘—ã—ã„ä½ä¸‹</span>ã«ã‚ˆã‚Šå‡çµã•ã‚Œã¾ã—ãŸã€‚
                                        </p>
                                        <ul className="text-sm text-gray-400 space-y-2">
                                            <li className="flex items-start gap-2">
                                                <span className="text-red-400">â€¢</span>
                                                <span>è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã€Œèª¤è§£ã‚’æ‹›ãæƒ…å ±ã€ã¨ã—ã¦å ±å‘Šã•ã‚Œã¾ã—ãŸ</span>
                                            </li>
                                            <li className="flex items-start gap-2">
                                                <span className="text-red-400">â€¢</span>
                                                <span>ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«é•åã™ã‚‹æŠ•ç¨¿ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ</span>
                                            </li>
                                            <li className="flex items-start gap-2">
                                                <span className="text-red-400">â€¢</span>
                                                <span>ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢ãŒåŸºæº–å€¤ã‚’ä¸‹å›ã‚Šã¾ã—ãŸ</span>
                                            </li>
                                        </ul>
                                    </div>

                                    {/* çµ±è¨ˆ */}
                                    <div className="grid grid-cols-3 gap-4 mb-6">
                                        <div className="bg-white/5 rounded-xl p-4">
                                            <p className="text-xs text-gray-400 mb-1">åˆ°é”ãƒ©ã‚¦ãƒ³ãƒ‰</p>
                                            <p className="text-2xl font-bold text-indigo-400">{round + 1} / 5</p>
                                        </div>
                                        <div className="bg-white/5 rounded-xl p-4">
                                            <p className="text-xs text-gray-400 mb-1">æœ€çµ‚ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼</p>
                                            <p className="text-2xl font-bold text-pink-400">{followers.toLocaleString()}</p>
                                        </div>
                                        <div className="bg-white/5 rounded-xl p-4">
                                            <p className="text-xs text-gray-400 mb-1">æœ€çµ‚ä¿¡é ¼æ€§</p>
                                            <p className="text-2xl font-bold text-red-400">0%</p>
                                        </div>
                                    </div>

                                    {/* å­¦ã³ã®ãƒã‚¤ãƒ³ãƒˆ */}
                                    <div className="bg-indigo-500/10 border border-indigo-500/30 rounded-2xl p-6 mb-8 text-left">
                                        <h3 className="font-bold text-indigo-300 mb-3 flex items-center gap-2">
                                            <span>ğŸ’¡</span>
                                            å­¦ã³ã®ãƒã‚¤ãƒ³ãƒˆ
                                        </h3>
                                        <p className="text-gray-300 leading-relaxed">
                                            æ“ä½œçš„ãªãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•ã‚’å¤šç”¨ã™ã‚‹ã¨ã€çŸ­æœŸçš„ã«ã¯ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã‚’å¢—ã‚„ã›ã¾ã™ãŒã€
                                            ä¿¡é ¼æ€§ãŒæ€¥é€Ÿã«ä½ä¸‹ã—ã€æœ€çµ‚çš„ã«ã¯<span className="text-indigo-300 font-bold">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å¤±ã†</span>ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚
                                        </p>
                                        <p className="text-gray-300 leading-relaxed mt-3">
                                            ç¾å®Ÿã®SNSã§ã‚‚ã€èª¤æƒ…å ±ã®æ‹¡æ•£ã¯<span className="text-indigo-300 font-bold">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåœæ­¢</span>ã‚„
                                            <span className="text-indigo-300 font-bold">æ³•çš„è²¬ä»»</span>ã«ã¤ãªãŒã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
                                            å½±éŸ¿åŠ›ã¨è²¬ä»»ã¯è¡¨è£ä¸€ä½“ã§ã™ã€‚
                                        </p>
                                    </div>

                                    {/* çµæœç¢ºèªãƒœã‚¿ãƒ³ */}
                                    <button
                                        onClick={handleSuspendedComplete}
                                        className="btn-primary text-white font-bold py-4 px-8 rounded-2xl text-lg w-full"
                                    >
                                        çµæœã‚’ç¢ºèªã™ã‚‹
                                    </button>
                                </div>
                            </div>
                        </div>
                    ) : (
                    <>
                    {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                    <div className="max-w-3xl w-full mx-auto mb-4">
                        <div className="glass rounded-2xl p-4">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-sm text-gray-400">Stage 2: ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ä½“é¨“</span>
                                <span className="text-sm text-gray-400">ãƒ©ã‚¦ãƒ³ãƒ‰ {round + 1} / 5</span>
                            </div>
                            <div className="h-2 bg-white/10 rounded-full overflow-hidden mb-3">
                                <div className="progress-bar h-full rounded-full" style={{ width: `${((round + 1) / 5) * 100}%` }}></div>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div className="bg-white/5 rounded-xl p-3 text-center">
                                    <p className="text-xs text-gray-400">ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼</p>
                                    <p className="text-2xl font-bold text-indigo-400">{followers.toLocaleString()}</p>
                                </div>
                                <div className="bg-white/5 rounded-xl p-3 text-center">
                                    <p className="text-xs text-gray-400">ä¿¡é ¼æ€§</p>
                                    <p className={`text-2xl font-bold ${ethics >= 50 ? 'text-green-400' : ethics >= 20 ? 'text-yellow-400' : 'text-red-400'}`}>
                                        {ethics}%
                                    </p>
                                    {ethics < 20 && ethics > 0 && (
                                        <p className="text-xs text-red-400 animate-pulse">âš ï¸ å‡çµã®å±é™º</p>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                    <div className="flex-1 flex items-center justify-center">
                        <div className="max-w-3xl w-full">
                            {/* ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¸æŠ */}
                            {phase === 'target' && (
                                <div className="animate-fade-in">
                                    <div className="glass rounded-3xl p-6 md:p-8">
                                        <h2 className="text-2xl font-bold text-center mb-6">
                                            ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’é¸æŠ
                                        </h2>
                                        <p className="text-gray-400 text-center mb-6">
                                            ã©ã®å±¤ã«å‘ã‘ã¦æŠ•ç¨¿ã—ã¾ã™ã‹ï¼Ÿ
                                        </p>

                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                            {Object.values(TARGETS).map(target => (
                                                <button
                                                    key={target.id}
                                                    onClick={() => handleTargetSelect(target.id)}
                                                    className={`card-hover p-5 rounded-2xl text-left transition-all ${
                                                        selectedTarget === target.id
                                                            ? 'bg-indigo-500/30 border-2 border-indigo-500'
                                                            : 'bg-white/5 border-2 border-transparent hover:border-white/20'
                                                    }`}
                                                >
                                                    <div className="text-4xl mb-3">{target.icon}</div>
                                                    <h3 className="font-bold text-lg mb-1">{target.name}</h3>
                                                    <p className="text-sm text-gray-400 mb-2">{target.description}</p>
                                                    <p className="text-xs text-purple-400">{target.traits}</p>
                                                </button>
                                            ))}
                                        </div>

                                        <button
                                            onClick={() => selectedTarget && setPhase('post')}
                                            disabled={!selectedTarget}
                                            className={`w-full font-bold py-4 px-8 rounded-2xl text-lg transition-all ${
                                                selectedTarget
                                                    ? 'btn-primary text-white'
                                                    : 'bg-gray-700 text-gray-500 cursor-not-allowed'
                                            }`}
                                        >
                                            æŠ•ç¨¿ã‚’é¸æŠã¸
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* æŠ•ç¨¿é¸æŠ */}
                            {phase === 'post' && (
                                <div className="animate-fade-in">
                                    <div className="glass rounded-3xl p-6 md:p-8">
                                        <div className="flex items-center justify-between mb-4">
                                            <h2 className="text-2xl font-bold">æŠ•ç¨¿ã‚’é¸æŠ</h2>
                                            <div className="relative group">
                                                <div className="flex items-center gap-2 bg-white/10 rounded-full px-4 py-2 cursor-help border border-transparent group-hover:border-indigo-500/50 transition-all">
                                                    <span className="text-2xl">{TARGETS[selectedTarget].icon}</span>
                                                    <span className="text-sm">{TARGETS[selectedTarget].name}</span>
                                                    <span className="text-xs text-gray-400 ml-1">â„¹ï¸</span>
                                                </div>
                                                {/* ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— */}
                                                <div className="absolute right-0 top-full mt-2 w-80 bg-slate-800 border border-indigo-500/30 rounded-xl p-4 shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                                                    <div className="absolute -top-2 right-6 w-4 h-4 bg-slate-800 border-l border-t border-indigo-500/30 transform rotate-45"></div>
                                                    <h4 className="font-bold text-indigo-300 mb-2 flex items-center gap-2">
                                                        <span>{TARGETS[selectedTarget].icon}</span>
                                                        {TARGETS[selectedTarget].name}
                                                    </h4>
                                                    <p className="text-sm text-gray-300 mb-3">{TARGETS[selectedTarget].description}</p>
                                                    
                                                    <div className="space-y-2">
                                                        <div className="bg-red-500/10 rounded-lg p-2">
                                                            <p className="text-xs font-bold text-red-400 mb-1">âš ï¸ å¼±ç‚¹ï¼ˆåŠ¹ãã‚„ã™ã„ï¼‰</p>
                                                            <div className="flex flex-wrap gap-1">
                                                                {TARGETS[selectedTarget].weaknesses.map(tech => (
                                                                    <span key={tech} className="text-xs bg-red-500/20 text-red-300 px-2 py-0.5 rounded-full">
                                                                        {TECHNIQUES[tech].name}
                                                                    </span>
                                                                ))}
                                                            </div>
                                                        </div>
                                                        <div className="bg-green-500/10 rounded-lg p-2">
                                                            <p className="text-xs font-bold text-green-400 mb-1">ğŸ›¡ï¸ è€æ€§ï¼ˆåŠ¹ãã«ãã„ï¼‰</p>
                                                            <div className="flex flex-wrap gap-1">
                                                                {TARGETS[selectedTarget].resistances.map(tech => (
                                                                    <span key={tech} className="text-xs bg-green-500/20 text-green-300 px-2 py-0.5 rounded-full">
                                                                        {TECHNIQUES[tech].name}
                                                                    </span>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <p className="text-xs text-gray-500 mt-2 italic">
                                                        ğŸ’¡ {TARGETS[selectedTarget].traits}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>

                                        {/* ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç‰¹æ€§ã®ç°¡æ˜“è¡¨ç¤º */}
                                        <div className="bg-white/5 rounded-xl p-3 mb-4 flex flex-wrap items-center gap-2 text-xs">
                                            <span className="text-gray-400">ã“ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¯</span>
                                            {TARGETS[selectedTarget].weaknesses.map(tech => (
                                                <span key={tech} className="bg-red-500/20 text-red-300 px-2 py-0.5 rounded-full">
                                                    {TECHNIQUES[tech].name}
                                                </span>
                                            ))}
                                            <span className="text-gray-400">ã«å¼±ãã€</span>
                                            {TARGETS[selectedTarget].resistances.map(tech => (
                                                <span key={tech} className="bg-green-500/20 text-green-300 px-2 py-0.5 rounded-full">
                                                    {TECHNIQUES[tech].name}
                                                </span>
                                            ))}
                                            <span className="text-gray-400">ã«ã¯è€æ€§ãŒã‚ã‚Šã¾ã™</span>
                                        </div>

                                        <div className="space-y-4 mb-6">
                                            {currentPosts.map((post, index) => (
                                                <button
                                                    key={post.id}
                                                    onClick={() => handlePostSelect(post)}
                                                    className={`w-full card-hover p-5 rounded-2xl text-left transition-all ${
                                                        selectedPost?.id === post.id
                                                            ? 'bg-purple-500/30 border-2 border-purple-500'
                                                            : 'bg-white/5 border-2 border-transparent hover:border-white/20'
                                                    }`}
                                                >
                                                    <div className="flex items-start gap-3">
                                                        <span className="bg-white/10 rounded-full w-8 h-8 flex items-center justify-center font-bold shrink-0">
                                                            {String.fromCharCode(65 + index)}
                                                        </span>
                                                        <p className="text-gray-200 leading-relaxed">{post.text}</p>
                                                    </div>
                                                </button>
                                            ))}
                                        </div>

                                        <div className="flex gap-4">
                                            <button
                                                onClick={() => {
                                                    setPhase('target');
                                                    setSelectedPost(null);
                                                }}
                                                className="flex-1 bg-white/10 hover:bg-white/20 text-white font-bold py-4 px-6 rounded-2xl transition-all"
                                            >
                                                æˆ»ã‚‹
                                            </button>
                                            <button
                                                onClick={confirmPost}
                                                disabled={!selectedPost}
                                                className={`flex-1 font-bold py-4 px-6 rounded-2xl transition-all ${
                                                    selectedPost
                                                        ? 'btn-primary text-white'
                                                        : 'bg-gray-700 text-gray-500 cursor-not-allowed'
                                                }`}
                                            >
                                                æŠ•ç¨¿ã™ã‚‹
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* çµæœè¡¨ç¤º */}
                            {phase === 'result' && currentResult && (
                                <div className="animate-fade-in">
                                    <div className="glass rounded-3xl p-6 md:p-8">
                                        <h2 className="text-2xl font-bold text-center mb-6">æŠ•ç¨¿çµæœ</h2>

                                        {/* ä½¿ç”¨ã—ãŸæŠ€æ³• */}
                                        <div className="bg-white/5 rounded-2xl p-4 mb-4">
                                            <p className="text-sm text-gray-400 mb-2">ä½¿ç”¨ã•ã‚ŒãŸãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•:</p>
                                            {currentResult.post.techniques.length > 0 ? (
                                                <div className="flex flex-wrap gap-2">
                                                    {currentResult.post.techniques.map(tech => (
                                                        <TechniqueTag key={tech} techniqueId={tech} />
                                                    ))}
                                                </div>
                                            ) : (
                                                <p className="text-gray-500">ãªã—ï¼ˆèª å®ŸãªæŠ•ç¨¿ï¼‰</p>
                                            )}
                                        </div>

                                        {/* æŠ€æ³•ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«åŠ¹ã„ãŸç†ç”± */}
                                        {currentResult.post.techniques.length > 0 && (
                                            <div className="bg-gradient-to-r from-purple-500/10 via-indigo-500/10 to-pink-500/10 border border-purple-500/30 rounded-2xl p-4 mb-6">
                                                <p className="text-sm font-bold text-purple-300 mb-3 flex items-center gap-2">
                                                    <span>ğŸ’¡</span>
                                                    ãªãœã€Œ{TARGETS[currentResult.target].name}ã€ã«åŠ¹ã„ãŸã®ã‹ï¼Ÿ
                                                </p>
                                                <div className="space-y-3">
                                                    {currentResult.post.techniques.map(techId => {
                                                        const tech = TECHNIQUES[techId];
                                                        const target = TARGETS[currentResult.target];
                                                        const reason = target.techniqueReasons[techId];
                                                        const isWeak = target.weaknesses.includes(techId);
                                                        const isResist = target.resistances.includes(techId);
                                                        
                                                        return (
                                                            <div key={techId} className={`rounded-xl p-3 ${tech.bgColor} border ${tech.borderColor}`}>
                                                                <div className="flex items-center gap-2 mb-2">
                                                                    <span className={`font-bold ${tech.textColor}`}>{tech.name}</span>
                                                                    {isWeak && (
                                                                        <span className="text-xs bg-red-500/30 text-red-300 px-2 py-0.5 rounded-full">
                                                                            å¼±ç‚¹æŠ€æ³• âš¡
                                                                        </span>
                                                                    )}
                                                                    {isResist && (
                                                                        <span className="text-xs bg-blue-500/30 text-blue-300 px-2 py-0.5 rounded-full">
                                                                            è€æ€§ã‚ã‚Š ğŸ›¡ï¸
                                                                        </span>
                                                                    )}
                                                                </div>
                                                                <p className="text-sm text-gray-300 leading-relaxed">{reason}</p>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        )}

                                        {/* èª å®ŸãªæŠ•ç¨¿ã®å ´åˆã®è§£èª¬ */}
                                        {currentResult.post.techniques.length === 0 && (
                                            <div className="bg-green-500/10 border border-green-500/30 rounded-2xl p-4 mb-6">
                                                <p className="text-sm font-bold text-green-300 mb-2 flex items-center gap-2">
                                                    <span>âœ¨</span>
                                                    èª å®Ÿãªæƒ…å ±ç™ºä¿¡
                                                </p>
                                                <p className="text-sm text-gray-300 leading-relaxed">
                                                    æ“ä½œçš„ãªãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•ã‚’ä½¿ã‚ãªã„æŠ•ç¨¿ã¯ã€çŸ­æœŸçš„ãªæ‹¡æ•£åŠ›ã¯ä½ã„ã§ã™ãŒã€
                                                    é•·æœŸçš„ãªä¿¡é ¼æ€§ã®æ§‹ç¯‰ã«è²¢çŒ®ã—ã¾ã™ã€‚æ‰¹åˆ¤ã‚’å—ã‘ã‚‹ãƒªã‚¹ã‚¯ã‚‚ä½ãã€
                                                    æŒç¶šå¯èƒ½ãªå½±éŸ¿åŠ›ã‚’ç¯‰ãã“ã¨ãŒã§ãã¾ã™ã€‚
                                                </p>
                                            </div>
                                        )}

                                        {/* æ•°å€¤çµæœ */}
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                                            <div className="bg-indigo-500/20 rounded-xl p-4 text-center">
                                                <p className="text-xs text-gray-400">æ–°è¦ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼</p>
                                                <p className="text-xl font-bold text-indigo-400">+{currentResult.newFollowers}</p>
                                            </div>
                                            <div className="bg-pink-500/20 rounded-xl p-4 text-center">
                                                <p className="text-xs text-gray-400">ã„ã„ã­</p>
                                                <p className="text-xl font-bold text-pink-400">{currentResult.likes}</p>
                                            </div>
                                            <div className="bg-cyan-500/20 rounded-xl p-4 text-center">
                                                <p className="text-xs text-gray-400">ã‚·ã‚§ã‚¢</p>
                                                <p className="text-xl font-bold text-cyan-400">{currentResult.shares}</p>
                                            </div>
                                            <div className={`${currentResult.ethicsChange >= 0 ? 'bg-green-500/20' : 'bg-red-500/20'} rounded-xl p-4 text-center`}>
                                                <p className="text-xs text-gray-400">ä¿¡é ¼æ€§</p>
                                                <p className={`text-xl font-bold ${currentResult.ethicsChange >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                    {currentResult.ethicsChange >= 0 ? '+' : ''}{currentResult.ethicsChange}
                                                </p>
                                            </div>
                                        </div>

                                        {/* SNSåå¿œ */}
                                        <div className="bg-white/5 rounded-2xl p-4 mb-6">
                                            <p className="text-sm text-gray-400 mb-3">SNSã®åå¿œ:</p>
                                            <div className="space-y-3">
                                                {currentResult.reactions.map((reaction, i) => (
                                                    <div 
                                                        key={i} 
                                                        className={`flex items-start gap-3 animate-slide-in p-2 rounded-xl ${
                                                            reaction.isTarget 
                                                                ? 'bg-indigo-500/10 border border-indigo-500/30' 
                                                                : ''
                                                        }`}
                                                        style={{ animationDelay: `${i * 0.1}s` }}
                                                    >
                                                        <span className="text-2xl">{reaction.icon}</span>
                                                        <div className="flex-1">
                                                            <div className="flex items-center gap-2">
                                                                <p className="text-sm font-medium text-gray-300">{reaction.name}</p>
                                                                {reaction.isTarget && (
                                                                    <span className="text-xs bg-indigo-500/30 text-indigo-300 px-2 py-0.5 rounded-full">
                                                                        {TARGETS[currentResult.target].name}
                                                                    </span>
                                                                )}
                                                            </div>
                                                            <p className="text-gray-400">{reaction.text}</p>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* æ‹¡æ•£å¯è¦–åŒ– */}
                                        <SpreadVisualization 
                                            result={currentResult} 
                                            targetInfo={TARGETS[currentResult.target]}
                                        />

                                        {/* æ‰¹åˆ¤ã‚¤ãƒ™ãƒ³ãƒˆ */}
                                        {showCriticism && !criticismHandled && (
                                            <div className="bg-red-500/20 border border-red-500 rounded-2xl p-5 mb-6 animate-fade-in">
                                                <h3 className="font-bold text-red-400 mb-3">âš ï¸ æ‰¹åˆ¤ã‚³ãƒ¡ãƒ³ãƒˆãŒæ®ºåˆ°!</h3>
                                                <p className="text-gray-300 mb-4">
                                                    ã€Œã“ã®æƒ…å ±ã€æ ¹æ‹ ãªã„ã§ã™ã‚ˆã­ï¼Ÿãƒ‡ãƒæ‹¡æ•£ã‚„ã‚ã¦ãã ã•ã„ã€
                                                </p>
                                                <p className="text-sm text-gray-400 mb-4">ã©ã†å¯¾å¿œã—ã¾ã™ã‹ï¼Ÿ</p>
                                                <div className="grid grid-cols-2 gap-3">
                                                    {CRITICISM_RESPONSES.map(response => (
                                                        <button
                                                            key={response.id}
                                                            onClick={() => handleCriticismResponse(response)}
                                                            className="bg-white/10 hover:bg-white/20 rounded-xl p-3 text-left transition-all"
                                                        >
                                                            <p className="font-medium">{response.text}</p>
                                                            <p className="text-xs text-gray-400">{response.description}</p>
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        )}

                                        {/* æ‰¹åˆ¤å¯¾å¿œã®çµæœãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ */}
                                        {criticismHandled && criticismResult && (
                                            <div className={`rounded-2xl p-5 mb-6 animate-fade-in border ${
                                                criticismResult.response.feedback.type === 'positive' 
                                                    ? 'bg-green-500/20 border-green-500/50' 
                                                    : criticismResult.response.feedback.type === 'negative'
                                                    ? 'bg-red-500/20 border-red-500/50'
                                                    : 'bg-yellow-500/20 border-yellow-500/50'
                                            }`}>
                                                <h3 className={`font-bold mb-3 flex items-center gap-2 ${
                                                    criticismResult.response.feedback.type === 'positive' 
                                                        ? 'text-green-400' 
                                                        : criticismResult.response.feedback.type === 'negative'
                                                        ? 'text-red-400'
                                                        : 'text-yellow-400'
                                                }`}>
                                                    <span>{
                                                        criticismResult.response.feedback.type === 'positive' ? 'âœ¨' :
                                                        criticismResult.response.feedback.type === 'negative' ? 'ğŸ’¥' : 'ğŸ¤”'
                                                    }</span>
                                                    {criticismResult.response.feedback.title}
                                                </h3>
                                                <p className="text-gray-300 text-sm leading-relaxed mb-4">
                                                    {criticismResult.response.feedback.message}
                                                </p>
                                                
                                                {/* æ•°å€¤å¤‰åŒ– */}
                                                <div className="grid grid-cols-2 gap-3">
                                                    <div className={`rounded-xl p-3 text-center ${
                                                        criticismResult.followersChange >= 0 ? 'bg-indigo-500/20' : 'bg-red-500/20'
                                                    }`}>
                                                        <p className="text-xs text-gray-400">ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼å¤‰åŒ–</p>
                                                        <p className={`text-xl font-bold ${
                                                            criticismResult.followersChange >= 0 ? 'text-indigo-400' : 'text-red-400'
                                                        }`}>
                                                            {criticismResult.followersChange >= 0 ? '+' : ''}{criticismResult.followersChange}
                                                        </p>
                                                    </div>
                                                    <div className={`rounded-xl p-3 text-center ${
                                                        criticismResult.ethicsChange >= 0 ? 'bg-green-500/20' : 'bg-red-500/20'
                                                    }`}>
                                                        <p className="text-xs text-gray-400">ä¿¡é ¼æ€§å¤‰åŒ–</p>
                                                        <p className={`text-xl font-bold ${
                                                            criticismResult.ethicsChange >= 0 ? 'text-green-400' : 'text-red-400'
                                                        }`}>
                                                            {criticismResult.ethicsChange >= 0 ? '+' : ''}{criticismResult.ethicsChange}%
                                                        </p>
                                                    </div>
                                                </div>
                                                
                                                {/* å­¦ã³ã®ãƒã‚¤ãƒ³ãƒˆ */}
                                                <div className="mt-4 bg-white/5 rounded-xl p-3">
                                                    <p className="text-xs text-gray-400 mb-1">ğŸ’¡ å­¦ã³ã®ãƒã‚¤ãƒ³ãƒˆ</p>
                                                    <p className="text-sm text-gray-300">
                                                        {criticismResult.response.id === 'ignore' && 
                                                            'æ‰¹åˆ¤ã¸ã®æ²ˆé»™ã¯ç‚ä¸Šã‚’é¿ã‘ã‚‰ã‚Œã¾ã™ãŒã€èª¬æ˜è²¬ä»»ã‚’æœãŸã•ãªã„ã“ã¨ã§ä¿¡é ¼ã‚’å¤±ã†ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚'}
                                                        {criticismResult.response.id === 'attack' && 
                                                            'æ”»æ’ƒçš„ãªåè«–ã¯æ”¯æŒè€…ã‚’å–œã°ã›ã¾ã™ãŒã€ä¸­ç«‹çš„ãªäººã€…ã‹ã‚‰ã®ä¿¡é ¼ã‚’å¤§ããæãªã„ã¾ã™ã€‚'}
                                                        {criticismResult.response.id === 'block' && 
                                                            'ãƒ–ãƒ­ãƒƒã‚¯ã¯ä¸€æ™‚çš„ãªè§£æ±ºç­–ã§ã™ãŒã€æ‰¹åˆ¤ã‚’å°ã˜è¾¼ã‚ã‚‹å§¿å‹¢ã¯é•·æœŸçš„ã«ä¿¡é ¼ã‚’æãªã„ã¾ã™ã€‚'}
                                                        {criticismResult.response.id === 'acknowledge' && 
                                                            'èª å®Ÿãªè¬ç½ªã¯çŸ­æœŸçš„ã«ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã‚’å¤±ã„ã¾ã™ãŒã€é•·æœŸçš„ãªä¿¡é ¼æ§‹ç¯‰ã«ã¤ãªãŒã‚Šã¾ã™ã€‚'}
                                                    </p>
                                                </div>
                                            </div>
                                        )}

                                        {/* è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */}
                                        {ethics < 30 && (
                                            <div className="bg-red-500/30 border border-red-500 rounded-xl p-4 mb-6">
                                                <p className="text-red-400 font-bold">ğŸ’€ è­¦å‘Š: ä¿¡é ¼æ€§ãŒè‘—ã—ãä½ä¸‹ã—ã¦ã„ã¾ã™</p>
                                                <p className="text-sm text-gray-300">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‡çµã®ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™</p>
                                            </div>
                                        )}

                                        <button
                                            onClick={nextRound}
                                            disabled={showCriticism && !criticismHandled}
                                            className={`w-full font-bold py-4 px-8 rounded-2xl text-lg ${
                                                showCriticism && !criticismHandled
                                                    ? 'bg-gray-700 text-gray-500 cursor-not-allowed'
                                                    : 'btn-primary text-white'
                                            }`}
                                        >
                                            {round < 4 ? 'æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸' : 'Stage 3ã¸'}
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                    </>
                    )}
                </div>
            );
        };

        // Stage3 èª¬æ˜ç”»é¢ï¼ˆæƒ…å ±æ¤œè¨¼è¨“ç·´ï¼‰
        const Stage3Intro = ({ stage3Data, onContinue }) => {
            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="max-w-2xl w-full animate-fade-in">
                        <div className="glass rounded-3xl p-8 md:p-12">
                            {/* Stage2ã®çµæœã‚µãƒãƒªãƒ¼ */}
                            <div className="text-center mb-8">
                                <div className="text-6xl mb-4">ğŸ“±</div>
                                <h1 className="text-3xl font-bold mb-2">Stage 2 å®Œäº†ï¼</h1>
                                <p className="text-gray-400">ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ä½“é¨“ãŒçµ‚ã‚ã‚Šã¾ã—ãŸ</p>
                            </div>

                            <div className="bg-white/5 rounded-2xl p-6 mb-8">
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="text-center">
                                        <p className="text-sm text-gray-400">æœ€çµ‚ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼</p>
                                        <p className="text-3xl font-bold text-indigo-400">
                                            {stage3Data.totalFollowers.toLocaleString()}
                                        </p>
                                    </div>
                                    <div className="text-center">
                                        <p className="text-sm text-gray-400">æœ€çµ‚ä¿¡é ¼æ€§</p>
                                        <p className={`text-3xl font-bold ${
                                            stage3Data.finalEthics >= 50 ? 'text-green-400' : 'text-red-400'
                                        }`}>
                                            {stage3Data.finalEthics}%
                                        </p>
                                    </div>
                                </div>
                            </div>

                            {/* Stage3ã®èª¬æ˜ */}
                            <div className="bg-gradient-to-r from-cyan-500/20 via-blue-500/20 to-indigo-500/20 rounded-2xl p-6 mb-8">
                                <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                                    <span className="text-2xl">ğŸ”</span>
                                    æœ€çµ‚ã‚¹ãƒ†ãƒ¼ã‚¸ï¼šæƒ…å ±æ¤œè¨¼è¨“ç·´
                                </h2>
                                
                                <p className="text-gray-300 leading-relaxed mb-4">
                                    æœ€å¾Œã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã¯ã€<strong className="text-cyan-400">æ“ä½œçš„ãªæŠ•ç¨¿ã‚’æ¤œè¨¼ã™ã‚‹ã‚¹ã‚­ãƒ«</strong>ã‚’è¨“ç·´ã—ã¾ã™ã€‚
                                    ã€Œæœ¬å½“ã‹ã©ã†ã‹ã€ã‚’è‡ªåˆ†ã§ç¢ºèªã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã—ã‚‡ã†ã€‚
                                </p>

                                <div className="space-y-3 mb-4">
                                    <div className="flex items-start gap-3">
                                        <span className="bg-cyan-500/30 text-cyan-300 rounded-full w-7 h-7 flex items-center justify-center font-bold shrink-0 text-sm">1</span>
                                        <p className="text-gray-300 text-sm">
                                            <strong>æ¤œè¨¼è¡Œå‹•ã®é¸æŠ</strong>ï¼šã¾ãšä½•ã‚’ç¢ºèªã™ã¹ãã‹ã‚’é¸ã¶
                                        </p>
                                    </div>
                                    <div className="flex items-start gap-3">
                                        <span className="bg-cyan-500/30 text-cyan-300 rounded-full w-7 h-7 flex items-center justify-center font-bold shrink-0 text-sm">2</span>
                                        <p className="text-gray-300 text-sm">
                                            <strong>æƒ…å ±æºã®é¸æŠ</strong>ï¼šã©ã“ã§ç¢ºèªã™ã‚‹ã‹ã‚’é¸ã¶
                                        </p>
                                    </div>
                                    <div className="flex items-start gap-3">
                                        <span className="bg-cyan-500/30 text-cyan-300 rounded-full w-7 h-7 flex items-center justify-center font-bold shrink-0 text-sm">3</span>
                                        <p className="text-gray-300 text-sm">
                                            <strong>çµæœã®è§£é‡ˆ</strong>ï¼šæ¤œè¨¼çµæœã‚’ã©ã†åˆ¤æ–­ã™ã‚‹ã‹
                                        </p>
                                    </div>
                                </div>

                                <div className="bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4">
                                    <p className="text-yellow-300 text-sm font-medium mb-1">ğŸ’¡ Lateral Readingï¼ˆæ¨ªæ–­çš„èª­è§£ï¼‰</p>
                                    <p className="text-gray-300 text-sm">
                                        å°‚é–€å®¶ã¯æŠ•ç¨¿ã‚’ã€Œã˜ã£ãã‚Šèª­ã‚€ã€ã®ã§ã¯ãªãã€
                                        <strong className="text-green-400">ã™ãã«å¤–éƒ¨ã§ç¢ºèª</strong>ã—ã¾ã™ã€‚
                                        ã“ã®ã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ã¾ã—ã‚‡ã†ã€‚
                                    </p>
                                </div>
                            </div>

                            {/* æ¤œè¨¼è¡Œå‹•ã®ç´¹ä»‹ */}
                            <div className="mb-8">
                                <h3 className="text-lg font-bold mb-4 text-center">å­¦ã¶æ¤œè¨¼è¡Œå‹•</h3>
                                <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                    <div className="bg-white/5 rounded-xl p-3 text-center">
                                        <div className="text-2xl mb-1">ğŸ‘¤</div>
                                        <p className="text-xs font-bold text-gray-300">ç™ºä¿¡è€…ã®ç¢ºèª</p>
                                    </div>
                                    <div className="bg-white/5 rounded-xl p-3 text-center">
                                        <div className="text-2xl mb-1">ğŸ”¢</div>
                                        <p className="text-xs font-bold text-gray-300">å‡ºå…¸ã®æ¤œç´¢</p>
                                    </div>
                                    <div className="bg-white/5 rounded-xl p-3 text-center">
                                        <div className="text-2xl mb-1">ğŸ›ï¸</div>
                                        <p className="text-xs font-bold text-gray-300">å…¬å¼æƒ…å ±æº</p>
                                    </div>
                                    <div className="bg-white/5 rounded-xl p-3 text-center">
                                        <div className="text-2xl mb-1">ğŸ“°</div>
                                        <p className="text-xs font-bold text-gray-300">è¤‡æ•°æƒ…å ±æº</p>
                                    </div>
                                    <div className="bg-white/5 rounded-xl p-3 text-center">
                                        <div className="text-2xl mb-1">âœ…</div>
                                        <p className="text-xs font-bold text-gray-300">ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯</p>
                                    </div>
                                    <div className="bg-white/5 rounded-xl p-3 text-center">
                                        <div className="text-2xl mb-1">ğŸ¤”</div>
                                        <p className="text-xs font-bold text-gray-300">é©åˆ‡ãªè§£é‡ˆ</p>
                                    </div>
                                </div>
                            </div>

                            <button
                                onClick={onContinue}
                                className="w-full btn-primary text-white font-bold py-4 px-8 rounded-2xl text-lg"
                            >
                                Stage 3 ã‚’å§‹ã‚ã‚‹
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Stage3: æƒ…å ±æ¤œè¨¼è¨“ç·´ï¼ˆLateral Readingï¼‰
        const StageCreate = ({ stage1Data, stage3Data, onComplete }) => {
            const [currentScenario, setCurrentScenario] = useState(0);
            const [currentStep, setCurrentStep] = useState(0); // 0: intro, 1-3: steps, 4: result
            const [selectedAnswers, setSelectedAnswers] = useState([]);
            const [showFeedback, setShowFeedback] = useState(false);
            const [lastFeedback, setLastFeedback] = useState(null);
            const [results, setResults] = useState([]);
            const [showFullPost, setShowFullPost] = useState(false); // æŠ•ç¨¿å…¨æ–‡è¡¨ç¤ºç”¨

            // ã‚·ãƒŠãƒªã‚ªå®šç¾©
            const SCENARIOS = [
                {
                    id: 1,
                    title: 'æ•°å­—ã®æ¤œè¨¼',
                    difficulty: 'æ˜“',
                    difficultyColor: 'green',
                    post: {
                        author: 'å¥åº·ãƒ‹ãƒ¥ãƒ¼ã‚¹é€Ÿå ±',
                        authorHandle: '@health_news_jp',
                        content: 'ã€è¡æ’ƒã€‘æœ€æ–°èª¿æŸ»ã§åˆ¤æ˜ï¼\n87%ã®å­ä¾›ãŒã‚¹ãƒãƒ›ä¾å­˜ç—‡ã«ï¼\nå°‚é–€å®¶ã€Œä»Šã™ãå¯¾ç­–ã‚’ã€\n\nå­ä¾›ã®å°†æ¥ãŒå¿ƒé…ãªæ–¹ã¯å¿…è¦‹ã§ã™ã€‚\n#æ‹¡æ•£å¸Œæœ› #å­è‚²ã¦',
                        techniques: ['pseudoscience', 'fear', 'authority']
                    },
                    steps: [
                        {
                            question: 'ã“ã®æŠ•ç¨¿ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã«ã€ã¾ãšä½•ã‚’ç¢ºèªã—ã¾ã™ã‹ï¼Ÿ',
                            options: [
                                { id: 'read_more', text: 'æŠ•ç¨¿ã®æ–‡ç« ã‚’ã‚‚ã£ã¨è©³ã—ãèª­ã‚€', score: 0, feedback: 'æŠ•ç¨¿ã‚’è©³ã—ãèª­ã‚“ã§ã‚‚ã€æƒ…å ±ã®æ­£ç¢ºã•ã¯ç¢ºèªã§ãã¾ã›ã‚“ã€‚å¤–éƒ¨ã§æ¤œè¨¼ã—ã¾ã—ã‚‡ã†ã€‚' },
                                { id: 'check_source', text: 'ã€Œ87%ã€ã¨ã„ã†æ•°å­—ã®å‡ºå…¸ã‚’æ¢ã™', score: 3, feedback: 'æ­£è§£ï¼æ•°å­—ã®æ ¹æ‹ ã‚’å¤–éƒ¨ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚' },
                                { id: 'check_likes', text: 'æŠ•ç¨¿ã®ã€Œã„ã„ã­ã€æ•°ã‚’è¦‹ã‚‹', score: 0, feedback: 'ã€Œã„ã„ã­ã€ã®æ•°ã¯æƒ…å ±ã®æ­£ç¢ºã•ã¨ã¯é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚' },
                                { id: 'read_comments', text: 'ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã§ä»–ã®äººã®æ„è¦‹ã‚’è¦‹ã‚‹', score: 1, feedback: 'ã‚³ãƒ¡ãƒ³ãƒˆã‚‚å‚è€ƒã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ãŒã€ä¸€æ¬¡æƒ…å ±æºã®ç¢ºèªãŒå„ªå…ˆã§ã™ã€‚' }
                            ]
                        },
                        {
                            question: 'ã€Œ87%ã€ã®å‡ºå…¸ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€ã©ã“ã‚’è¦‹ã¾ã™ã‹ï¼Ÿ',
                            options: [
                                { id: 'same_sns', text: 'åŒã˜SNSã§ã€Œ87% ã‚¹ãƒãƒ› å­ä¾›ã€ã¨æ¤œç´¢', score: 1, feedback: 'SNSå†…æ¤œç´¢ã§ã¯ã€åŒã˜èª¤æƒ…å ±ãŒæ‹¡æ•£ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚' },
                                { id: 'google', text: 'Googleã§ã€Œ87% ã‚¹ãƒãƒ› å­ä¾› èª¿æŸ»ã€ã¨æ¤œç´¢', score: 2, feedback: 'æ‚ªããªã„é¸æŠã§ã™ãŒã€å…¬å¼æ©Ÿé–¢ã®æƒ…å ±ã‚’ç›´æ¥ç¢ºèªã™ã‚‹æ–¹ãŒç¢ºå®Ÿã§ã™ã€‚' },
                                { id: 'official', text: 'åšåŠ´çœã‚„å†…é–£åºœã®èª¿æŸ»ã‚’ç¢ºèª', score: 3, feedback: 'æ­£è§£ï¼å…¬å¼æ©Ÿé–¢ã®ä¸€æ¬¡æƒ…å ±æºã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒæœ€ã‚‚ä¿¡é ¼æ€§ãŒé«˜ã„ã§ã™ã€‚' },
                                { id: 'chiebukuro', text: 'Yahoo!çŸ¥æµè¢‹ã§èã„ã¦ã¿ã‚‹', score: 0, feedback: 'Q&Aã‚µã‚¤ãƒˆã®å›ç­”ã‚‚æ¤œè¨¼ãŒå¿…è¦ã§ã™ã€‚ä¸€æ¬¡æƒ…å ±æºã‚’ç›´æ¥ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚' }
                            ]
                        },
                        {
                            question: 'å…¬å¼æ©Ÿé–¢ã®ã‚µã‚¤ãƒˆã§ã€Œ87%ã€ã¨ã„ã†æ•°å­—ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã“ã®çµæœã‚’ã©ã†è§£é‡ˆã—ã¾ã™ã‹ï¼Ÿ',
                            verificationResult: 'å†…é–£åºœã€Œé’å°‘å¹´ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆåˆ©ç”¨ç’°å¢ƒå®Ÿæ…‹èª¿æŸ»ã€ã‚’ç¢ºèªã—ãŸçµæœï¼š\nãƒ»ã‚¹ãƒãƒ›åˆ©ç”¨ç‡ï¼šç´„70%ï¼ˆæ‰€æŒç‡ï¼‰\nãƒ»ã€Œä¾å­˜å‚¾å‘ã€ã‚’ç¤ºã™æ•°å€¤ï¼šç´„10ã€œ15%\nãƒ»ã€Œ87%ãŒä¾å­˜ç—‡ã€ã¨ã„ã†ãƒ‡ãƒ¼ã‚¿ã¯ç¢ºèªã§ããš',
                            options: [
                                { id: 'definite_lie', text: '87%ã¯å®Œå…¨ãªå˜˜ã ã¨æ–­å®šã§ãã‚‹', score: 1, feedback: 'ã€Œå˜˜ã€ã¨æ–­å®šã™ã‚‹ã®ã¯éå‰°ã§ã™ã€‚ã€Œç¢ºèªã§ããªã‹ã£ãŸã€ãŒæ­£ç¢ºãªè¡¨ç¾ã§ã™ã€‚' },
                                { id: 'unverified', text: '87%ã®æ ¹æ‹ ã¯ç¢ºèªã§ããšã€ä¿¡é ¼æ€§ã«ç–‘å•ãŒã‚ã‚‹', score: 3, feedback: 'æ­£è§£ï¼ã€Œç¢ºèªã§ããªã„ã€ã¨ã€Œå˜˜ã€ã¯ç•°ãªã‚Šã¾ã™ã€‚é©åˆ‡ãªåˆ¤æ–­ã§ã™ã€‚' },
                                { id: 'maybe_true', text: 'å…¬å¼ãƒ‡ãƒ¼ã‚¿ã¨é•ã†ãŒã€æŠ•ç¨¿ã‚‚æ­£ã—ã„ã‹ã‚‚ã—ã‚Œãªã„', score: 0, feedback: 'æ ¹æ‹ ãŒç¢ºèªã§ããªã„æ•°å­—ã‚’ä¿¡ã˜ã‚‹ã®ã¯å±é™ºã§ã™ã€‚å‡ºå…¸ã®ãªã„æƒ…å ±ã¯ç–‘ã„ã¾ã—ã‚‡ã†ã€‚' }
                            ]
                        }
                    ],
                    summary: {
                        learned: 'æ•°å­—ã®å‡ºå…¸ã¯å¿…ãšç¢ºèªã™ã‚‹ã€‚å…¬å¼æ©Ÿé–¢ã®ä¸€æ¬¡æƒ…å ±ã‚’å„ªå…ˆã™ã‚‹ã€‚',
                        key_point: 'ã€Œ87%ã€ã®ã‚ˆã†ãªå…·ä½“çš„ãªæ•°å­—ã¯ã€å‡ºå…¸ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ä¿¡é ¼æ€§ã‚’åˆ¤æ–­ã§ãã¾ã™ã€‚'
                    }
                },
                {
                    id: 2,
                    title: 'ç™ºä¿¡è€…ã®æ¤œè¨¼',
                    difficulty: 'ä¸­',
                    difficultyColor: 'yellow',
                    post: {
                        author: 'å¥åº·ç§‘å­¦ç ”ç©¶æ‰€',
                        authorHandle: '@health_science_lab',
                        content: 'ã€å…¬å¼ç™ºè¡¨ã€‘å½“ç ”ç©¶æ‰€ã®èª¿æŸ»ã«ã‚ˆã‚Šã€\nãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‡ãƒˆãƒƒã‚¯ã‚¹ãŒç¡çœ ã®è³ªã‚’\n40%æ”¹å–„ã™ã‚‹ã“ã¨ãŒåˆ¤æ˜ã—ã¾ã—ãŸã€‚\n\nè©³ç´°ã¯ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ã€‚\n#ç ”ç©¶æˆæœ #ç¡çœ æ”¹å–„',
                        techniques: ['authority', 'pseudoscience']
                    },
                    steps: [
                        {
                            question: 'ã“ã®æŠ•ç¨¿ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã«ã€ã¾ãšä½•ã‚’ç¢ºèªã—ã¾ã™ã‹ï¼Ÿ',
                            options: [
                                { id: 'click_link', text: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ã‚’é–‹ã', score: 1, feedback: 'ãƒªãƒ³ã‚¯å…ˆã®æƒ…å ±ã‚‚æ¤œè¨¼ãŒå¿…è¦ã§ã™ã€‚ã¾ãšã¯ç™ºä¿¡è€…ã®ä¿¡é ¼æ€§ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚' },
                                { id: 'check_org', text: 'ã€Œå¥åº·ç§‘å­¦ç ”ç©¶æ‰€ã€ãŒå®Ÿåœ¨ã™ã‚‹ã‹ç¢ºèªã™ã‚‹', score: 3, feedback: 'æ­£è§£ï¼ç™ºä¿¡è€…ã®å®Ÿåœ¨æ€§ãƒ»ä¿¡é ¼æ€§ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚' },
                                { id: 'check_followers', text: 'ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ã‚’ç¢ºèªã™ã‚‹', score: 0, feedback: 'ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ã¯ä¿¡é ¼æ€§ã®æŒ‡æ¨™ã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚' },
                                { id: 'check_likes', text: 'æŠ•ç¨¿ã®ã€Œã„ã„ã­ã€æ•°ã‚’è¦‹ã‚‹', score: 0, feedback: 'ã€Œã„ã„ã­ã€ã®æ•°ã¯æƒ…å ±ã®æ­£ç¢ºã•ã¨ã¯é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚' }
                            ]
                        },
                        {
                            question: 'ã€Œå¥åº·ç§‘å­¦ç ”ç©¶æ‰€ã€ã®å®Ÿåœ¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€ã©ã“ã‚’è¦‹ã¾ã™ã‹ï¼Ÿ',
                            options: [
                                { id: 'trust_profile', text: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«æ›¸ã„ã¦ã‚ã‚‹æƒ…å ±ã‚’ä¿¡ã˜ã‚‹', score: 0, feedback: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¯èª°ã§ã‚‚è‡ªç”±ã«æ›¸ã‘ã¾ã™ã€‚å¤–éƒ¨ã§ç¢ºèªãŒå¿…è¦ã§ã™ã€‚' },
                                { id: 'google_search', text: 'Googleã§ã€Œå¥åº·ç§‘å­¦ç ”ç©¶æ‰€ã€ã¨æ¤œç´¢', score: 2, feedback: 'æ¤œç´¢ã¯æœ‰åŠ¹ã§ã™ãŒã€å…¬çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã®ç¢ºèªãŒã‚ˆã‚Šç¢ºå®Ÿã§ã™ã€‚' },
                                { id: 'official_db', text: 'æ³•äººç™»è¨˜ã‚„å­¦è¡“æ©Ÿé–¢ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ç¢ºèª', score: 3, feedback: 'æ­£è§£ï¼å…¬çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ç¢ºèªã™ã‚‹ã“ã¨ã§ã€å®Ÿåœ¨æ€§ã‚’åˆ¤æ–­ã§ãã¾ã™ã€‚' },
                                { id: 'other_sns', text: 'ä»–ã®SNSã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æ¢ã™', score: 1, feedback: 'è¤‡æ•°ã®SNSã§æ´»å‹•ã—ã¦ã„ã¦ã‚‚ã€çµ„ç¹”ã®å®Ÿåœ¨æ€§ã¯ç¢ºèªã§ãã¾ã›ã‚“ã€‚' }
                            ]
                        },
                        {
                            question: 'ç¢ºèªã—ãŸçµæœã€æ³•äººç™»è¨˜ã«ã‚‚å­¦è¡“æ©Ÿé–¢DBã«ã‚‚è©²å½“ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã©ã†è§£é‡ˆã—ã¾ã™ã‹ï¼Ÿ',
                            verificationResult: 'æ¤œè¨¼çµæœï¼š\nãƒ»æ³•äººç™»è¨˜æ¤œç´¢ï¼šè©²å½“ãªã—\nãƒ»å­¦è¡“æ©Ÿé–¢ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼šè©²å½“ãªã—\nãƒ»Webã‚µã‚¤ãƒˆï¼šå€‹äººãƒ–ãƒ­ã‚°é¢¨ã®ãƒšãƒ¼ã‚¸ãŒå­˜åœ¨\nãƒ»å­¦è¡“è«–æ–‡ï¼šè©²å½“ã™ã‚‹ç ”ç©¶ã¯è¦‹ã¤ã‹ã‚‰ãš',
                            options: [
                                { id: 'report', text: 'ç ”ç©¶æ‰€ã‚’åä¹—ã‚‹è©æ¬ºãªã®ã§é€šå ±ã™ã¹ã', score: 1, feedback: 'è©æ¬ºã¨æ–­å®šã™ã‚‹ã«ã¯è¨¼æ‹ ãŒä¸ååˆ†ã§ã™ã€‚ãŸã ã—ã€ä¿¡é ¼æ€§ã¯ä½ã„ã¨åˆ¤æ–­ã™ã¹ãã§ã™ã€‚' },
                                { id: 'low_trust', text: 'ç ”ç©¶æ©Ÿé–¢ã¨ã—ã¦ã®ä¿¡é ¼æ€§ã¯ä½ãã€ä¸»å¼µã‚’éµœå‘‘ã¿ã«ã™ã¹ãã§ãªã„', score: 3, feedback: 'æ­£è§£ï¼å…¬çš„ã«ç¢ºèªã§ããªã„çµ„ç¹”ã®ä¸»å¼µã¯ã€æ…é‡ã«æ‰±ã†ã¹ãã§ã™ã€‚' },
                                { id: 'maybe_ok', text: 'ç™»è¨˜ãŒãªãã¦ã‚‚ç ”ç©¶æ©Ÿé–¢ã¯å­˜åœ¨ã—ã†ã‚‹ã®ã§å•é¡Œãªã„', score: 0, feedback: 'æ­£å¼ãªç ”ç©¶æ©Ÿé–¢ãªã‚‰å…¬çš„è¨˜éŒ²ãŒã‚ã‚‹ã¯ãšã§ã™ã€‚ç¢ºèªã§ããªã„ãªã‚‰ä¿¡é ¼æ€§ã¯ä½ã„ã§ã™ã€‚' }
                            ]
                        }
                    ],
                    summary: {
                        learned: 'ç™ºä¿¡è€…ã®å®Ÿåœ¨æ€§ãƒ»ä¿¡é ¼æ€§ã¯å…¬çš„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ç¢ºèªã§ãã‚‹ã€‚',
                        key_point: 'ã€Œã€‡ã€‡ç ”ç©¶æ‰€ã€ã€Œã€‡ã€‡å”ä¼šã€ã‚’åä¹—ã£ã¦ã„ã¦ã‚‚ã€å®Ÿåœ¨ã™ã‚‹ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚'
                    }
                },
                {
                    id: 3,
                    title: 'ç·åˆçš„ãªæ¤œè¨¼',
                    difficulty: 'é›£',
                    difficultyColor: 'red',
                    post: {
                        author: 'çœŸå®Ÿã‚’ä¼ãˆã‚‹ä¼š',
                        authorHandle: '@truth_teller_jp',
                        content: 'ã€ç·Šæ€¥æ‹¡æ•£ã€‘ãƒ†ãƒ¬ãƒ“ã§ã¯å ±é“ã•ã‚Œãªã„çœŸå®Ÿ\n\nãƒãƒ¼ãƒãƒ¼ãƒ‰å¤§å­¦ã®ç ”ç©¶ãƒãƒ¼ãƒ ãŒç™ºè¡¨ï¼\n5Gé›»æ³¢ãŒã‚¦ã‚¤ãƒ«ã‚¹ã‚’æ´»æ€§åŒ–ã•ã›ã‚‹\nã“ã¨ãŒåˆ¤æ˜ã€‚\n\nå¤§æ‰‹ãƒ¡ãƒ‡ã‚£ã‚¢ã¯åˆ©æ¨©ã®ãŸã‚éš è”½ä¸­ã€‚\næ°—ã¥ã„ãŸäººã ã‘ã‚·ã‚§ã‚¢ã—ã¦ãã ã•ã„ã€‚',
                        techniques: ['authority', 'pseudoscience', 'polarization', 'fear']
                    },
                    steps: [
                        {
                            question: 'ã“ã®æŠ•ç¨¿ã«ã¯è¤‡æ•°ã®å•é¡ŒãŒã‚ã‚Šãã†ã§ã™ã€‚ã¾ãšä½•ã‚’ç¢ºèªã—ã¾ã™ã‹ï¼Ÿ',
                            options: [
                                { id: 'check_shares', text: 'ä»–ã«åŒã˜æƒ…å ±ã‚’ã‚·ã‚§ã‚¢ã—ã¦ã„ã‚‹äººãŒã„ã‚‹ã‹ç¢ºèª', score: 1, feedback: 'æ‹¡æ•£çŠ¶æ³ã¯å‚è€ƒã«ãªã‚Šã¾ã™ãŒã€çœŸå½ã®åˆ¤æ–­ã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚ä¸€æ¬¡æƒ…å ±æºã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚' },
                                { id: 'check_harvard', text: 'ãƒãƒ¼ãƒãƒ¼ãƒ‰å¤§å­¦ãŒæœ¬å½“ã«ãã®ã‚ˆã†ãªç ”ç©¶ã‚’ç™ºè¡¨ã—ãŸã‹ç¢ºèª', score: 3, feedback: 'æ­£è§£ï¼å…·ä½“çš„ãªæ©Ÿé–¢åãŒæŒ™ã’ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆã€ã¾ãšãã®äº‹å®Ÿã‚’ç¢ºèªã—ã¾ã™ã€‚' },
                                { id: 'think_reason', text: 'ã€Œå ±é“ã•ã‚Œãªã„ã€ç†ç”±ã‚’è€ƒãˆã‚‹', score: 0, feedback: 'æ¨æ¸¬ã‚ˆã‚Šã‚‚äº‹å®Ÿç¢ºèªãŒé‡è¦ã§ã™ã€‚å¤–éƒ¨ã§æ¤œè¨¼ã—ã¾ã—ã‚‡ã†ã€‚' },
                                { id: 'self_research', text: '5Gã¨ã‚¦ã‚¤ãƒ«ã‚¹ã®é–¢ä¿‚ã‚’è‡ªåˆ†ã§èª¿ã¹ã‚‹', score: 2, feedback: 'èª¿ã¹ã‚‹ã“ã¨è‡ªä½“ã¯è‰¯ã„ã§ã™ãŒã€ã¾ãšã¯ä¸»å¼µã®æ ¹æ‹ ã‚’ç¢ºèªã™ã‚‹æ–¹ãŒåŠ¹ç‡çš„ã§ã™ã€‚' }
                            ]
                        },
                        {
                            question: 'ã“ã®æŠ•ç¨¿ã®çœŸå½ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€ã©ã“ã‚’è¦‹ã¾ã™ã‹ï¼Ÿï¼ˆæœ€ã‚‚åŠ¹æœçš„ãªã‚‚ã®ã‚’é¸æŠï¼‰',
                            options: [
                                { id: 'harvard_official', text: 'ãƒãƒ¼ãƒãƒ¼ãƒ‰å¤§å­¦ã®å…¬å¼ã‚µã‚¤ãƒˆ', score: 2, feedback: 'è‰¯ã„é¸æŠã§ã™ã€‚å…¬å¼ç™ºè¡¨ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ã€ä¸»å¼µã®æ ¹æ‹ ã‚’æ¤œè¨¼ã§ãã¾ã™ã€‚' },
                                { id: 'fact_check', text: 'ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯æ©Ÿé–¢ï¼ˆæ—¥æœ¬ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯ã‚»ãƒ³ã‚¿ãƒ¼ç­‰ï¼‰', score: 3, feedback: 'æ­£è§£ï¼ã“ã®ã‚ˆã†ãªè©±é¡Œã¯æ—¢ã«ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚åŠ¹ç‡çš„ãªæ¤œè¨¼æ–¹æ³•ã§ã™ã€‚' },
                                { id: 'overseas_sns', text: 'æµ·å¤–ã®SNSã§æ¤œç´¢', score: 1, feedback: 'æµ·å¤–SNSã§ã‚‚èª¤æƒ…å ±ã¯æ‹¡æ•£ã—ã¾ã™ã€‚å…¬å¼æ©Ÿé–¢ã‚„ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯æ©Ÿé–¢ã‚’å„ªå…ˆã—ã¾ã—ã‚‡ã†ã€‚' },
                                { id: 'pubmed', text: 'å­¦è¡“è«–æ–‡ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆPubMedç­‰ï¼‰', score: 2, feedback: 'å­¦è¡“çš„ãªæ¤œè¨¼ã«ã¯æœ‰åŠ¹ã§ã™ãŒã€ã“ã®ç¨®ã®é™°è¬€è«–ã¯ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯æ©Ÿé–¢ãŒæ—¢ã«æ¤œè¨¼æ¸ˆã¿ã®å ´åˆãŒå¤šã„ã§ã™ã€‚' }
                            ]
                        },
                        {
                            question: 'æ¤œè¨¼ã®çµæœã€ä»¥ä¸‹ã®ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚ã“ã®æŠ•ç¨¿ã®å•é¡Œç‚¹ã¯ä½•ã§ã™ã‹ï¼Ÿ',
                            verificationResult: 'æ¤œè¨¼çµæœï¼š\nãƒ»ãƒãƒ¼ãƒãƒ¼ãƒ‰å¤§å­¦ï¼šè©²å½“ã™ã‚‹ç™ºè¡¨ãªã—\nãƒ»ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯ï¼šã€Œ5Gã¨ã‚¦ã‚¤ãƒ«ã‚¹ã®é–¢é€£ã¯ç§‘å­¦çš„æ ¹æ‹ ãªã—ã€ã¨åˆ¤å®šæ¸ˆã¿\nãƒ»WHOï¼šã€Œ5Gã¯ã‚¦ã‚¤ãƒ«ã‚¹ã‚’æ‹¡æ•£ã—ãªã„ã€ã¨å…¬å¼è¦‹è§£\nãƒ»ç·å‹™çœï¼šåŒæ§˜ã®è¦‹è§£ã‚’ç™ºè¡¨',
                            isMultiSelect: true,
                            options: [
                                { id: 'fake_research', text: 'æ¶ç©ºã®ç ”ç©¶ã‚’æ ¹æ‹ ã«ã—ã¦ã„ã‚‹', score: 1, isCorrect: true },
                                { id: 'conspiracy', text: 'é™°è¬€è«–çš„ãªè¡¨ç¾ï¼ˆã€Œéš è”½ã€ã€Œæ°—ã¥ã„ãŸäººã ã‘ã€ï¼‰', score: 1, isCorrect: true },
                                { id: 'urge_spread', text: 'æ‹¡æ•£ã‚’ä¿ƒã™ç…½ã‚Šè¡¨ç¾', score: 1, isCorrect: true },
                                { id: 'low_followers', text: 'æŠ•ç¨¿è€…ã®ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ãŒå°‘ãªã„', score: -1, isCorrect: false }
                            ]
                        }
                    ],
                    summary: {
                        learned: 'è¤‡æ•°ã®æ¤œè¨¼æ–¹æ³•ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã€‚ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯æ©Ÿé–¢ã‚’æ´»ç”¨ã™ã‚‹ã€‚',
                        key_point: 'ã€Œå ±é“ã•ã‚Œãªã„çœŸå®Ÿã€ã€Œæ°—ã¥ã„ãŸäººã ã‘ã€ã¯é™°è¬€è«–ã®å…¸å‹çš„ãªè¡¨ç¾ã§ã™ã€‚'
                    }
                }
            ];

            const currentScenarioData = SCENARIOS[currentScenario];
            const currentStepData = currentScenarioData.steps[currentStep - 1];

            // é¸æŠè‚¢ã‚’é¸ã‚“ã ã¨ã
            const handleSelect = (option) => {
                if (showFeedback) return;

                const newAnswers = [...selectedAnswers, option];
                setSelectedAnswers(newAnswers);
                setLastFeedback(option.feedback);
                setShowFeedback(true);
            };

            // è¤‡æ•°é¸æŠã®å ´åˆ
            const [multiSelectAnswers, setMultiSelectAnswers] = useState([]);
            
            const handleMultiSelect = (option) => {
                if (showFeedback) return;
                
                setMultiSelectAnswers(prev => {
                    if (prev.find(o => o.id === option.id)) {
                        return prev.filter(o => o.id !== option.id);
                    } else {
                        return [...prev, option];
                    }
                });
            };

            const handleMultiSelectSubmit = () => {
                if (multiSelectAnswers.length === 0) return;
                
                const correctCount = multiSelectAnswers.filter(o => o.isCorrect).length;
                const incorrectCount = multiSelectAnswers.filter(o => !o.isCorrect).length;
                const totalCorrect = currentStepData.options.filter(o => o.isCorrect).length;
                
                const score = Math.max(0, correctCount - incorrectCount);
                const feedback = correctCount === totalCorrect && incorrectCount === 0
                    ? 'å®Œç’§ã§ã™ï¼ã™ã¹ã¦ã®å•é¡Œç‚¹ã‚’æ­£ã—ãç‰¹å®šã§ãã¾ã—ãŸã€‚'
                    : correctCount > 0
                        ? `${correctCount}å€‹ã®å•é¡Œç‚¹ã‚’ç‰¹å®šã§ãã¾ã—ãŸã€‚${incorrectCount > 0 ? 'ä¸é©åˆ‡ãªé¸æŠã‚‚ã‚ã‚Šã¾ã—ãŸã€‚' : ''}`
                        : 'å•é¡Œç‚¹ã‚’è¦‹é€ƒã—ã¦ã„ã¾ã™ã€‚æŠ•ç¨¿ã®ç‰¹å¾´ã‚’ã‚ˆãè¦³å¯Ÿã—ã¾ã—ã‚‡ã†ã€‚';

                const combinedOption = {
                    id: 'multi',
                    score: score,
                    feedback: feedback,
                    selected: multiSelectAnswers
                };
                
                setSelectedAnswers(prev => [...prev, combinedOption]);
                setLastFeedback(feedback);
                setShowFeedback(true);
            };

            // æ¬¡ã¸é€²ã‚€
            const handleNext = () => {
                setShowFeedback(false);
                setLastFeedback(null);
                setMultiSelectAnswers([]);
                setShowFullPost(false); // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹

                if (currentStep < 3) {
                    setCurrentStep(currentStep + 1);
                } else {
                    // ã‚·ãƒŠãƒªã‚ªå®Œäº† â†’ çµæœè¡¨ç¤º
                    setCurrentStep(4);
                }
            };

            // æ¬¡ã®ã‚·ãƒŠãƒªã‚ªã¸
            const handleNextScenario = () => {
                // çµæœã‚’ä¿å­˜
                const totalScore = selectedAnswers.reduce((sum, a) => sum + a.score, 0);
                const maxScore = 9;
                
                setResults(prev => [...prev, {
                    scenario: currentScenarioData,
                    answers: selectedAnswers,
                    totalScore,
                    maxScore
                }]);

                if (currentScenario < SCENARIOS.length - 1) {
                    setCurrentScenario(prev => prev + 1);
                    setCurrentStep(0);
                    setSelectedAnswers([]);
                    setShowFullPost(false); // ãƒªã‚»ãƒƒãƒˆ
                } else {
                    // å…¨ã‚·ãƒŠãƒªã‚ªå®Œäº†
                    const finalResults = [...results, {
                        scenario: currentScenarioData,
                        answers: selectedAnswers,
                        totalScore: selectedAnswers.reduce((sum, a) => sum + a.score, 0),
                        maxScore: 9
                    }];
                    
                    onComplete({
                        scenarios: finalResults
                    });
                }
            };

            const progress = ((currentScenario * 4 + currentStep) / (SCENARIOS.length * 4)) * 100;

            // é›£æ˜“åº¦ã®è‰²
            const difficultyColors = {
                green: 'bg-green-500/20 text-green-300 border-green-500/30',
                yellow: 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30',
                red: 'bg-red-500/20 text-red-300 border-red-500/30'
            };

            return (
                <div className="min-h-screen p-4 flex flex-col">
                    {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                    <div className="max-w-2xl w-full mx-auto mb-4">
                        <div className="glass rounded-2xl p-4">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-sm text-gray-400">Stage 3: æƒ…å ±æ¤œè¨¼è¨“ç·´</span>
                                <span className="text-sm text-gray-400">ã‚·ãƒŠãƒªã‚ª {currentScenario + 1} / {SCENARIOS.length}</span>
                            </div>
                            <div className="h-2 bg-white/10 rounded-full overflow-hidden">
                                <div className="progress-bar h-full rounded-full transition-all" style={{ width: `${progress}%` }}></div>
                            </div>
                        </div>
                    </div>

                    {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                    <div className="flex-1 flex items-center justify-center">
                        <div className="max-w-2xl w-full">
                            <div className="animate-fade-in">
                                <div className="glass rounded-3xl p-6 md:p-8">
                                    
                                    {/* ã‚·ãƒŠãƒªã‚ªã‚¤ãƒ³ãƒˆãƒ­ */}
                                    {currentStep === 0 && (
                                        <>
                                            <div className="text-center mb-6">
                                                <div className={`inline-block px-3 py-1 rounded-full text-sm font-bold mb-3 border ${difficultyColors[currentScenarioData.difficultyColor]}`}>
                                                    é›£æ˜“åº¦: {currentScenarioData.difficulty}
                                                </div>
                                                <h2 className="text-2xl font-bold mb-2">
                                                    ğŸ” {currentScenarioData.title}
                                                </h2>
                                                <p className="text-gray-400">ä»¥ä¸‹ã®æŠ•ç¨¿ã‚’æ¤œè¨¼ã—ã¦ãã ã•ã„</p>
                                            </div>

                                            {/* æŠ•ç¨¿è¡¨ç¤º */}
                                            <div className="bg-white/5 rounded-xl p-4 mb-6 border border-white/10">
                                                <div className="flex items-center gap-3 mb-3">
                                                    <div className="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-lg">
                                                        {currentScenarioData.post.author.charAt(0)}
                                                    </div>
                                                    <div>
                                                        <p className="font-bold text-sm">{currentScenarioData.post.author}</p>
                                                        <p className="text-xs text-gray-500">{currentScenarioData.post.authorHandle}</p>
                                                    </div>
                                                </div>
                                                <p className="text-sm whitespace-pre-line mb-3">{currentScenarioData.post.content}</p>
                                                <div className="flex flex-wrap gap-1">
                                                    {currentScenarioData.post.techniques.map(tech => (
                                                        <span key={tech} className="text-xs px-2 py-0.5 rounded-full bg-red-500/20 text-red-300">
                                                            {TECHNIQUES[tech]?.name}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>

                                            <button
                                                onClick={() => setCurrentStep(1)}
                                                className="w-full btn-primary text-white font-bold py-4 px-8 rounded-2xl text-lg"
                                            >
                                                æ¤œè¨¼ã‚’å§‹ã‚ã‚‹
                                            </button>
                                        </>
                                    )}

                                    {/* ã‚¹ãƒ†ãƒƒãƒ—1-3: æ¤œè¨¼è¡Œå‹• */}
                                    {currentStep >= 1 && currentStep <= 3 && currentStepData && (
                                        <>
                                            <div className="flex items-center justify-between mb-4">
                                                <h3 className="text-lg font-bold">
                                                    Step {currentStep}/3
                                                </h3>
                                                <div className="flex gap-1">
                                                    {[1, 2, 3].map(s => (
                                                        <div
                                                            key={s}
                                                            className={`w-8 h-2 rounded-full ${
                                                                s < currentStep ? 'bg-cyan-500' :
                                                                s === currentStep ? 'bg-cyan-500/50' : 'bg-white/10'
                                                            }`}
                                                        />
                                                    ))}
                                                </div>
                                            </div>

                                            {/* æŠ•ç¨¿ã®ç¸®å°è¡¨ç¤ºï¼ˆã‚¯ãƒªãƒƒã‚¯ã§å…¨æ–‡è¡¨ç¤ºï¼‰ */}
                                            <div 
                                                className="bg-white/5 rounded-xl p-3 mb-4 border border-white/10 cursor-pointer hover:bg-white/10 transition-all"
                                                onClick={() => setShowFullPost(true)}
                                            >
                                                <div className="flex items-center justify-between">
                                                    <div>
                                                        <p className="text-xs text-gray-500 mb-1">æ¤œè¨¼å¯¾è±¡:</p>
                                                        <p className="text-sm line-clamp-2">{currentScenarioData.post.content.split('\n')[0]}...</p>
                                                    </div>
                                                    <span className="text-xs text-cyan-400 ml-2 shrink-0">ğŸ‘† å…¨æ–‡ã‚’è¦‹ã‚‹</span>
                                                </div>
                                            </div>
                                            
                                            {/* æŠ•ç¨¿å…¨æ–‡è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« */}
                                            {showFullPost && (
                                                <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4" onClick={() => setShowFullPost(false)}>
                                                    <div className="bg-slate-800 rounded-2xl p-6 max-w-lg w-full max-h-[80vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                                        <div className="flex items-center justify-between mb-4">
                                                            <h3 className="font-bold text-lg">æ¤œè¨¼å¯¾è±¡ã®æŠ•ç¨¿</h3>
                                                            <button 
                                                                onClick={() => setShowFullPost(false)}
                                                                className="text-gray-400 hover:text-white text-2xl"
                                                            >
                                                                Ã—
                                                            </button>
                                                        </div>
                                                        
                                                        <div className="bg-white/5 rounded-xl p-4 border border-white/10">
                                                            <div className="flex items-center gap-3 mb-3">
                                                                <div className="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-lg">
                                                                    {currentScenarioData.post.author.charAt(0)}
                                                                </div>
                                                                <div>
                                                                    <p className="font-bold text-sm">{currentScenarioData.post.author}</p>
                                                                    <p className="text-xs text-gray-500">{currentScenarioData.post.authorHandle}</p>
                                                                </div>
                                                            </div>
                                                            <p className="text-sm whitespace-pre-line mb-3">{currentScenarioData.post.content}</p>
                                                            <div className="flex flex-wrap gap-1">
                                                                {currentScenarioData.post.techniques.map(tech => (
                                                                    <span key={tech} className="text-xs px-2 py-0.5 rounded-full bg-red-500/20 text-red-300">
                                                                        {TECHNIQUES[tech]?.name}
                                                                    </span>
                                                                ))}
                                                            </div>
                                                        </div>
                                                        
                                                        <button
                                                            onClick={() => setShowFullPost(false)}
                                                            className="w-full mt-4 bg-white/10 hover:bg-white/20 text-white font-bold py-3 px-6 rounded-xl transition-all"
                                                        >
                                                            é–‰ã˜ã‚‹
                                                        </button>
                                                    </div>
                                                </div>
                                            )}

                                            {/* æ¤œè¨¼çµæœï¼ˆStep3ã®ã¿ï¼‰ */}
                                            {currentStepData.verificationResult && (
                                                <div className="bg-cyan-500/10 border border-cyan-500/30 rounded-xl p-4 mb-4">
                                                    <p className="text-xs text-cyan-300 mb-2">ğŸ“Š æ¤œè¨¼çµæœ</p>
                                                    <p className="text-sm whitespace-pre-line text-gray-300">{currentStepData.verificationResult}</p>
                                                </div>
                                            )}

                                            {/* è³ªå• */}
                                            <p className="text-gray-300 mb-4">{currentStepData.question}</p>

                                            {/* é¸æŠè‚¢ */}
                                            {!currentStepData.isMultiSelect ? (
                                                <div className="space-y-2 mb-4">
                                                    {currentStepData.options.map(option => (
                                                        <button
                                                            key={option.id}
                                                            onClick={() => handleSelect(option)}
                                                            disabled={showFeedback}
                                                            className={`w-full text-left p-4 rounded-xl border-2 transition-all text-sm ${
                                                                showFeedback && selectedAnswers[selectedAnswers.length - 1]?.id === option.id
                                                                    ? option.score >= 3
                                                                        ? 'border-green-500 bg-green-500/20'
                                                                        : option.score >= 2
                                                                            ? 'border-yellow-500 bg-yellow-500/20'
                                                                            : 'border-red-500 bg-red-500/20'
                                                                    : 'border-white/10 bg-white/5 hover:border-cyan-500/50 hover:bg-cyan-500/10'
                                                            } ${showFeedback ? 'cursor-default' : ''}`}
                                                        >
                                                            {option.text}
                                                        </button>
                                                    ))}
                                                </div>
                                            ) : (
                                                <div className="space-y-2 mb-4">
                                                    <p className="text-xs text-gray-500 mb-2">ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</p>
                                                    {currentStepData.options.map(option => {
                                                        const isSelected = multiSelectAnswers.find(o => o.id === option.id);
                                                        return (
                                                            <button
                                                                key={option.id}
                                                                onClick={() => handleMultiSelect(option)}
                                                                disabled={showFeedback}
                                                                className={`w-full text-left p-4 rounded-xl border-2 transition-all text-sm ${
                                                                    showFeedback
                                                                        ? option.isCorrect
                                                                            ? 'border-green-500 bg-green-500/20'
                                                                            : isSelected
                                                                                ? 'border-red-500 bg-red-500/20'
                                                                                : 'border-white/10 bg-white/5'
                                                                        : isSelected
                                                                            ? 'border-cyan-500 bg-cyan-500/20'
                                                                            : 'border-white/10 bg-white/5 hover:border-cyan-500/50 hover:bg-cyan-500/10'
                                                                } ${showFeedback ? 'cursor-default' : ''}`}
                                                            >
                                                                <div className="flex items-center gap-2">
                                                                    <div className={`w-5 h-5 rounded border-2 flex items-center justify-center ${
                                                                        isSelected ? 'border-cyan-500 bg-cyan-500' : 'border-white/30'
                                                                    }`}>
                                                                        {isSelected && <span className="text-white text-xs">âœ“</span>}
                                                                    </div>
                                                                    {option.text}
                                                                </div>
                                                            </button>
                                                        );
                                                    })}
                                                    {!showFeedback && (
                                                        <button
                                                            onClick={handleMultiSelectSubmit}
                                                            disabled={multiSelectAnswers.length === 0}
                                                            className={`w-full mt-4 font-bold py-3 px-6 rounded-xl transition-all ${
                                                                multiSelectAnswers.length > 0
                                                                    ? 'btn-primary text-white'
                                                                    : 'bg-gray-600 text-gray-400 cursor-not-allowed'
                                                            }`}
                                                        >
                                                            å›ç­”ã‚’ç¢ºå®š
                                                        </button>
                                                    )}
                                                </div>
                                            )}

                                            {/* ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ */}
                                            {showFeedback && lastFeedback && (
                                                <div className={`rounded-xl p-4 mb-4 ${
                                                    selectedAnswers[selectedAnswers.length - 1]?.score >= 3
                                                        ? 'bg-green-500/10 border border-green-500/30'
                                                        : selectedAnswers[selectedAnswers.length - 1]?.score >= 2
                                                            ? 'bg-yellow-500/10 border border-yellow-500/30'
                                                            : 'bg-red-500/10 border border-red-500/30'
                                                }`}>
                                                    <p className="text-sm">{lastFeedback}</p>
                                                </div>
                                            )}

                                            {/* æ¬¡ã¸ãƒœã‚¿ãƒ³ */}
                                            {showFeedback && (
                                                <button
                                                    onClick={handleNext}
                                                    className="w-full btn-primary text-white font-bold py-4 px-8 rounded-2xl text-lg"
                                                >
                                                    {currentStep < 3 ? 'æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸' : 'çµæœã‚’è¦‹ã‚‹'}
                                                </button>
                                            )}
                                        </>
                                    )}

                                    {/* ã‚·ãƒŠãƒªã‚ªçµæœ */}
                                    {currentStep === 4 && (
                                        <>
                                            <div className="text-center mb-6">
                                                <div className="text-5xl mb-3">
                                                    {selectedAnswers.reduce((sum, a) => sum + a.score, 0) >= 7 ? 'ğŸ‰' :
                                                     selectedAnswers.reduce((sum, a) => sum + a.score, 0) >= 4 ? 'ğŸ‘' : 'ğŸ“š'}
                                                </div>
                                                <h2 className="text-2xl font-bold mb-2">ã‚·ãƒŠãƒªã‚ªå®Œäº†ï¼</h2>
                                                <p className="text-gray-400">{currentScenarioData.title}</p>
                                            </div>

                                            {/* ã‚¹ã‚³ã‚¢ */}
                                            <div className="bg-white/5 rounded-xl p-6 mb-6 text-center">
                                                <p className="text-sm text-gray-400 mb-2">æ¤œè¨¼ã‚¹ã‚³ã‚¢</p>
                                                <p className={`text-4xl font-bold ${
                                                    selectedAnswers.reduce((sum, a) => sum + a.score, 0) >= 7 ? 'text-green-400' :
                                                    selectedAnswers.reduce((sum, a) => sum + a.score, 0) >= 4 ? 'text-yellow-400' : 'text-red-400'
                                                }`}>
                                                    {selectedAnswers.reduce((sum, a) => sum + a.score, 0)} / 9
                                                </p>
                                            </div>

                                            {/* å„ã‚¹ãƒ†ãƒƒãƒ—ã®çµæœ */}
                                            <div className="space-y-3 mb-6">
                                                {selectedAnswers.map((answer, idx) => (
                                                    <div key={idx} className="flex items-center justify-between bg-white/5 rounded-xl p-3">
                                                        <span className="text-sm text-gray-400">Step {idx + 1}</span>
                                                        <div className="flex items-center gap-2">
                                                            <span className={`text-sm font-bold ${
                                                                answer.score >= 3 ? 'text-green-400' :
                                                                answer.score >= 2 ? 'text-yellow-400' : 'text-red-400'
                                                            }`}>
                                                                +{answer.score}ç‚¹
                                                            </span>
                                                            <span className={`text-lg ${
                                                                answer.score >= 3 ? '' : answer.score >= 2 ? '' : ''
                                                            }`}>
                                                                {answer.score >= 3 ? 'âœ“' : answer.score >= 2 ? 'â–³' : 'âœ—'}
                                                            </span>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>

                                            {/* å­¦ã‚“ã ã“ã¨ */}
                                            <div className="bg-cyan-500/10 border border-cyan-500/30 rounded-xl p-4 mb-6">
                                                <h3 className="font-bold mb-2 text-cyan-300 flex items-center gap-2">
                                                    <span>ğŸ’¡</span>ã“ã®ã‚·ãƒŠãƒªã‚ªã§å­¦ã‚“ã ã“ã¨
                                                </h3>
                                                <p className="text-sm text-gray-300 mb-2">{currentScenarioData.summary.learned}</p>
                                                <p className="text-xs text-gray-400">{currentScenarioData.summary.key_point}</p>
                                            </div>

                                            <button
                                                onClick={handleNextScenario}
                                                className="w-full btn-primary text-white font-bold py-4 px-8 rounded-2xl text-lg"
                                            >
                                                {currentScenario < SCENARIOS.length - 1 ? 'æ¬¡ã®ã‚·ãƒŠãƒªã‚ªã¸' : 'æœ€çµ‚è©•ä¾¡ã¸'}
                                            </button>
                                        </>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // æœ€çµ‚è©•ä¾¡
        const FinalDebriefing = ({ stage1Data, stage3Data, stageCreateData, onRestart, onShowData, onContinueToSurvey }) => {
            const totalTechniquesUsed = stage3Data.results.reduce((acc, r) => acc + r.post.techniques.length, 0);
            const ethicalPosts = stage3Data.results.filter(r => r.post.techniques.length === 0).length;
            
            // ç§°å·ã‚·ã‚¹ãƒ†ãƒ 
            const getTitleAndBadge = () => {
                // å‡çµã•ã‚ŒãŸå ´åˆ
                if (stage3Data.suspended) {
                    return {
                        title: 'æ°¸ä¹…å‡çµã®äºº',
                        titleId: 'suspended',
                        icon: 'ğŸ§Š',
                        color: 'from-gray-400 via-gray-500 to-gray-600',
                        bgColor: 'bg-gradient-to-r from-gray-500/20 via-gray-600/20 to-gray-700/20',
                        borderColor: 'border-gray-500/50',
                        description: `ãƒ©ã‚¦ãƒ³ãƒ‰${stage3Data.suspendedAtRound}ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå‡çµã•ã‚Œã¾ã—ãŸã€‚ã‚„ã‚Šã™ããŸã­...ã€‚ã§ã‚‚ã“ã‚ŒãŒç¾å®Ÿã®SNSãªã‚‰ã€åŒã˜æœ«è·¯ã‚’ãŸã©ã‚‹ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ã¯å°‘ãªãã‚ã‚Šã¾ã›ã‚“ã€‚`
                    };
                }

                const followers = stage3Data.totalFollowers;
                const ethics = stage3Data.finalEthics;
                
                // ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼åŒºåˆ†: ä½(ã€œ300), ä¸­(300-600), é«˜(600ã€œ)
                // ä¿¡é ¼æ€§åŒºåˆ†: ä½(ã€œ39%), ä¸­(40-69%), é«˜(70%ã€œ)
                
                if (ethics >= 70) {
                    // é«˜ä¿¡é ¼æ€§
                    if (followers >= 600) {
                        return {
                            title: 'è–äººã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼',
                            icon: 'ğŸ‘¼',
                            color: 'from-yellow-400 via-amber-400 to-orange-400',
                            bgColor: 'bg-gradient-to-r from-yellow-500/20 via-amber-500/20 to-orange-500/20',
                            borderColor: 'border-yellow-500/50',
                            description: 'é«˜ã„ä¿¡é ¼æ€§ã‚’ç¶­æŒã—ãªãŒã‚‰å¤§ããªå½±éŸ¿åŠ›ã‚’ç²å¾—ã€‚å®Ÿåœ¨ã—ãŸã‚‰å›½æ°‘æ „èª‰è³ã‚‚ã®ã€‚ç¾å®Ÿã«ã¯ã»ã¼å­˜åœ¨ã—ãªã„ä¼èª¬ã®å­˜åœ¨ã§ã™ã€‚'
                        };
                    } else if (followers >= 300) {
                        return {
                            title: 'è‰¯å¿ƒçš„ãƒã‚ºã‚Šæ‰‹',
                            icon: 'âš–ï¸',
                            color: 'from-emerald-400 via-teal-400 to-cyan-400',
                            bgColor: 'bg-gradient-to-r from-emerald-500/20 via-teal-500/20 to-cyan-500/20',
                            borderColor: 'border-emerald-500/50',
                            description: 'ä¿¡é ¼æ€§ã¨å½±éŸ¿åŠ›ã®ãƒãƒ©ãƒ³ã‚¹ã‚’ä¿ã¡ã¾ã—ãŸã€‚åœ°å‘³ã«è¦‹ãˆã¦ã€å®Ÿã¯ã“ã‚ŒãŒä¸€ç•ªé›£ã—ã„ã‚“ã§ã™ã€‚'
                        };
                    } else {
                        return {
                            title: 'æ¸…ãæ­£ã—ãç›®ç«‹ãŸãªã„äºº',
                            icon: 'ğŸŒ±',
                            color: 'from-green-400 via-emerald-400 to-teal-400',
                            bgColor: 'bg-gradient-to-r from-green-500/20 via-emerald-500/20 to-teal-500/20',
                            borderColor: 'border-green-500/50',
                            description: 'èª å®Ÿã•ã‚’æœ€å„ªå…ˆã€‚ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã¯å°‘ãªã„ã‘ã©ã€ä¿¡é ¼ã•ã‚Œã¦ã‚‹...ã¯ãšã€‚ãŸã¶ã‚“ã€‚ãã£ã¨èª°ã‹ãŒè¦‹ã¦ãã‚Œã¦ã‚‹ã€‚'
                        };
                    }
                } else if (ethics >= 40) {
                    // ä¸­ä¿¡é ¼æ€§
                    if (followers >= 600) {
                        return {
                            title: 'ã‚°ãƒ¬ãƒ¼ã‚¾ãƒ¼ãƒ³ã®è¦‡è€…',
                            icon: 'â­',
                            color: 'from-pink-400 via-rose-400 to-red-400',
                            bgColor: 'bg-gradient-to-r from-pink-500/20 via-rose-500/20 to-red-500/20',
                            borderColor: 'border-pink-500/50',
                            description: 'å¤§ããªå½±éŸ¿åŠ›ã‚’æŒã¡ã¤ã¤ã€ã‚®ãƒªã‚®ãƒªç‚ä¸Šã—ãªã„ãƒ©ã‚¤ãƒ³ã‚’æ”»ã‚ã¾ã—ãŸã€‚ç¾å®Ÿã®ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ã«å¤šã„ã‚¿ã‚¤ãƒ—ã€‚'
                        };
                    } else if (followers >= 300) {
                        return {
                            title: 'ç™ºå±•é€”ä¸Šã‚¢ã‚«ã‚¦ãƒ³ãƒˆ',
                            icon: 'ğŸ“ˆ',
                            color: 'from-blue-400 via-indigo-400 to-purple-400',
                            bgColor: 'bg-gradient-to-r from-blue-500/20 via-indigo-500/20 to-purple-500/20',
                            borderColor: 'border-blue-500/50',
                            description: 'å¯ã‚‚ãªãä¸å¯ã‚‚ãªãã€‚ã“ã®ã¾ã¾è¡Œãã‹ã€é—‡è½ã¡ã™ã‚‹ã‹ã€ã‚ãªãŸæ¬¡ç¬¬ã€‚'
                        };
                    } else {
                        return {
                            title: 'ROMå°‚ã‹ã‚‰ä¸€æ­©è¸ã¿å‡ºã—ãŸäºº',
                            icon: 'ğŸ‘€',
                            color: 'from-slate-400 via-gray-400 to-zinc-400',
                            bgColor: 'bg-gradient-to-r from-slate-500/20 via-gray-500/20 to-zinc-500/20',
                            borderColor: 'border-slate-500/50',
                            description: 'ãŠã¨ãªã—ã‚ã®ç™ºä¿¡ã€‚ã€Œã„ã„ã­ã€ã¯ã™ã‚‹ã‘ã©æŠ•ç¨¿ã¯æ§ãˆã‚ã€‚ãã‚Œã¯ãã‚Œã§è³¢ã„é¸æŠã‹ã‚‚ï¼Ÿ'
                        };
                    }
                } else {
                    // ä½ä¿¡é ¼æ€§
                    if (followers >= 600) {
                        return {
                            title: 'é—‡ã®ã‚«ãƒªã‚¹ãƒ',
                            icon: 'ğŸ’€',
                            color: 'from-red-400 via-rose-500 to-pink-500',
                            bgColor: 'bg-gradient-to-r from-red-500/20 via-rose-500/20 to-pink-500/20',
                            borderColor: 'border-red-500/50',
                            description: 'å¤§é‡ã®ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã‚’ç²å¾—ã—ãŸã‘ã©ã€ã¿ã‚“ãªã‚’é¨™ã—ã¦å¾—ãŸäººæ°—ã§ã™ã€‚ç¾å®Ÿãªã‚‰è¨´è¨Ÿãƒªã‚¹ã‚¯ç‰¹å¤§ã€‚ã„ã¤ã‹ç—›ã„ç›®è¦‹ã‚‹ã‚¿ã‚¤ãƒ—ã€‚'
                        };
                    } else if (followers >= 300) {
                        return {
                            title: 'ç‚ä¸ŠèŠ¸äººè¦‹ç¿’ã„',
                            icon: 'ğŸ”¥',
                            color: 'from-orange-400 via-red-400 to-rose-400',
                            bgColor: 'bg-gradient-to-r from-orange-500/20 via-red-500/20 to-rose-500/20',
                            borderColor: 'border-orange-500/50',
                            description: 'æ³¨ç›®ã¯é›†ã¾ã£ã¦ã‚‹ã‘ã©ã€ã ã„ãŸã„æ‰¹åˆ¤ã€‚ã€Œç‚ä¸Šå•†æ³•ã€ã¨ã„ã†è¨€è‘‰ã‚’ä½“ç¾ä¸­ã€‚æ¶ˆç«å™¨ã®ç”¨æ„ã‚’æ¨å¥¨ã€‚'
                        };
                    } else {
                        return {
                            title: 'ã‚¹ãƒ™ã‚Šæ•£ã‚‰ã‹ã—ãŸäºº',
                            icon: 'ğŸ¦—',
                            color: 'from-gray-400 via-slate-400 to-zinc-400',
                            bgColor: 'bg-gradient-to-r from-gray-500/20 via-slate-500/20 to-zinc-500/20',
                            borderColor: 'border-gray-500/50',
                            description: 'æ“ä½œçš„ãªæŠ•ç¨¿ã‚’ã—ãŸã®ã«èª°ã«ã‚‚éŸ¿ã‹ãªã‹ã£ãŸ...ã€‚ã‚ã‚‹æ„å‘³ä¸€ç•ªæ‚²ã—ã„çµæœ«ã€‚ã§ã‚‚è¢«å®³è€…ãŒå‡ºãªã‹ã£ãŸã®ã¯ä¸å¹¸ä¸­ã®å¹¸ã„ï¼Ÿ'
                        };
                    }
                }
            };
            
            const badge = getTitleAndBadge();
            
            // ç´¯è¨ˆæ‹¡æ•£å½±éŸ¿ã‚’è¨ˆç®—
            const calculateTotalImpact = () => {
                let totalReach = 0;
                let totalBelievers = 0;
                
                stage3Data.results.forEach(result => {
                    const techniques = result.post.techniques;
                    const manipulationLevel = techniques.length;
                    const isManipulative = manipulationLevel > 0;
                    
                    const primaryReach = result.newFollowers;
                    const secondaryReach = Math.round(result.shares * 150 * (1 + manipulationLevel * 0.3));
                    const tertiaryReach = Math.round(secondaryReach * 0.2 * (1 + manipulationLevel * 0.2));
                    
                    const roundReach = primaryReach + secondaryReach + tertiaryReach;
                    totalReach += roundReach;
                    
                    if (isManipulative) {
                        const believerRate = 0.3 + manipulationLevel * 0.15;
                        totalBelievers += Math.round(roundReach * believerRate * 0.5);
                    }
                });
                
                return { totalReach, totalBelievers };
            };
            
            const { totalReach, totalBelievers } = calculateTotalImpact();

            return (
                <div className="min-h-screen p-4 flex items-center justify-center">
                    <div className="max-w-3xl w-full animate-fade-in">
                        <div className="glass rounded-3xl p-6 md:p-8">
                            <h1 className="text-3xl font-bold text-center mb-6 bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                                æœ€çµ‚è©•ä¾¡
                            </h1>

                            {/* ç§°å·è¡¨ç¤º */}
                            <div className={`${badge.bgColor} border ${badge.borderColor} rounded-2xl p-6 mb-6 text-center`}>
                                <div className="text-5xl mb-3">{badge.icon}</div>
                                <h2 className={`text-2xl font-black mb-2 bg-gradient-to-r ${badge.color} bg-clip-text text-transparent`}>
                                    {badge.title}
                                </h2>
                                <p className="text-gray-300 text-sm leading-relaxed">
                                    {badge.description}
                                </p>
                            </div>

                            {/* Stage1çµæœ */}
                            <div className="bg-white/5 rounded-2xl p-6 mb-6">
                                <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                                    <span className="text-2xl">ğŸ¯</span> Stage 1: è¦‹ç ´ã‚‹åŠ›
                                </h2>
                                <div className="grid grid-cols-2 gap-4 mb-4">
                                    <div className="bg-indigo-500/20 rounded-xl p-4 text-center">
                                        <p className="text-xs text-gray-400">æ­£ç­”ç‡</p>
                                        <p className="text-3xl font-bold text-indigo-400">{stage1Data.accuracy}%</p>
                                    </div>
                                    <div className="bg-purple-500/20 rounded-xl p-4 text-center">
                                        <p className="text-xs text-gray-400">ã‚¹ã‚³ã‚¢</p>
                                        <p className="text-3xl font-bold text-purple-400">{stage1Data.score}</p>
                                    </div>
                                </div>
                                
                                {stage1Data.weakTechniques.length > 0 && (
                                    <div>
                                        <p className="text-sm text-gray-400 mb-2">è‹¦æ‰‹ãªæŠ€æ³•:</p>
                                        <div className="flex flex-wrap gap-2">
                                            {stage1Data.weakTechniques.map(tech => (
                                                <TechniqueTag key={tech} techniqueId={tech} />
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Stage3çµæœ */}
                            <div className="bg-white/5 rounded-2xl p-6 mb-6">
                                <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                                    <span className="text-2xl">ğŸ“±</span> Stage 2: ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ä½“é¨“
                                </h2>
                                <div className="grid grid-cols-3 gap-4 mb-4">
                                    <div className="bg-indigo-500/20 rounded-xl p-4 text-center">
                                        <p className="text-xs text-gray-400">æœ€çµ‚ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼</p>
                                        <p className="text-2xl font-bold text-indigo-400">{stage3Data.totalFollowers.toLocaleString()}</p>
                                    </div>
                                    <div className={`${stage3Data.finalEthics >= 50 ? 'bg-green-500/20' : 'bg-red-500/20'} rounded-xl p-4 text-center`}>
                                        <p className="text-xs text-gray-400">æœ€çµ‚ä¿¡é ¼æ€§</p>
                                        <p className={`text-2xl font-bold ${stage3Data.finalEthics >= 50 ? 'text-green-400' : 'text-red-400'}`}>
                                            {stage3Data.finalEthics}%
                                        </p>
                                    </div>
                                    <div className="bg-purple-500/20 rounded-xl p-4 text-center">
                                        <p className="text-xs text-gray-400">ä½¿ç”¨æŠ€æ³•æ•°</p>
                                        <p className="text-2xl font-bold text-purple-400">{totalTechniquesUsed}</p>
                                    </div>
                                </div>

                                <div className="bg-white/5 rounded-xl p-4">
                                    <p className="text-sm text-gray-400 mb-2">ã‚ãªãŸã®å‚¾å‘:</p>
                                    {ethicalPosts >= 3 ? (
                                        <p className="text-green-400">
                                            ğŸ‘ å€«ç†çš„ãªæƒ…å ±ç™ºä¿¡ã‚’å¿ƒãŒã‘ã¦ã„ã¾ã—ãŸã€‚ä¿¡é ¼æ€§ã‚’ç¶­æŒã—ãªãŒã‚‰å½±éŸ¿åŠ›ã‚’ç¯‰ãã“ã¨ãŒã§ãã¾ã—ãŸã€‚
                                        </p>
                                    ) : ethicalPosts >= 1 ? (
                                        <p className="text-yellow-400">
                                            âš–ï¸ æ‹¡æ•£åŠ›ã¨å€«ç†ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚ã†ã¨ã—ã¦ã„ã¾ã—ãŸã€‚æ™‚ã«æ“ä½œçš„ãªæ‰‹æ³•ã‚‚ä½¿ç”¨ã—ã¾ã—ãŸã€‚
                                        </p>
                                    ) : (
                                        <p className="text-red-400">
                                            âš ï¸ æ‹¡æ•£åŠ›ã‚’å„ªå…ˆã—ã€å¤šãã®æ“ä½œçš„æŠ€æ³•ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚çŸ­æœŸçš„ãªåŠ¹æœã¯ã‚ã‚Šã¾ã™ãŒã€é•·æœŸçš„ãªä¿¡é ¼ã‚’æãªã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
                                        </p>
                                    )}
                                </div>
                            </div>

                            {/* Stage3çµæœ: æƒ…å ±æ¤œè¨¼è¨“ç·´ */}
                            {stageCreateData && stageCreateData.scenarios && (
                                <div className="bg-white/5 rounded-2xl p-6 mb-6">
                                    <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                                        <span className="text-2xl">ğŸ”</span> Stage 3: æƒ…å ±æ¤œè¨¼è¨“ç·´
                                    </h2>
                                    
                                    <div className="space-y-4">
                                        {stageCreateData.scenarios.map((result, index) => (
                                            <div key={index} className="bg-white/5 rounded-xl p-4 border border-white/10">
                                                <div className="flex items-center justify-between mb-2">
                                                    <div className="flex items-center gap-2">
                                                        <span className={`text-xs px-2 py-0.5 rounded-full ${
                                                            result.scenario.difficultyColor === 'green' ? 'bg-green-500/20 text-green-300' :
                                                            result.scenario.difficultyColor === 'yellow' ? 'bg-yellow-500/20 text-yellow-300' :
                                                            'bg-red-500/20 text-red-300'
                                                        }`}>
                                                            {result.scenario.difficulty}
                                                        </span>
                                                        <span className="font-bold text-sm">{result.scenario.title}</span>
                                                    </div>
                                                    <span className={`text-sm font-bold ${
                                                        result.totalScore >= 7 ? 'text-green-400' :
                                                        result.totalScore >= 4 ? 'text-yellow-400' : 'text-red-400'
                                                    }`}>
                                                        {result.totalScore}/{result.maxScore}ç‚¹
                                                    </span>
                                                </div>
                                                
                                                {/* å„ã‚¹ãƒ†ãƒƒãƒ—ã®çµæœ */}
                                                <div className="flex gap-2">
                                                    {result.answers.map((answer, idx) => (
                                                        <div key={idx} className={`flex-1 text-center py-1 rounded text-xs ${
                                                            answer.score >= 3 ? 'bg-green-500/20 text-green-300' :
                                                            answer.score >= 2 ? 'bg-yellow-500/20 text-yellow-300' :
                                                            'bg-red-500/20 text-red-300'
                                                        }`}>
                                                            Step{idx + 1}: +{answer.score}
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    
                                    {/* ç·è©• */}
                                    {(() => {
                                        const totalScore = stageCreateData.scenarios.reduce((sum, s) => sum + s.totalScore, 0);
                                        const maxTotal = stageCreateData.scenarios.reduce((sum, s) => sum + s.maxScore, 0);
                                        const percentage = (totalScore / maxTotal) * 100;
                                        return (
                                            <div className={`mt-4 p-4 rounded-xl ${
                                                percentage >= 70 ? 'bg-green-500/10 border border-green-500/30' :
                                                percentage >= 40 ? 'bg-yellow-500/10 border border-yellow-500/30' :
                                                'bg-red-500/10 border border-red-500/30'
                                            }`}>
                                                <p className={`text-sm ${
                                                    percentage >= 70 ? 'text-green-300' :
                                                    percentage >= 40 ? 'text-yellow-300' : 'text-red-300'
                                                }`}>
                                                    {percentage >= 70 
                                                        ? 'ğŸ‘ ç´ æ™´ã‚‰ã—ã„æ¤œè¨¼åŠ›ï¼æƒ…å ±ã®çœŸå½ã‚’è‡ªåˆ†ã§ç¢ºèªã™ã‚‹ã‚¹ã‚­ãƒ«ãŒèº«ã«ã¤ã„ã¦ã„ã¾ã™ã€‚'
                                                        : percentage >= 40
                                                            ? 'ğŸ’ª æ¤œè¨¼ã‚¹ã‚­ãƒ«ãŒå‘ä¸Šä¸­ï¼å…¬å¼æƒ…å ±æºã‚’å„ªå…ˆã—ã¦ç¢ºèªã™ã‚‹ç¿’æ…£ã‚’ã¤ã‘ã¾ã—ã‚‡ã†ã€‚'
                                                            : 'ğŸ“š æƒ…å ±æ¤œè¨¼ã¯ç·´ç¿’ãŒå¿…è¦ã§ã™ã€‚ã€ŒæŠ•ç¨¿ã‚’èª­ã‚€ã€ã®ã§ã¯ãªãã€Œå¤–éƒ¨ã§ç¢ºèªã™ã‚‹ã€ã“ã¨ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚'}
                                                </p>
                                            </div>
                                        );
                                    })()}
                                </div>
                            )}

                            {/* ç¤¾ä¼šçš„å½±éŸ¿ï¼ˆç´¯è¨ˆæ‹¡æ•£ï¼‰ */}
                            <div className="bg-gradient-to-b from-slate-800/50 to-slate-900/50 rounded-2xl p-6 mb-6 border border-white/10">
                                <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                                    <span className="text-2xl">ğŸŒ</span> ã‚ãªãŸã®æŠ•ç¨¿ã®ç¤¾ä¼šçš„å½±éŸ¿
                                </h2>
                                
                                <div className="grid grid-cols-2 gap-4 mb-4">
                                    <div className="bg-indigo-500/20 rounded-xl p-4 text-center">
                                        <p className="text-xs text-gray-400">æ¨å®šç·ãƒªãƒ¼ãƒ</p>
                                        <p className="text-2xl font-bold text-indigo-400">{totalReach.toLocaleString()}</p>
                                        <p className="text-xs text-gray-500">äººã«å±Šãã¾ã—ãŸ</p>
                                    </div>
                                    <div className={`${totalBelievers > 0 ? 'bg-red-500/20' : 'bg-green-500/20'} rounded-xl p-4 text-center`}>
                                        <p className="text-xs text-gray-400">èª¤æƒ…å ±ã‚’ä¿¡ã˜ãŸäºº</p>
                                        <p className={`text-2xl font-bold ${totalBelievers > 0 ? 'text-red-400' : 'text-green-400'}`}>
                                            {totalBelievers > 0 ? `ç´„${totalBelievers.toLocaleString()}` : '0'}
                                        </p>
                                        <p className="text-xs text-gray-500">äººãŒå½±éŸ¿ã‚’å—ã‘ã¾ã—ãŸ</p>
                                    </div>
                                </div>
                                
                                {totalBelievers > 0 ? (
                                    <div className="bg-red-500/10 border border-red-500/30 rounded-xl p-4">
                                        <p className="text-sm text-red-300 leading-relaxed">
                                            <span className="font-bold">âš ï¸ è€ƒãˆã¦ã¿ã¦ãã ã•ã„ï¼š</span><br />
                                            ã‚ãªãŸã®æŠ•ç¨¿ã«ã‚ˆã‚Šã€ç´„{totalBelievers.toLocaleString()}äººãŒèª¤ã£ãŸæƒ…å ±ã‚’ä¿¡ã˜ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
                                            ãã®ä¸­ã«ã¯ã€é–“é•ã£ãŸå¥åº·æ³•ã‚’å®Ÿè·µã—ãŸã‚Šã€å¿…è¦ãªåŒ»ç™‚ã‚’å—ã‘ãªã‹ã£ãŸã‚Šã™ã‚‹äººãŒã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
                                        </p>
                                    </div>
                                ) : (
                                    <div className="bg-green-500/10 border border-green-500/30 rounded-xl p-4">
                                        <p className="text-sm text-green-300 leading-relaxed">
                                            <span className="font-bold">âœ¨ ç´ æ™´ã‚‰ã—ã„é¸æŠã§ã—ãŸï¼š</span><br />
                                            ã‚ãªãŸã¯èª å®Ÿãªæƒ…å ±ç™ºä¿¡ã‚’å¿ƒãŒã‘ã¾ã—ãŸã€‚{totalReach.toLocaleString()}äººã«æ­£ç¢ºãªæƒ…å ±ã‚’å±Šã‘ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
                                        </p>
                                    </div>
                                )}
                            </div>

                            {/* å­¦ã³ã®ã¾ã¨ã‚ */}
                            <div className="bg-gradient-to-r from-indigo-500/20 via-purple-500/20 to-pink-500/20 rounded-2xl p-6 mb-6">
                                <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                                    <span className="text-2xl">ğŸ’¡</span> å­¦ã³ã®ã¾ã¨ã‚
                                </h2>
                                <ul className="space-y-3 text-gray-300">
                                    <li className="flex items-start gap-2">
                                        <span className="text-indigo-400">â€¢</span>
                                        ãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•ã¯ã€ç§ãŸã¡ã®æ„Ÿæƒ…ã‚„åˆ¤æ–­ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ãŸã‚ã«ä½¿ã‚ã‚Œã¾ã™
                                    </li>
                                    <li className="flex items-start gap-2">
                                        <span className="text-purple-400">â€¢</span>
                                        æ”»æ’ƒè€…ã®è¦–ç‚¹ã‚’ç†è§£ã™ã‚‹ã“ã¨ã§ã€æ“ä½œçš„ãªæƒ…å ±ã‚’è¦‹æŠœãã‚„ã™ããªã‚Šã¾ã™
                                    </li>
                                    <li className="flex items-start gap-2">
                                        <span className="text-pink-400">â€¢</span>
                                        çŸ­æœŸçš„ãªæ‹¡æ•£åŠ›ã¨é•·æœŸçš„ãªä¿¡é ¼æ€§ã¯ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã®é–¢ä¿‚ã«ã‚ã‚Šã¾ã™
                                    </li>
                                    <li className="flex items-start gap-2">
                                        <span className="text-cyan-400">â€¢</span>
                                        æƒ…å ±ã‚’å—ã‘å–ã‚‹éš›ã‚‚ç™ºä¿¡ã™ã‚‹éš›ã‚‚ã€æŠ€æ³•ã®å­˜åœ¨ã‚’æ„è­˜ã™ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™
                                    </li>
                                </ul>
                            </div>

                            {/* ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã¸é€²ã‚€ãƒœã‚¿ãƒ³ */}
                            <button
                                onClick={onContinueToSurvey}
                                className="w-full btn-primary text-white font-bold py-4 px-6 rounded-2xl mb-4 flex items-center justify-center gap-2"
                            >
                                <span>ğŸ“</span> ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«å›ç­”ã™ã‚‹ï¼ˆæœ€å¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ï¼‰
                            </button>

                            <div className="flex gap-4">
                                <button
                                    onClick={onShowData}
                                    className="flex-1 bg-white/10 hover:bg-white/20 text-white font-bold py-3 px-6 rounded-2xl transition-all flex items-center justify-center gap-2 text-sm"
                                >
                                    <span>ğŸ“Š</span> ãƒ‡ãƒ¼ã‚¿ã‚’å…ˆã«å‡ºåŠ›
                                </button>
                                <button
                                    onClick={onRestart}
                                    className="flex-1 bg-white/10 hover:bg-white/20 text-white font-bold py-3 px-6 rounded-2xl transition-all text-sm"
                                >
                                    ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤ã™ã‚‹
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // äº‹å¾Œã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        const PostSurvey = ({ onComplete, onShowData }) => {
            const [responses, setResponses] = useState({
                enjoyment: 0,        // æ¥½ã—ã•
                understanding: 0,    // ç†è§£åº¦
                behaviorChange: 0,   // è¡Œå‹•å¤‰å®¹æ„å›³
                difficulty: 0,       // é›£æ˜“åº¦
                recommendation: 0,   // æ¨å¥¨åº¦
                freeComment: ''      // è‡ªç”±è¨˜è¿°
            });

            const questions = [
                {
                    id: 'enjoyment',
                    text: 'ã“ã®ã‚²ãƒ¼ãƒ ã¯æ¥½ã—ã‹ã£ãŸã§ã™ã‹ï¼Ÿ',
                    labels: ['å…¨ãæ¥½ã—ããªã‹ã£ãŸ', 'ã‚ã¾ã‚Šæ¥½ã—ããªã‹ã£ãŸ', 'ã©ã¡ã‚‰ã¨ã‚‚è¨€ãˆãªã„', 'ã¾ã‚æ¥½ã—ã‹ã£ãŸ', 'ã¨ã¦ã‚‚æ¥½ã—ã‹ã£ãŸ']
                },
                {
                    id: 'understanding',
                    text: 'ãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•ã«ã¤ã„ã¦ç†è§£ãŒæ·±ã¾ã‚Šã¾ã—ãŸã‹ï¼Ÿ',
                    labels: ['å…¨ãæ·±ã¾ã‚‰ãªã‹ã£ãŸ', 'ã‚ã¾ã‚Šæ·±ã¾ã‚‰ãªã‹ã£ãŸ', 'ã©ã¡ã‚‰ã¨ã‚‚è¨€ãˆãªã„', 'ã¾ã‚æ·±ã¾ã£ãŸ', 'ã¨ã¦ã‚‚æ·±ã¾ã£ãŸ']
                },
                {
                    id: 'behaviorChange',
                    text: 'ä»Šå¾Œã€SNSã§å¥åº·æƒ…å ±ã‚’è¦‹ã‚‹ã¨ãã®æ„è­˜ãŒå¤‰ã‚ã‚Šãã†ã§ã™ã‹ï¼Ÿ',
                    labels: ['å…¨ãå¤‰ã‚ã‚‰ãªã„', 'ã‚ã¾ã‚Šå¤‰ã‚ã‚‰ãªã„', 'ã©ã¡ã‚‰ã¨ã‚‚è¨€ãˆãªã„', 'ã¾ã‚å¤‰ã‚ã‚Šãã†', 'ã¨ã¦ã‚‚å¤‰ã‚ã‚Šãã†']
                },
                {
                    id: 'difficulty',
                    text: 'ã‚²ãƒ¼ãƒ ã®é›£æ˜“åº¦ã¯ã„ã‹ãŒã§ã—ãŸã‹ï¼Ÿ',
                    labels: ['ã¨ã¦ã‚‚ç°¡å˜', 'ã‚„ã‚„ç°¡å˜', 'ã¡ã‚‡ã†ã©è‰¯ã„', 'ã‚„ã‚„é›£ã—ã„', 'ã¨ã¦ã‚‚é›£ã—ã„']
                },
                {
                    id: 'recommendation',
                    text: 'ã“ã®ã‚²ãƒ¼ãƒ ã‚’ä»–ã®äººã«ã‚‚å‹§ã‚ãŸã„ã§ã™ã‹ï¼Ÿ',
                    labels: ['å…¨ãå‹§ã‚ãªã„', 'ã‚ã¾ã‚Šå‹§ã‚ãªã„', 'ã©ã¡ã‚‰ã¨ã‚‚è¨€ãˆãªã„', 'ã¾ã‚å‹§ã‚ãŸã„', 'ãœã²å‹§ã‚ãŸã„']
                }
            ];

            const allAnswered = questions.every(q => responses[q.id] > 0);

            const handleSubmit = () => {
                onComplete(responses);
            };

            return (
                <div className="min-h-screen p-4 flex items-center justify-center">
                    <div className="max-w-2xl w-full animate-fade-in">
                        <div className="glass rounded-3xl p-6 md:p-8">
                            <div className="text-center mb-8">
                                <div className="text-5xl mb-4">ğŸ“</div>
                                <h1 className="text-2xl font-bold mb-2">äº‹å¾Œã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ</h1>
                                <p className="text-gray-400 text-sm">
                                    æœ€å¾Œã«ã€ã‚²ãƒ¼ãƒ ã«ã¤ã„ã¦ã®ã”æ„è¦‹ã‚’ãŠèã‹ã›ãã ã•ã„
                                </p>
                            </div>

                            <div className="space-y-6 mb-8">
                                {questions.map((question, qIndex) => (
                                    <div key={question.id} className="bg-white/5 rounded-2xl p-5">
                                        <p className="text-sm font-medium text-gray-200 mb-4">
                                            Q{qIndex + 1}. {question.text}
                                        </p>
                                        <div className="flex justify-between gap-2">
                                            {[1, 2, 3, 4, 5].map((value) => (
                                                <button
                                                    key={value}
                                                    onClick={() => setResponses(prev => ({ ...prev, [question.id]: value }))}
                                                    className={`flex-1 py-3 px-2 rounded-xl text-xs font-medium transition-all ${
                                                        responses[question.id] === value
                                                            ? 'bg-indigo-500 text-white'
                                                            : 'bg-white/10 text-gray-400 hover:bg-white/20'
                                                    }`}
                                                >
                                                    <div className="text-lg mb-1">{value}</div>
                                                    <div className="hidden md:block text-xs leading-tight">{question.labels[value - 1]}</div>
                                                </button>
                                            ))}
                                        </div>
                                        {/* ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒ©ãƒ™ãƒ« */}
                                        <div className="flex justify-between mt-2 md:hidden">
                                            <span className="text-xs text-gray-500">{question.labels[0]}</span>
                                            <span className="text-xs text-gray-500">{question.labels[4]}</span>
                                        </div>
                                    </div>
                                ))}

                                {/* è‡ªç”±è¨˜è¿° */}
                                <div className="bg-white/5 rounded-2xl p-5">
                                    <p className="text-sm font-medium text-gray-200 mb-4">
                                        Q6. ã”æ„è¦‹ãƒ»ã”æ„Ÿæƒ³ãŒã‚ã‚Œã°ãŠèã‹ã›ãã ã•ã„ï¼ˆä»»æ„ï¼‰
                                    </p>
                                    <textarea
                                        value={responses.freeComment}
                                        onChange={(e) => setResponses(prev => ({ ...prev, freeComment: e.target.value }))}
                                        placeholder="æ”¹å–„ç‚¹ã€æ°—ã¥ã„ãŸã“ã¨ã€æ„Ÿæƒ³ãªã©..."
                                        className="w-full bg-slate-700 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 transition-colors resize-none h-24"
                                        style={{ backgroundColor: '#334155' }}
                                    />
                                </div>
                            </div>

                            <button
                                onClick={handleSubmit}
                                disabled={!allAnswered}
                                className={`w-full font-bold py-4 px-8 rounded-2xl text-lg transition-all mb-4 ${
                                    allAnswered
                                        ? 'btn-primary text-white'
                                        : 'bg-gray-700 text-gray-500 cursor-not-allowed'
                                }`}
                            >
                                {allAnswered ? 'å›ç­”ã‚’é€ä¿¡ã—ã¦å®Œäº†' : 'ã™ã¹ã¦ã®è³ªå•ã«å›ç­”ã—ã¦ãã ã•ã„'}
                            </button>

                            <button
                                onClick={onShowData}
                                className="w-full bg-white/10 hover:bg-white/20 text-white font-bold py-3 px-6 rounded-2xl transition-all flex items-center justify-center gap-2 text-sm"
                            >
                                <span>ğŸ“Š</span> ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // å®Œäº†ç”»é¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        const CompletionScreen = ({ onShowData, onRestart }) => {
            return (
                <div className="min-h-screen p-4 flex items-center justify-center">
                    <div className="max-w-2xl w-full animate-fade-in">
                        <div className="glass rounded-3xl p-8 md:p-12 text-center">
                            <div className="text-6xl mb-6">ğŸ‰</div>
                            <h1 className="text-3xl font-bold mb-4 bg-gradient-to-r from-green-400 via-emerald-400 to-teal-400 bg-clip-text text-transparent">
                                ã”å”åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼
                            </h1>
                            <p className="text-gray-300 mb-8 leading-relaxed">
                                ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚<br />
                                ã“ã®ã‚²ãƒ¼ãƒ ã§å­¦ã‚“ã ã“ã¨ã‚’ã€æ—¥å¸¸ã®SNSåˆ©ç”¨ã«æ´»ã‹ã—ã¦ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚
                            </p>

                            <div className="bg-white/5 rounded-2xl p-6 mb-8 text-left">
                                <h2 className="font-bold text-lg mb-4 flex items-center gap-2">
                                    <span>ğŸ’¡</span> ä»Šæ—¥ã‹ã‚‰å®Ÿè·µã§ãã‚‹ã“ã¨
                                </h2>
                                <ul className="space-y-3 text-gray-300 text-sm">
                                    <li className="flex items-start gap-2">
                                        <span className="text-green-400">âœ“</span>
                                        ã€Œã™ãã«è¡Œå‹•ã—ãªã„ã¨ã€ã¨ç„¦ã‚‰ã›ã‚‹æƒ…å ±ã¯ä¸€åº¦ç«‹ã¡æ­¢ã¾ã‚‹
                                    </li>
                                    <li className="flex items-start gap-2">
                                        <span className="text-green-400">âœ“</span>
                                        ã€Œå°‚é–€å®¶ãŒè¨€ã£ã¦ã„ã‚‹ã€ã®å°‚é–€å®¶ãŒå®Ÿåœ¨ã™ã‚‹ã‹ç¢ºèªã™ã‚‹
                                    </li>
                                    <li className="flex items-start gap-2">
                                        <span className="text-green-400">âœ“</span>
                                        å…·ä½“çš„ãªæ•°å­—ãŒå‡ºã¦ããŸã‚‰ã€å‡ºå…¸ã‚„ã‚µãƒ³ãƒ—ãƒ«æ•°ã‚’ç¢ºèªã™ã‚‹
                                    </li>
                                    <li className="flex items-start gap-2">
                                        <span className="text-green-400">âœ“</span>
                                        ã€Œã¿ã‚“ãªã‚„ã£ã¦ã„ã‚‹ã€ã«æµã•ã‚Œãšã€è‡ªåˆ†ã§åˆ¤æ–­ã™ã‚‹
                                    </li>
                                </ul>
                            </div>

                            <div className="flex gap-4">
                                <button
                                    onClick={onShowData}
                                    className="flex-1 btn-primary text-white font-bold py-4 px-6 rounded-2xl flex items-center justify-center gap-2"
                                >
                                    <span>ğŸ“Š</span> ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›
                                </button>
                                <button
                                    onClick={onRestart}
                                    className="flex-1 bg-white/10 hover:bg-white/20 text-white font-bold py-4 px-6 rounded-2xl transition-all"
                                >
                                    ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Stage2èª¬æ˜ç”»é¢ï¼ˆStage1ã¨Stage3ã®é–“ï¼‰
        const Stage2Intro = ({ stage1Data, onContinue }) => {
            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="max-w-2xl w-full animate-fade-in">
                        <div className="glass rounded-3xl p-8 md:p-12">
                            {/* Stage1ã®çµæœã‚µãƒãƒªãƒ¼ */}
                            <div className="text-center mb-8">
                                <div className="text-6xl mb-4">ğŸ¯</div>
                                <h1 className="text-3xl font-bold mb-2">Stage 1 å®Œäº†ï¼</h1>
                                <p className="text-gray-400">ãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•ã‚’è¦‹ç ´ã‚‹è¨“ç·´ãŒçµ‚ã‚ã‚Šã¾ã—ãŸ</p>
                            </div>

                            <div className="bg-white/5 rounded-2xl p-6 mb-8">
                                <div className="grid grid-cols-2 gap-4 mb-4">
                                    <div className="text-center">
                                        <p className="text-sm text-gray-400">æ­£ç­”ç‡</p>
                                        <p className={`text-3xl font-bold ${
                                            stage1Data.accuracy >= 70 ? 'text-green-400' : 
                                            stage1Data.accuracy >= 50 ? 'text-yellow-400' : 'text-red-400'
                                        }`}>
                                            {stage1Data.accuracy}%
                                        </p>
                                    </div>
                                    <div className="text-center">
                                        <p className="text-sm text-gray-400">ã‚¹ã‚³ã‚¢</p>
                                        <p className="text-3xl font-bold text-indigo-400">{stage1Data.score}</p>
                                    </div>
                                </div>
                                
                                {stage1Data.weakTechniques.length > 0 && (
                                    <div className="border-t border-white/10 pt-4">
                                        <p className="text-sm text-gray-400 mb-2">è¦‹ç ´ã‚Šã«ãã‹ã£ãŸæŠ€æ³•:</p>
                                        <div className="flex flex-wrap gap-2">
                                            {stage1Data.weakTechniques.map(tech => (
                                                <TechniqueTag key={tech} techniqueId={tech} />
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Stage2ã®èª¬æ˜ */}
                            <div className="bg-gradient-to-r from-purple-500/20 via-indigo-500/20 to-pink-500/20 rounded-2xl p-6 mb-8">
                                <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                                    <span className="text-2xl">ğŸ“±</span>
                                    æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ï¼šã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ä½“é¨“
                                </h2>
                                
                                <p className="text-gray-300 leading-relaxed mb-4">
                                    ä»Šåº¦ã¯<strong className="text-purple-400">æ”»æ’ƒè€…ã®è¦–ç‚¹</strong>ã‚’ä½“é¨“ã—ã¾ã™ã€‚
                                    ã‚ãªãŸã¯å¥åº·æƒ…å ±ã‚’ç™ºä¿¡ã™ã‚‹ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ã«ãªã‚Šã€
                                    ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã‚’å¢—ã‚„ã™ãŸã‚ã«æŠ•ç¨¿ã‚’é¸ã‚“ã§ã„ãã¾ã™ã€‚
                                </p>

                                <div className="space-y-3 mb-4">
                                    <div className="flex items-start gap-3">
                                        <span className="bg-indigo-500/30 text-indigo-300 rounded-full w-7 h-7 flex items-center justify-center font-bold shrink-0 text-sm">1</span>
                                        <p className="text-gray-300 text-sm">
                                            <strong>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¸æŠ</strong>ï¼šã©ã®å±¤ã«å‘ã‘ã¦æŠ•ç¨¿ã™ã‚‹ã‹æ±ºã‚ã‚‹
                                        </p>
                                    </div>
                                    <div className="flex items-start gap-3">
                                        <span className="bg-indigo-500/30 text-indigo-300 rounded-full w-7 h-7 flex items-center justify-center font-bold shrink-0 text-sm">2</span>
                                        <p className="text-gray-300 text-sm">
                                            <strong>æŠ•ç¨¿é¸æŠ</strong>ï¼š3ã¤ã®é¸æŠè‚¢ã‹ã‚‰æŠ•ç¨¿å†…å®¹ã‚’é¸ã¶
                                        </p>
                                    </div>
                                    <div className="flex items-start gap-3">
                                        <span className="bg-indigo-500/30 text-indigo-300 rounded-full w-7 h-7 flex items-center justify-center font-bold shrink-0 text-sm">3</span>
                                        <p className="text-gray-300 text-sm">
                                            <strong>çµæœç¢ºèª</strong>ï¼šãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ã¨ä¿¡é ¼æ€§ã®å¤‰åŒ–ã‚’è¦‹ã‚‹
                                        </p>
                                    </div>
                                </div>

                                <div className="bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4">
                                    <p className="text-yellow-300 text-sm font-medium mb-1">ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆ</p>
                                    <p className="text-gray-300 text-sm">
                                        æ“ä½œçš„ãªãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•ã‚’ä½¿ãˆã°ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã¯å¢—ãˆã¾ã™ãŒã€
                                        <strong className="text-red-400">ä¿¡é ¼æ€§ãŒä¸‹ãŒã‚Šã¾ã™</strong>ã€‚
                                        çŸ­æœŸçš„ãªåˆ©ç›Šã¨é•·æœŸçš„ãªä¿¡é ¼ã®ãƒãƒ©ãƒ³ã‚¹ã‚’è€ƒãˆãªãŒã‚‰ãƒ—ãƒ¬ã‚¤ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
                                    </p>
                                </div>
                            </div>

                            {/* 3ã¤ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ç´¹ä»‹ */}
                            <div className="mb-8">
                                <h3 className="text-lg font-bold mb-4 text-center">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ã®ç‰¹å¾´</h3>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                    {Object.values(TARGETS).map(target => (
                                        <div key={target.id} className="bg-white/5 rounded-xl p-4 text-center">
                                            <div className="text-3xl mb-2">{target.icon}</div>
                                            <h4 className="font-bold text-sm mb-1">{target.name}</h4>
                                            <p className="text-xs text-gray-400">{target.traits}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <button
                                onClick={onContinue}
                                className="w-full btn-primary text-white font-bold py-4 px-8 rounded-2xl text-lg"
                            >
                                Stage 2 ã‚’å§‹ã‚ã‚‹
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // åŒæ„ç”»é¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        const ConsentScreen = ({ onAgree, experimentCondition }) => {
            const [agreed, setAgreed] = useState(false);
            const [participantId, setParticipantId] = useState('');
            const [demographics, setDemographics] = useState({
                ageGroup: '',
                gender: '',
                snsFrequency: '',
                healthInfoSource: ''
            });

            const handleSubmit = () => {
                onAgree({
                    participantId: participantId.trim() || null,
                    demographics: {
                        ageGroup: demographics.ageGroup || null,
                        gender: demographics.gender || null,
                        snsFrequency: demographics.snsFrequency || null,
                        healthInfoSource: demographics.healthInfoSource || null
                    }
                });
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="max-w-2xl w-full animate-fade-in">
                        <div className="glass rounded-3xl p-8 md:p-12">
                            <div className="text-center mb-8">
                                <div className="text-6xl mb-4">ğŸ“‹</div>
                                <h1 className="text-3xl font-bold mb-2">ç ”ç©¶å‚åŠ ã¸ã®åŒæ„</h1>
                                <p className="text-gray-400">ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹å‰ã«ãŠèª­ã¿ãã ã•ã„</p>
                                {experimentCondition && (
                                    <p className="text-xs text-indigo-400 mt-2">æ¡ä»¶: {experimentCondition}</p>
                                )}
                            </div>

                            <div className="bg-white/5 rounded-2xl p-6 mb-6 max-h-60 overflow-y-auto scrollbar-hide">
                                <h2 className="font-bold text-lg mb-4">ç ”ç©¶ã®ç›®çš„</h2>
                                <p className="text-gray-300 text-sm leading-relaxed mb-4">
                                    æœ¬ç ”ç©¶ã¯ã€å¥åº·æƒ…å ±ã«é–¢ã™ã‚‹ãƒ¡ãƒ‡ã‚£ã‚¢ãƒªãƒ†ãƒ©ã‚·ãƒ¼æ•™è‚²ã®åŠ¹æœã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚
                                    ã“ã®ã‚²ãƒ¼ãƒ ã§ã¯ã€SNSä¸Šã§ä½¿ç”¨ã•ã‚Œã‚‹èª¬å¾—æŠ€æ³•ï¼ˆãƒ¬ãƒˆãƒªãƒƒã‚¯æŠ€æ³•ï¼‰ã‚’å­¦ã³ã€
                                    èª¤æƒ…å ±ã‚’è¦‹æŠœãåŠ›ã‚’é¤Šã†ã“ã¨ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚
                                </p>

                                <h2 className="font-bold text-lg mb-4">åé›†ã™ã‚‹ãƒ‡ãƒ¼ã‚¿</h2>
                                <ul className="text-gray-300 text-sm space-y-2 mb-4">
                                    <li>â€¢ ã‚²ãƒ¼ãƒ å†…ã§ã®å›ç­”å†…å®¹ã¨æ­£èª¤</li>
                                    <li>â€¢ å„ã‚¹ãƒ†ãƒ¼ã‚¸ã®æ‰€è¦æ™‚é–“</li>
                                    <li>â€¢ é¸æŠã—ãŸæŠ•ç¨¿ã¨ãã®çµæœ</li>
                                    <li>â€¢ åŸºæœ¬å±æ€§ï¼ˆä»»æ„å›ç­”ï¼‰</li>
                                </ul>
                                <p className="text-gray-400 text-sm mb-4">
                                    â€» å€‹äººã‚’ç‰¹å®šã§ãã‚‹æƒ…å ±ï¼ˆæ°åã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç­‰ï¼‰ã¯åé›†ã—ã¾ã›ã‚“ã€‚
                                </p>

                                <h2 className="font-bold text-lg mb-4">ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šæ‰±ã„</h2>
                                <p className="text-gray-300 text-sm leading-relaxed mb-4">
                                    åé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã¯ç ”ç©¶ç›®çš„ã®ã¿ã«ä½¿ç”¨ã•ã‚Œã€çµ±è¨ˆçš„ã«å‡¦ç†ã•ã‚ŒãŸå½¢ã§
                                    å­¦è¡“è«–æ–‡ã‚„ç™ºè¡¨ã§ä½¿ç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
                                    ãƒ‡ãƒ¼ã‚¿ã¯å³é‡ã«ç®¡ç†ã•ã‚Œã€ç ”ç©¶çµ‚äº†å¾Œã¯é©åˆ‡ã«å»ƒæ£„ã•ã‚Œã¾ã™ã€‚
                                </p>

                                <h2 className="font-bold text-lg mb-4">å‚åŠ ã®ä»»æ„æ€§</h2>
                                <p className="text-gray-300 text-sm leading-relaxed">
                                    æœ¬ç ”ç©¶ã¸ã®å‚åŠ ã¯ä»»æ„ã§ã™ã€‚å‚åŠ ã«åŒæ„ã—ãŸå¾Œã§ã‚‚ã€
                                    ã„ã¤ã§ã‚‚å‚åŠ ã‚’ä¸­æ­¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
                                    å‚åŠ ã‚’ä¸­æ­¢ã—ã¦ã‚‚ã€ä¸åˆ©ç›Šã‚’å—ã‘ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
                                </p>
                            </div>

                            {/* è¢«é¨“è€…IDå…¥åŠ› */}
                            <div className="bg-white/5 rounded-2xl p-4 mb-4">
                                <label className="block text-sm font-medium text-gray-300 mb-2">
                                    è¢«é¨“è€…IDï¼ˆä»»æ„ï¼‰
                                </label>
                                <input
                                    type="text"
                                    value={participantId}
                                    onChange={(e) => setParticipantId(e.target.value)}
                                    placeholder="æŒ‡å®šã•ã‚ŒãŸIDãŒã‚ã‚Œã°å…¥åŠ›ã—ã¦ãã ã•ã„"
                                    className="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 transition-colors"
                                />
                                <p className="text-xs text-gray-500 mt-2">
                                    â€» ç©ºæ¬„ã®å ´åˆã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™
                                </p>
                            </div>

                            {/* ãƒ‡ãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯æƒ…å ± */}
                            <div className="bg-white/5 rounded-2xl p-4 mb-6">
                                <p className="text-sm font-medium text-gray-300 mb-4">
                                    åŸºæœ¬å±æ€§ï¼ˆä»»æ„ãƒ»åˆ†æã®ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ï¼‰
                                </p>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-xs text-gray-400 mb-1">å¹´ä»£</label>
                                        <select
                                            value={demographics.ageGroup}
                                            onChange={(e) => setDemographics(prev => ({ ...prev, ageGroup: e.target.value }))}
                                            className="w-full bg-slate-700 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-indigo-500 cursor-pointer"
                                            style={{ backgroundColor: '#334155' }}
                                        >
                                            <option value="" style={{ backgroundColor: '#334155' }}>é¸æŠã—ã¦ãã ã•ã„</option>
                                            <option value="10s" style={{ backgroundColor: '#334155' }}>10ä»£</option>
                                            <option value="20s" style={{ backgroundColor: '#334155' }}>20ä»£</option>
                                            <option value="30s" style={{ backgroundColor: '#334155' }}>30ä»£</option>
                                            <option value="40s" style={{ backgroundColor: '#334155' }}>40ä»£</option>
                                            <option value="50s" style={{ backgroundColor: '#334155' }}>50ä»£</option>
                                            <option value="60+" style={{ backgroundColor: '#334155' }}>60ä»£ä»¥ä¸Š</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-xs text-gray-400 mb-1">æ€§åˆ¥</label>
                                        <select
                                            value={demographics.gender}
                                            onChange={(e) => setDemographics(prev => ({ ...prev, gender: e.target.value }))}
                                            className="w-full bg-slate-700 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-indigo-500 cursor-pointer"
                                            style={{ backgroundColor: '#334155' }}
                                        >
                                            <option value="" style={{ backgroundColor: '#334155' }}>é¸æŠã—ã¦ãã ã•ã„</option>
                                            <option value="male" style={{ backgroundColor: '#334155' }}>ç”·æ€§</option>
                                            <option value="female" style={{ backgroundColor: '#334155' }}>å¥³æ€§</option>
                                            <option value="other" style={{ backgroundColor: '#334155' }}>ãã®ä»–</option>
                                            <option value="no_answer" style={{ backgroundColor: '#334155' }}>å›ç­”ã—ãªã„</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-xs text-gray-400 mb-1">SNSåˆ©ç”¨é »åº¦</label>
                                        <select
                                            value={demographics.snsFrequency}
                                            onChange={(e) => setDemographics(prev => ({ ...prev, snsFrequency: e.target.value }))}
                                            className="w-full bg-slate-700 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-indigo-500 cursor-pointer"
                                            style={{ backgroundColor: '#334155' }}
                                        >
                                            <option value="" style={{ backgroundColor: '#334155' }}>é¸æŠã—ã¦ãã ã•ã„</option>
                                            <option value="daily_heavy" style={{ backgroundColor: '#334155' }}>æ¯æ—¥2æ™‚é–“ä»¥ä¸Š</option>
                                            <option value="daily_light" style={{ backgroundColor: '#334155' }}>æ¯æ—¥2æ™‚é–“æœªæº€</option>
                                            <option value="weekly" style={{ backgroundColor: '#334155' }}>é€±ã«æ•°å›</option>
                                            <option value="rarely" style={{ backgroundColor: '#334155' }}>ã»ã¨ã‚“ã©ä½¿ã‚ãªã„</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-xs text-gray-400 mb-1">å¥åº·æƒ…å ±ã®ä¸»ãªå…¥æ‰‹å…ƒ</label>
                                        <select
                                            value={demographics.healthInfoSource}
                                            onChange={(e) => setDemographics(prev => ({ ...prev, healthInfoSource: e.target.value }))}
                                            className="w-full bg-slate-700 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-indigo-500 cursor-pointer"
                                            style={{ backgroundColor: '#334155' }}
                                        >
                                            <option value="" style={{ backgroundColor: '#334155' }}>é¸æŠã—ã¦ãã ã•ã„</option>
                                            <option value="sns" style={{ backgroundColor: '#334155' }}>SNSï¼ˆX, Instagramç­‰ï¼‰</option>
                                            <option value="search" style={{ backgroundColor: '#334155' }}>æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³</option>
                                            <option value="tv_news" style={{ backgroundColor: '#334155' }}>ãƒ†ãƒ¬ãƒ“ãƒ»ãƒ‹ãƒ¥ãƒ¼ã‚¹</option>
                                            <option value="medical" style={{ backgroundColor: '#334155' }}>åŒ»ç™‚æ©Ÿé–¢ãƒ»å°‚é–€å®¶</option>
                                            <option value="family_friends" style={{ backgroundColor: '#334155' }}>å®¶æ—ãƒ»å‹äºº</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <label className="flex items-start gap-3 mb-6 cursor-pointer group">
                                <input
                                    type="checkbox"
                                    checked={agreed}
                                    onChange={(e) => setAgreed(e.target.checked)}
                                    className="w-5 h-5 mt-1 rounded border-gray-500 bg-white/10 text-indigo-500 focus:ring-indigo-500"
                                />
                                <span className="text-gray-300 text-sm leading-relaxed group-hover:text-white transition-colors">
                                    ä¸Šè¨˜ã®å†…å®¹ã‚’ç†è§£ã—ã€ç ”ç©¶ã¸ã®å‚åŠ ã«åŒæ„ã—ã¾ã™ã€‚
                                    åé›†ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒç ”ç©¶ç›®çš„ã§ä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨ã«åŒæ„ã—ã¾ã™ã€‚
                                </span>
                            </label>

                            <button
                                onClick={handleSubmit}
                                disabled={!agreed}
                                className={`w-full font-bold py-4 px-8 rounded-2xl text-lg transition-all ${
                                    agreed
                                        ? 'btn-primary text-white'
                                        : 'bg-gray-700 text-gray-500 cursor-not-allowed'
                                }`}
                            >
                                åŒæ„ã—ã¦ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹
                            </button>

                            <p className="text-center text-gray-500 text-xs mt-4">
                                ç ”ç©¶è²¬ä»»è€…: æ³•æ”¿å¤§å­¦å¤§å­¦é™¢ æƒ…å ±ç§‘å­¦ç ”ç©¶ç§‘
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        const DataExport = ({ gameData, onClose }) => {
            const [copied, setCopied] = useState(false);
            const [format, setFormat] = useState('json'); // json or csv

            const jsonString = JSON.stringify(gameData, null, 2);

            // CSVå½¢å¼ã«å¤‰æ›ï¼ˆãƒ•ãƒ©ãƒƒãƒˆåŒ–ï¼‰
            const generateCSV = () => {
                const flatData = {
                    // åŸºæœ¬æƒ…å ±
                    session_id: gameData.sessionId,
                    participant_id: gameData.participant?.id || '',
                    experiment_condition: gameData.experimentCondition || '',
                    version: gameData.version,
                    
                    // ãƒ‡ãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯
                    age_group: gameData.participant?.demographics?.ageGroup || '',
                    gender: gameData.participant?.demographics?.gender || '',
                    sns_frequency: gameData.participant?.demographics?.snsFrequency || '',
                    health_info_source: gameData.participant?.demographics?.healthInfoSource || '',
                    
                    // ãƒ—ãƒ¬ã‚¤å®Œäº†ç‡
                    progress_consent: gameData.progress?.consentCompleted ? 1 : 0,
                    progress_intro: gameData.progress?.introCompleted ? 1 : 0,
                    progress_stage1_start: gameData.progress?.stage1Started ? 1 : 0,
                    progress_stage1_complete: gameData.progress?.stage1Completed ? 1 : 0,
                    progress_stage2_intro: gameData.progress?.stage2IntroCompleted ? 1 : 0,
                    progress_stage3_start: gameData.progress?.stage3Started ? 1 : 0,
                    progress_stage3_complete: gameData.progress?.stage3Completed ? 1 : 0,
                    progress_debrief: gameData.progress?.debriefViewed ? 1 : 0,
                    progress_survey_start: gameData.progress?.surveyStarted ? 1 : 0,
                    progress_survey_complete: gameData.progress?.surveyCompleted ? 1 : 0,
                    progress_fully_completed: gameData.progress?.fullyCompleted ? 1 : 0,
                    
                    // æ™‚é–“
                    consent_time: gameData.timestamps?.consentTime || '',
                    game_start_time: gameData.timestamps?.gameStartTime || '',
                    completion_time: gameData.timestamps?.completionTime || '',
                    total_duration_sec: gameData.durations?.total || '',
                    stage1_duration_sec: gameData.durations?.stage1 || '',
                    stage2_intro_duration_sec: gameData.durations?.stage2Intro || '',
                    stage3_duration_sec: gameData.durations?.stage3 || '',
                    survey_duration_sec: gameData.durations?.survey || '',
                    
                    // Stage1çµæœ
                    stage1_score: gameData.stage1?.score || '',
                    stage1_accuracy: gameData.stage1?.accuracy || '',
                    stage1_correct_count: gameData.stage1?.correctCount || '',
                    stage1_total_questions: gameData.stage1?.totalQuestions || '',
                    stage1_weak_techniques: gameData.stage1?.weakTechniques?.join(';') || '',
                    
                    // Stage3çµæœ
                    stage3_final_followers: gameData.stage3?.finalFollowers || '',
                    stage3_final_ethics: gameData.stage3?.finalEthics || '',
                    stage3_ethical_post_count: gameData.stage3?.ethicalPostCount || '',
                    stage3_total_rounds: gameData.stage3?.totalRounds || '',
                    stage3_title: gameData.stage3?.title || '',
                    stage3_suspended: gameData.stage3?.suspended ? 1 : 0,
                    stage3_suspended_at_round: gameData.stage3?.suspendedAtRound || '',
                    
                    // æ‹¡æ•£å½±éŸ¿
                    spread_total_reach: gameData.stage3?.spreadImpact?.totalReach || '',
                    spread_total_believers: gameData.stage3?.spreadImpact?.totalBelievers || '',
                    
                    // äº‹å¾Œã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ
                    survey_enjoyment: gameData.survey?.enjoyment || '',
                    survey_understanding: gameData.survey?.understanding || '',
                    survey_behavior_change: gameData.survey?.behaviorChange || '',
                    survey_difficulty: gameData.survey?.difficulty || '',
                    survey_recommendation: gameData.survey?.recommendation || '',
                    survey_free_comment: gameData.survey?.freeComment || ''
                };

                // Stage1ã®å„å•é¡Œã®å›ç­”
                if (gameData.stage1?.answers) {
                    gameData.stage1.answers.forEach((answer, i) => {
                        flatData[`s1_q${i + 1}_correct`] = answer.correct ? 1 : 0;
                        flatData[`s1_q${i + 1}_techniques`] = answer.techniques?.join(';') || '';
                    });
                }

                // Stage3ã®å„ãƒ©ã‚¦ãƒ³ãƒ‰ã®é¸æŠ
                if (gameData.stage3?.rounds) {
                    gameData.stage3.rounds.forEach((round, i) => {
                        flatData[`s3_r${i + 1}_target`] = round.target || '';
                        flatData[`s3_r${i + 1}_techniques`] = round.techniques?.join(';') || '';
                        flatData[`s3_r${i + 1}_followers`] = round.newFollowers || '';
                        flatData[`s3_r${i + 1}_ethics`] = round.ethicsChange || '';
                    });
                }

                const headers = Object.keys(flatData);
                const values = Object.values(flatData);
                
                return headers.join(',') + '\n' + values.map(v => `"${v}"`).join(',');
            };

            const currentData = format === 'json' ? jsonString : generateCSV();

            const handleCopy = async () => {
                try {
                    await navigator.clipboard.writeText(currentData);
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (err) {
                    const textarea = document.createElement('textarea');
                    textarea.value = currentData;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                }
            };

            const handleDownload = () => {
                const mimeType = format === 'json' ? 'application/json' : 'text/csv';
                const extension = format === 'json' ? 'json' : 'csv';
                const blob = new Blob([currentData], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `infodemic_chronicle_${gameData.sessionId}.${extension}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            return (
                <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 animate-fade-in">
                    <div className="bg-slate-800 rounded-3xl p-6 md:p-8 max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col">
                        <div className="flex items-center justify-between mb-4">
                            <h2 className="text-2xl font-bold">ğŸ“Š ãƒ—ãƒ¬ã‚¤ãƒ‡ãƒ¼ã‚¿</h2>
                            <button
                                onClick={onClose}
                                className="text-gray-400 hover:text-white text-2xl"
                            >
                                Ã—
                            </button>
                        </div>

                        {/* ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆ */}
                        <div className="flex gap-2 mb-4">
                            <button
                                onClick={() => setFormat('json')}
                                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                                    format === 'json'
                                        ? 'bg-indigo-500 text-white'
                                        : 'bg-white/10 text-gray-300 hover:bg-white/20'
                                }`}
                            >
                                JSON
                            </button>
                            <button
                                onClick={() => setFormat('csv')}
                                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                                    format === 'csv'
                                        ? 'bg-indigo-500 text-white'
                                        : 'bg-white/10 text-gray-300 hover:bg-white/20'
                                }`}
                            >
                                CSVï¼ˆ1è¡Œå½¢å¼ï¼‰
                            </button>
                        </div>

                        <div className="bg-black/30 rounded-xl p-4 mb-6 flex-1 overflow-auto scrollbar-hide">
                            <pre className="text-xs text-gray-300 whitespace-pre-wrap font-mono">
                                {currentData}
                            </pre>
                        </div>

                        <div className="flex gap-3">
                            <button
                                onClick={handleCopy}
                                className={`flex-1 font-bold py-3 px-6 rounded-xl transition-all ${
                                    copied
                                        ? 'bg-green-500 text-white'
                                        : 'bg-white/10 hover:bg-white/20 text-white'
                                }`}
                            >
                                {copied ? 'âœ“ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ' : 'ğŸ“‹ ã‚³ãƒ”ãƒ¼'}
                            </button>
                            <button
                                onClick={handleDownload}
                                className="flex-1 btn-primary text-white font-bold py-3 px-6 rounded-xl"
                            >
                                ğŸ’¾ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª
        const App = () => {
            const [stage, setStage] = useState('consent'); // consent, intro, stage1, stage2intro, stage3, stage3intro, stageCreate, debrief, survey, complete
            const [stage1Data, setStage1Data] = useState(null);
            const [stage3Data, setStage3Data] = useState(null);
            const [stageCreateData, setStageCreateData] = useState(null);
            const [surveyData, setSurveyData] = useState(null);
            const [showDataExport, setShowDataExport] = useState(false);
            const [firebaseInitialized, setFirebaseInitialized] = useState(false);
            
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰å®Ÿé¨“æ¡ä»¶ã‚’å–å¾—
            const [experimentCondition] = useState(() => {
                const params = new URLSearchParams(window.location.search);
                return params.get('condition') || null;
                // ä½¿ç”¨ä¾‹: ?condition=experimental ã¾ãŸã¯ ?condition=control
            });

            // è¢«é¨“è€…æƒ…å ±
            const [participantInfo, setParticipantInfo] = useState(null);
            
            // FirebaseåˆæœŸåŒ–ã‚’å¾…æ©Ÿ
            useEffect(() => {
                const checkFirebase = () => {
                    if (window.firebaseReady) {
                        setFirebaseInitialized(true);
                    }
                };
                
                if (window.firebaseReady) {
                    setFirebaseInitialized(true);
                } else {
                    window.addEventListener('firebaseReady', checkFirebase);
                    return () => window.removeEventListener('firebaseReady', checkFirebase);
                }
            }, []);
            
            // Firebaseã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹é–¢æ•°
            const saveToFirebase = async (path, data, merge = true) => {
                if (!firebaseInitialized || !window.firebaseDB) {
                    console.warn('Firebase not initialized yet');
                    return false;
                }
                
                try {
                    const docRef = window.firebaseDoc(window.firebaseDB, 'sessions', sessionId);
                    if (merge) {
                        await window.firebaseSetDoc(docRef, {
                            [path]: data,
                            lastUpdated: new Date().toISOString()
                        }, { merge: true });
                    } else {
                        await window.firebaseSetDoc(docRef, data);
                    }
                    console.log(`Saved to Firebase: ${path}`);
                    return true;
                } catch (error) {
                    console.error('Firebase save error:', error);
                    return false;
                }
            };
            
            // ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒƒã‚¯ãƒ»ã‚¿ãƒ–ã‚’é–‰ã˜ã‚‹éš›ã®è­¦å‘Š
            useEffect(() => {
                const handleBeforeUnload = (e) => {
                    // åŒæ„å‰ã¨å®Œäº†å¾Œã¯è­¦å‘Šã‚’å‡ºã•ãªã„
                    if (stage === 'consent' || stage === 'complete') {
                        return;
                    }
                    
                    // æ¨™æº–çš„ãªæ–¹æ³•ã§è­¦å‘Šã‚’è¡¨ç¤º
                    e.preventDefault();
                    e.returnValue = 'ã‚²ãƒ¼ãƒ ã®é€²è¡ŒçŠ¶æ³ãŒå¤±ã‚ã‚Œã¾ã™ã€‚æœ¬å½“ã«ãƒšãƒ¼ã‚¸ã‚’é›¢ã‚Œã¾ã™ã‹ï¼Ÿ';
                    return e.returnValue;
                };

                window.addEventListener('beforeunload', handleBeforeUnload);
                
                return () => {
                    window.removeEventListener('beforeunload', handleBeforeUnload);
                };
            }, [stage]);

            // ãƒ—ãƒ¬ã‚¤å®Œäº†ç‡ã®è¨˜éŒ²
            const [progress, setProgress] = useState({
                consentCompleted: false,
                introCompleted: false,
                stage1Started: false,
                stage1Completed: false,
                stage2IntroCompleted: false,
                stage3Started: false,
                stage3Completed: false,
                stageCreateStarted: false,
                stageCreateCompleted: false,
                debriefViewed: false,
                surveyStarted: false,
                surveyCompleted: false,
                fullyCompleted: false
            });
            
            // æ™‚é–“è¨˜éŒ²ç”¨
            const [sessionId] = useState(() => Date.now().toString(36) + Math.random().toString(36).substr(2, 5));
            const [timestamps, setTimestamps] = useState({
                consentTime: null,
                gameStartTime: null,
                stage1StartTime: null,
                stage1EndTime: null,
                stage2IntroEndTime: null,
                stage3StartTime: null,
                stage3EndTime: null,
                stageCreateStartTime: null,
                stageCreateEndTime: null,
                debriefTime: null,
                surveyStartTime: null,
                surveyEndTime: null,
                completionTime: null
            });

            const handleConsent = (consentData) => {
                const participantId = consentData.participantId || `auto_${sessionId}`;
                
                setParticipantInfo({
                    id: participantId,
                    demographics: consentData.demographics
                });
                
                const consentTime = new Date().toISOString();
                setTimestamps(prev => ({ 
                    ...prev, 
                    consentTime: consentTime
                }));
                setProgress(prev => ({ ...prev, consentCompleted: true }));
                
                // Firebaseã«ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ã‚’è¨˜éŒ²
                saveToFirebase('metadata', {
                    sessionId: sessionId,
                    participantId: participantId,
                    experimentCondition: experimentCondition,
                    startedAt: consentTime,
                    userAgent: navigator.userAgent,
                    screenSize: `${window.innerWidth}x${window.innerHeight}`,
                    language: navigator.language
                });
                
                if (consentData.demographics) {
                    saveToFirebase('preSurvey', {
                        demographics: consentData.demographics,
                        completedAt: consentTime
                    });
                }
                
                setStage('intro');
            };

            const handleStart = () => {
                setTimestamps(prev => ({ 
                    ...prev, 
                    gameStartTime: new Date().toISOString(),
                    stage1StartTime: new Date().toISOString()
                }));
                setProgress(prev => ({ ...prev, introCompleted: true, stage1Started: true }));
                setStage('stage1');
            };

            const handleStage1Complete = (data) => {
                const endTime = new Date().toISOString();
                setTimestamps(prev => ({ ...prev, stage1EndTime: endTime }));
                
                const stage1Result = {
                    ...data,
                    startTime: timestamps.stage1StartTime,
                    endTime: endTime
                };
                setStage1Data(stage1Result);
                setProgress(prev => ({ ...prev, stage1Completed: true }));
                
                // Firebaseã«ä¿å­˜
                saveToFirebase('stage1', {
                    completedAt: endTime,
                    totalScore: data.score,
                    accuracy: data.accuracy,
                    results: data.answers ? data.answers.map(r => ({
                        questionId: r.questionId,
                        isManipulative: r.isManipulative,
                        userJudgment: r.userJudgment,
                        isCorrect: r.isCorrect,
                        selectedTechniques: r.selectedTechniques || [],
                        correctTechniques: r.correctTechniques || [],
                        rebuttalCorrect: r.rebuttalCorrect,
                        rebuttalPartial: r.rebuttalPartial
                    })) : [],
                    weakTechniques: data.weakTechniques || [],
                    rebuttalStats: data.rebuttalStats || null
                });
                
                setStage('stage2intro');
            };

            const handleStage2IntroComplete = () => {
                const now = new Date().toISOString();
                setTimestamps(prev => ({ 
                    ...prev, 
                    stage2IntroEndTime: now,
                    stage3StartTime: now 
                }));
                setProgress(prev => ({ ...prev, stage2IntroCompleted: true, stage3Started: true }));
                setStage('stage3');
            };

            const handleStage3Complete = (data) => {
                const endTime = new Date().toISOString();
                setTimestamps(prev => ({ 
                    ...prev, 
                    stage3EndTime: endTime
                }));
                
                const stage3Result = {
                    ...data,
                    startTime: timestamps.stage3StartTime,
                    endTime: endTime
                };
                setStage3Data(stage3Result);
                setProgress(prev => ({ ...prev, stage3Completed: true }));
                
                // Firebaseã«ä¿å­˜ï¼ˆã“ã‚Œã¯Stage2 = ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ä½“é¨“ï¼‰
                saveToFirebase('stage2', {
                    completedAt: endTime,
                    finalFollowers: data.totalFollowers,
                    finalCredibility: data.finalEthics,
                    suspended: data.suspended || false,
                    suspendedAtRound: data.suspendedAtRound || null,
                    rounds: data.results ? data.results.map((r, idx) => ({
                        roundNumber: r.round || idx + 1,
                        selectedPost: {
                            content: r.post?.content || '',
                            techniques: r.post?.techniques || []
                        },
                        target: r.target?.name || '',
                        followersGained: r.newFollowers || 0,
                        credibilityChange: r.ethicsChange || 0,
                        likes: r.likes || 0,
                        shares: r.shares || 0
                    })) : []
                });
                
                setStage('stage3intro');
            };

            const handleStage3IntroComplete = () => {
                const now = new Date().toISOString();
                setTimestamps(prev => ({ 
                    ...prev, 
                    stageCreateStartTime: now 
                }));
                setProgress(prev => ({ ...prev, stageCreateStarted: true }));
                setStage('stageCreate');
            };

            const handleStageCreateComplete = (data) => {
                const endTime = new Date().toISOString();
                setTimestamps(prev => ({ 
                    ...prev, 
                    stageCreateEndTime: endTime,
                    debriefTime: endTime 
                }));
                
                const stageCreateResult = {
                    ...data,
                    startTime: timestamps.stageCreateStartTime,
                    endTime: endTime
                };
                setStageCreateData(stageCreateResult);
                setProgress(prev => ({ ...prev, stageCreateCompleted: true, debriefViewed: true }));
                
                // Firebaseã«ä¿å­˜ï¼ˆã“ã‚Œã¯Stage3 = æƒ…å ±æ¤œè¨¼è¨“ç·´ï¼‰
                saveToFirebase('stage3', {
                    completedAt: endTime,
                    totalScore: data.scenarios ? data.scenarios.reduce((sum, s) => sum + (s.totalScore || 0), 0) : 0,
                    scenarios: data.scenarios ? data.scenarios.map(s => ({
                        scenarioId: s.scenario?.id || 0,
                        title: s.scenario?.title || '',
                        difficulty: s.scenario?.difficulty || '',
                        answers: s.answers ? s.answers.map((a, idx) => ({
                            stepNumber: idx + 1,
                            selectedOptionId: a.id || '',
                            score: a.score || 0
                        })) : [],
                        totalScore: s.totalScore || 0,
                        maxScore: s.maxScore || 9
                    })) : []
                });
                
                setStage('debrief');
            };

            const handleContinueToSurvey = () => {
                setTimestamps(prev => ({ 
                    ...prev, 
                    surveyStartTime: new Date().toISOString()
                }));
                setProgress(prev => ({ ...prev, surveyStarted: true }));
                setStage('survey');
            };

            const handleSurveyComplete = (responses) => {
                const endTime = new Date().toISOString();
                setTimestamps(prev => ({ 
                    ...prev, 
                    surveyEndTime: endTime,
                    completionTime: endTime
                }));
                setSurveyData(responses);
                setProgress(prev => ({ ...prev, surveyCompleted: true, fullyCompleted: true }));
                
                // Firebaseã«äº‹å¾Œã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã¨å®Œäº†ã‚’è¨˜éŒ²
                saveToFirebase('postSurvey', {
                    responses: responses,
                    completedAt: endTime
                });
                
                saveToFirebase('metadata', {
                    completedAt: endTime,
                    fullyCompleted: true
                });
                
                setStage('complete');
            };

            const handleRestart = () => {
                setStage('intro');
                setStage1Data(null);
                setStage3Data(null);
                setStageCreateData(null);
                setSurveyData(null);
                setTimestamps(prev => ({
                    consentTime: prev.consentTime,
                    gameStartTime: null,
                    stage1StartTime: null,
                    stage1EndTime: null,
                    stage2IntroEndTime: null,
                    stage3StartTime: null,
                    stage3EndTime: null,
                    stageCreateStartTime: null,
                    stageCreateEndTime: null,
                    debriefTime: null,
                    surveyStartTime: null,
                    surveyEndTime: null,
                    completionTime: null
                }));
                // progressã¯ãƒªã‚»ãƒƒãƒˆã—ãªã„ï¼ˆå†ãƒ—ãƒ¬ã‚¤ã‚‚è¨˜éŒ²ï¼‰
            };

            // å®Œå…¨ãªã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
            const generateGameData = () => {
                const calcDuration = (start, end) => {
                    if (!start || !end) return null;
                    return Math.round((new Date(end) - new Date(start)) / 1000);
                };

                // æ‹¡æ•£å½±éŸ¿ã‚’è¨ˆç®—
                const calculateSpreadImpact = () => {
                    if (!stage3Data) return null;
                    
                    let totalReach = 0;
                    let totalBelievers = 0;
                    
                    stage3Data.results.forEach(result => {
                        const techniques = result.post.techniques;
                        const manipulationLevel = techniques.length;
                        const isManipulative = manipulationLevel > 0;
                        
                        const primaryReach = result.newFollowers;
                        const secondaryReach = Math.round(result.shares * 150 * (1 + manipulationLevel * 0.3));
                        const tertiaryReach = Math.round(secondaryReach * 0.2 * (1 + manipulationLevel * 0.2));
                        
                        const roundReach = primaryReach + secondaryReach + tertiaryReach;
                        totalReach += roundReach;
                        
                        if (isManipulative) {
                            const believerRate = 0.3 + manipulationLevel * 0.15;
                            totalBelievers += Math.round(roundReach * believerRate * 0.5);
                        }
                    });
                    
                    return { totalReach, totalBelievers };
                };

                // ç§°å·ã‚’è¨ˆç®—
                const calculateTitle = () => {
                    if (!stage3Data) return null;
                    
                    // å‡çµã•ã‚ŒãŸå ´åˆ
                    if (stage3Data.suspended) return 'suspended';
                    
                    const followers = stage3Data.totalFollowers;
                    const ethics = stage3Data.finalEthics;
                    
                    if (ethics >= 70) {
                        if (followers >= 600) return 'ideal_leader';
                        if (followers >= 300) return 'balanced_influencer';
                        return 'honest_creator';
                    } else if (ethics >= 40) {
                        if (followers >= 600) return 'popular';
                        if (followers >= 300) return 'growing_creator';
                        return 'cautious_observer';
                    } else {
                        if (followers >= 600) return 'misinfo_spreader';
                        if (followers >= 300) return 'controversy_influencer';
                        return 'lost_beginner';
                    }
                };

                const spreadImpact = calculateSpreadImpact();
                const title = calculateTitle();

                return {
                    sessionId,
                    version: 'v11',
                    experimentCondition,
                    participant: participantInfo,
                    progress,
                    timestamps: {
                        ...timestamps,
                        exportTime: new Date().toISOString()
                    },
                    durations: {
                        total: calcDuration(timestamps.gameStartTime, timestamps.completionTime || timestamps.surveyEndTime || timestamps.stage3EndTime),
                        stage1: calcDuration(timestamps.stage1StartTime, timestamps.stage1EndTime),
                        stage2Intro: calcDuration(timestamps.stage1EndTime, timestamps.stage2IntroEndTime),
                        stage3: calcDuration(timestamps.stage3StartTime, timestamps.stage3EndTime),
                        survey: calcDuration(timestamps.surveyStartTime, timestamps.surveyEndTime)
                    },
                    stage1: stage1Data ? {
                        score: stage1Data.score,
                        accuracy: stage1Data.accuracy,
                        correctCount: stage1Data.answers.filter(a => a.correct).length,
                        totalQuestions: stage1Data.answers.length,
                        weakTechniques: stage1Data.weakTechniques,
                        answers: stage1Data.answers.map(a => ({
                            questionId: a.questionId,
                            userAnswer: a.userAnswer,
                            correct: a.correct,
                            points: a.points,
                            techniques: a.techniques
                        }))
                    } : null,
                    stage3: stage3Data ? {
                        finalFollowers: stage3Data.totalFollowers,
                        finalEthics: stage3Data.finalEthics,
                        totalRounds: stage3Data.results.length,
                        ethicalPostCount: stage3Data.results.filter(r => r.post.ethics >= 0).length,
                        title: title,
                        suspended: stage3Data.suspended || false,
                        suspendedAtRound: stage3Data.suspendedAtRound || null,
                        spreadImpact: spreadImpact,
                        rounds: stage3Data.results.map(r => ({
                            round: r.round,
                            target: r.target,
                            postId: r.post.id,
                            techniques: r.post.techniques,
                            newFollowers: r.newFollowers,
                            ethicsChange: r.ethicsChange,
                            criticismResponse: r.criticismResponse || null
                        }))
                    } : null,
                    survey: surveyData
                };
            };

            return (
                <div className="scrollbar-hide">
                    {stage === 'consent' && (
                        <ConsentScreen 
                            onAgree={handleConsent} 
                            experimentCondition={experimentCondition}
                        />
                    )}
                    {stage === 'intro' && <Introduction onStart={handleStart} />}
                    {stage === 'stage1' && <Stage1 onComplete={handleStage1Complete} />}
                    {stage === 'stage2intro' && <Stage2Intro stage1Data={stage1Data} onContinue={handleStage2IntroComplete} />}
                    {stage === 'stage3' && <Stage3 stage1Data={stage1Data} onComplete={handleStage3Complete} />}
                    {stage === 'stage3intro' && <Stage3Intro stage3Data={stage3Data} onContinue={handleStage3IntroComplete} />}
                    {stage === 'stageCreate' && <StageCreate stage1Data={stage1Data} stage3Data={stage3Data} onComplete={handleStageCreateComplete} />}
                    {stage === 'debrief' && (
                        <FinalDebriefing 
                            stage1Data={stage1Data} 
                            stage3Data={stage3Data}
                            stageCreateData={stageCreateData}
                            onRestart={handleRestart}
                            onShowData={() => setShowDataExport(true)}
                            onContinueToSurvey={handleContinueToSurvey}
                        />
                    )}
                    {stage === 'survey' && (
                        <PostSurvey 
                            onComplete={handleSurveyComplete}
                            onShowData={() => setShowDataExport(true)}
                        />
                    )}
                    {stage === 'complete' && (
                        <CompletionScreen 
                            onShowData={() => setShowDataExport(true)}
                            onRestart={handleRestart}
                        />
                    )}
                    
                    {showDataExport && (
                        <DataExport 
                            gameData={generateGameData()} 
                            onClose={() => setShowDataExport(false)} 
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
